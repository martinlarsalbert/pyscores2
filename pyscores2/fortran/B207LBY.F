C     PROGRAM SCORES - B207LBY.FOR
C     ******************************************************************
C     *                                                                *
C     *                                                                *
C     *                                                                *
C     *                                                                *
C     * MODIFIERING:   99-05-28  John Olofson                          *
C     * Dè ABS(OMWE(L)).LT.0.1.AND.WAD(IW).LT.90.0)                    *
C     * ROLL, VERT.B.M, VERT.SH, LAT.B.M., LAT.SH., TORSNL.M. = 0      *
C     *                                                                *
C     * 1999-10-25  VSF och LSF skall multipliceras med L istf L*L     *
C     *             John Olofson                                       *
C     *                                                                *
C     *                                                                *
C     ******************************************************************
C     *                                                                *
      COMMON /   / TDP(21,25,10)
      COMMON / CONDA / PI,GAMMA,GRAV,RO
      COMMON / MHDT / HDA(20),IB,IC,ID,IE,IF,IG,IH,II,IJ,IK,IL,INANT,
     B                H00(10),HCH0(10),GAMMB(10),PPER(10),TEXT(20),
     C                ASTA,IDS
      COMMON / BASDA / BPL,DISPL,TMASS,YNERT,BSTAR(21),AREA(21),
     X                 SECOE(21),DRAFT(21),ZBAR(21),XI(21),XISQ(21),
     X                 DWEIGH(21),DMASS(21),ZWT(21),GRL(21),ZCG,XNERT,
     X                 XZPERT,GM,MINKRI,MAXKRI,INCRES,ROLDPF
      COMMON / CASDA / NN,OMW(51),WVL(51),OMWE(51),VMIN,VMAX,DELV,
     X                 NWA,WAD(25),WANGI,WANGA,DWANG,NWI,WD(20),WLL(51)
      COMMON / TDIR / WE,WEN,ANS(21,10),KL,KU,IO,IW
      COMMON / MIMD / IA,NS,DXI,V,WANG,OMEGA,WAVEN,CW,DIX(21,5),FAC,WA
      COMMON / PIN / PSERH(25,10),QSERH(25,10),PSERS(25,10),QSERS(25,10)
     X              ,PSERR(25,10),QSERR(25,10),AXO(10),AYO(10),NSTA
      COMMON /EXCIT/ ZAMP(51),ZPH(51),PAMP(51),PPH(51),SWAMP(51),
     *               SWPH(51),YAMP(51),YPH(51),RAMP(51),RPH(51)
      COMMON /IPLOT/ IPLO,I11,I22
      COMMON /SIVFIL/ IRSV,IWX(80),TEXTRSV(80),RSVHNR(10,80)
      COMMON /SKIVPL/ IRAO,IWW(93),TEXTRAO(93),RAO(51,93)
      DIMENSION STS(20),XPOS(20),YPOS(20),ZPOS(20),SPEED(10),BES(5)
      DATA TEXTRSV /4HHEAV,4HPITC,4HSWAY,4HYAW ,4HROLL,4HVEBM,4HVESH,
     B              4HLABM,4HLASH,4HTORM,
     1              4HVEMO,4HVEA0,4HREL0,4HREV0,4HLYA0,4HLYM0,4HPXA0,
     2              4HVEM1,4HVEA1,4HREL1,4HREV1,4HLYA1,4HLYM1,4HPXA1,
     3              4HVEM2,4HVEA2,4HREL2,4HREV2,4HLYA2,4HLYM2,4HPXA2,
     4              4HVEM3,4HVEA3,4HREL3,4HREV3,4HLYA3,4HLYM3,4HPXA3,
     5              4HVEM4,4HVEA4,4HREL4,4HREV4,4HLYA4,4HLYM4,4HPXA4,
     6              4HVEM5,4HVEA5,4HREL5,4HREV5,4HLYA5,4HLYM5,4HPXA5,
     7              4HVEM6,4HVEA6,4HREL6,4HREV6,4HLYA6,4HLYM6,4HPXA6,
     8              4HVEM7,4HVEA7,4HREL7,4HREV7,4HLYA7,4HLYM7,4HPXA7,
     9              4HVEM8,4HVEA8,4HREL8,4HREV8,4HLYA8,4HLYM8,4HPXA8,
     C              4HVEM9,4HVEA9,4HREL9,4HREV9,4HLYA9,4HLYM9,4HPXA9/
      DATA TEXTRAO /4HWSP0,4HWSP1,4HWSP2,4HWSP3,4HWSP4,4HWSP5,4HWSP6,
     B              4HWSP7,4HWSP8,4HWSP9,
     C              4HWO  ,4HWE  ,4HLAGL,4HHEAV,4HPITC,4HVBMT,
     D              4HVSHF,4HSWAY,4HYAW ,4HROLL,4HLBMT,4HLSFO,4HTOMT,
     1              4HVEMO,4HVEA0,4HREL0,4HREV0,4HLYA0,4HLYM0,4HPXA0,
     2              4HVEM1,4HVEA1,4HREL1,4HREV1,4HLYA1,4HLYM1,4HPXA1,
     3              4HVEM2,4HVEA2,4HREL2,4HREV2,4HLYA2,4HLYM2,4HPXA2,
     4              4HVEM3,4HVEA3,4HREL3,4HREV3,4HLYA3,4HLYM3,4HPXA3,
     5              4HVEM4,4HVEA4,4HREL4,4HREV4,4HLYA4,4HLYM4,4HPXA4,
     6              4HVEM5,4HVEA5,4HREL5,4HREV5,4HLYA5,4HLYM5,4HPXA5,
     7              4HVEM6,4HVEA6,4HREL6,4HREV6,4HLYA6,4HLYM6,4HPXA6,
     8              4HVEM7,4HVEA7,4HREL7,4HREV7,4HLYA7,4HLYM7,4HPXA7,
     9              4HVEM8,4HVEA8,4HREL8,4HREV8,4HLYA8,4HLYM8,4HPXA8,
     C              4HVEM9,4HVEA9,4HREL9,4HREV9,4HLYA9,4HLYM9,4HPXA9/
      DATA STS/3HMN.,3H SQ,3HR.M,3H.S.,3HAVG,3H.  ,3HSIG,3H.  ,3HAV1,
     X         11*3H   /
C
      OPEN(1,FILE='D222BLST.TILL.D207BL')  !!
      OPEN(2,FILE='HYDRO.TILL.SCORE')      !!
      OPEN(5,FILE='data207')
      OPEN(6,FILE='res207')
      OPEN(7,FILE='TK.SCORE',FORM='UNFORMATTED')
      OPEN(8,FILE='RES207B')
      OPEN(10,FILE='RESX207',FORM='UNFORMATTED')
c      OPEN(11,FILE='UDD:SLASK:SCORES.DATA')
c      OPEN(12,FILE='UDD:SLASK:SCORES.RAO')
      OPEN(30,FILE='DATA207.TO.DATA301')     !!
C-01  READ, PROCESS AND STORE INPUT DATA
      CALL PRELIB
      READ(5,928) ISPEED,(SPEED(I),I=1,ISPEED)
      ISP=1
      READ(5,927) NPOS
      IF(NPOS.EQ.0) GOTO 50
      READ(5,926) (XPOS(I),YPOS(I),ZPOS(I),I=1,NPOS)
      READ(5,935) IRAO,(IWW(I),I=1,IRAO)
      READ(5,935) IRSV,(IWX(I),I=1,IRSV)
   50 CALL PRELIC(SPEED,ISPEED)
      IF(IPLO) 56,56,55
C
   55 CONTINUE
      WRITE(7) NWA,NPOS
      WRITE(7) (WAD(I),I=1,NWA)
C
   56 CONTINUE
      IF ( IE.GT.0 )  CALL ROLD
      WRITE(6,925)
C-02  INITIALIZE SHIP SPEED
C-03  LOOP OVER WAVE ANGLE RANGE
   60 DO 90  IW=1,NWA
      S=SPEED(ISP)
      V = S*0.5144444
      WANG=WAD(IW)*PI/180.0
C-04  SET TDP ARRAY USAGE LIMITS
      KL = 1
      IF( IE .GT. 1 )  KL = 3
      KU = 10
      IF ( IE .LT. 1 .OR. AMOD(WAD(IW),180.0).EQ.0.0 )  KU = 2
      IF ( IB.LT.2 .OR. MAXKRI.EQ.MINKRI )  GO TO 70
      WRITE(6,920) HDA
      IF ( II.EQ.1 )  WRITE(6,924)
      WRITE(6,921) S,WAD(IW)
      WRITE(6,923)
C-05  LOOP OVER WAVE FREQUENCY RANGE
   70 DO 80  IO=1,NN
      OMEGA = OMW(IO)
      WAVEN = OMEGA*OMEGA/GRAV
      WVL(IO)= 2.0*PI/WAVEN
      WLL(IO)=WVL(IO)/BPL
C-06  CALCULATE FREQUENCY PARAMETERS
      CW = GRAV/OMEGA
      WE = WAVEN*(CW-V*COS(WANG))
      OMWE(IO) = WE
      WEN=WE*WE/GRAV
C-07  PERFORM CALCULATIONS AT EACH FREQUENCY
      CALL ALINT
      IF (NSTA.GT.1) CALL BLINT
      CALL COEFF
      CALL EXCITE
      CALL MOTION
      IF ( IB.LT.2 )  GO TO 80
      CALL BENDSH
   80 CONTINUE
C-08  PRINT OUT RESULTS FOR THIS SPEED AND WAVE ANGLE
      IF(IK.NE.1) GOTO 86
      WRITE(6,929) HDA
      WRITE(6,930)
      WRITE(6,931) S,WAD(IW)
      WRITE(6,932)
      WRITE(6,933)
      DO 85 I=1,NN
      WRITE(6,934) OMW(I),OMWE(I),WLL(I),ZAMP(I),ZPH(I),PAMP(I),
     *              PPH(I),SWAMP(I),SWPH(I),YAMP(I),YPH(I),
     *              RAMP(I),RPH(I)
   85 CONTINUE
   86 CONTINUE
      IF (NSTA.GT.1) CALL PRESS
      CALL TNIRPA(XPOS,YPOS,ZPOS,NPOS)
      IF ( ID.EQ.0 )  GO TO 90
      IF (II.GT.0) THEN
c     Dimensionslîst
         FAC=(1.0/(DISPL*GRAV*BPL))**2
      ELSE
c     Dimensioner
         FAC=1.0
      ENDIF
      CALL STATI(XPOS,YPOS,ZPOS,NPOS)
   90 CONTINUE
      IF ( IF.LT.1 )  GO TO 100
      CALL SPREAD(XPOS,YPOS,ZPOS,NPOS)
C-09  INCREMENT SHIP SPEED
  100 CONTINUE
      IF(ISP.EQ.ISPEED) GOTO 50
      ISP=ISP+1
C
C     READ TDP-ARRAY FOR A NEW SPEED
C
      REWIND10
      READ(10) (BES(I),I=1,5)
      DO 23 J=1,NS
      DO 23 I=1,25
23    READ(10) (TDP(J,I,K),K=1,10)
      GOTO 60
  920 FORMAT (1H1,20A4//' MOMENT RESULTS')
  921 FORMAT (9H0SPEED = ,F6.3,' KNOTS',6X,'WAVE ANGLE = ',F7.3,' DEG.')
  923 FORMAT ( 1H0, 21X, 56HVERTICAL BEND.MT.   LATERAL BEND.MT.    TORS
     XIONAL MOMENT  / 22H WAVE FREQ.  STATION   , 3(20HAMPLITUDE   PHASE
     X    ) /)
  924 FORMAT ( 1H+, 20X, 17H(NON-DIMENSIONAL) )
  925 FORMAT (1H1//' ************** OUTPUT UNITS *************'///
     X' FREQUENCY.......RADIANS / SECOND'//
     X' WAVE LENGTH.....METER'//
     X' MOTION..........METER   (HEAVE, SWAY)'//
     X' ANGULAR MOTION..DEGREES (PITCH, YAW, ROLL)'//
     X' PHASE ANGLE.....DEGREES'//
     X' MOMENT..........KILONEWTONMETER'//
     X' PRESSURE........KILONEWTON / METER**2')
  926 FORMAT(3F10.0)
  927 FORMAT(I10)
  928 FORMAT(I4,4X,9F8.0)
  929 FORMAT(1H1,20A4)
  930 FORMAT(1H0,'EXCITING FORCES AND MOMENTS (NON DIMENSIONAL)')
  931 FORMAT(1H0,'SPEED= ',F6.3,' KNOTS   WAVE ANGLE= ',F7.3,' DEG.')
  932 FORMAT(/2X,'WAVE  ENCOUNT. WAVE/SHIP  HEAVE FORCE ',
     *       5X,'PITCH MOMENT',6X,'SWAY FORCE',7X,'YAW MOMENT',
     *       6X,'ROLL MOMENT')
  933 FORMAT(3X,'FREQUENCIES',4X,'LENGTH',5(5X,'AMPL.  PHASE')/)
  934 FORMAT(F7.4,F8.4,F9.4,5(F10.6,F7.1))
  935 FORMAT(40I2)
      END
      SUBROUTINE PRELIB
      COMMON / CONDA / PI,GAMMA,GRAV,RO
      COMMON / MHDT / HDA(20),IB,IC,ID,IE,IF,IG,IH,II,IJ,IK,IL,INANT,
     B                H00(10),HCH0(10),GAMMB(10),PPER(10),TEXT(20),
     C                ASTA,IDS
      COMMON / BASDA / BPL,DISPL,TMASS,YNERT,BSTAR(21),AREA(21),
     X                 SECOE(21),DRAFT(21),ZBAR(21),XI(21),XISQ(21),
     X                 DWEIGH(21),DMASS(21),ZWT(21),GRL(21),ZCG,XNERT,
     X                 XZPERT,GM,MINKRI,MAXKRI,INCRES,ROLDPF
      COMMON / MIMD / IA,NS,DXI,V,WANG,OMEGA,WAVEN,CW,DIX(21,5),FAC,WA
      COMMON / PIN / PSERH(25,10),QSERH(25,10),PSERS(25,10),QSERS(25,10)
     X              ,PSERR(25,10),QSERR(25,10),AXO(10),AYO(10),NSTA
      COMMON / PROGRA / STORAG(436),Y(21),STA(21),W(21),SMINNE(102)
      COMMON /IPLOT/ IPLO,I11,I22
      DIMENSION RWEIGH(21),TXTHYD(6),ADJUP(8)
      DIMENSION STS(10)
      DATA STS/3HMN.,3H SQ,3HR.M,3H.S.,3HAVG,3H.  ,3HSIG,3H.  ,3HAV1,
     X3H/10  /
      PI = 3.1415926
      IX = 0
C-01  READ (AND PROCESS) BASIC INPUT DATA
    1 READ(5,901)HDA
      READ(5,902) IA,IB,IC,ID,IE,IF,IG,IH,II,IJ,IK,IL,N,IPLO,INANT,
     B            IHYDRO,IDEPTH
      IF(IABS(ID).LE.4) GO TO 31
      IF(IABS(ID).EQ.5) GO TO 32
C    INDATA FR]N SKIVA
      READ(1,109) TEXT
      WRITE(8,209) TEXT
      READ(1,110) (H00(IX1),IX1=1,INANT)
      WRITE(8,210) (H00(IX1),IX1=1,INANT)
      READ(1,110) (HCH0(IX1),IX1=1,INANT)
      WRITE(8,211) (HCH0(IX1),IX1=1,INANT)
      READ(1,110) (GAMMB(IX1),IX1=1,INANT)
      WRITE(8,212) (GAMMB(IX1),IX1=1,INANT)
      READ(1,110) (PPER(IX1),IX1=1,INANT)
      SUM=0.
      DO 28 I=1,INANT
28    SUM=SUM+PPER(I)
      WRITE(8,213)(PPER(IX1),IX1=1,INANT)
      IF(ABS(SUM-1.0).LE.0.001) GO TO 31
      WRITE(6,214) SUM
      GO TO 999
32    CONTINUE
C    INDATA FR]N KORT
      READ(5,109) TEXT
      WRITE(8,219) TEXT
      READ(5,110) (H00(IX1),IX1=1,INANT)
      WRITE(8,210) (H00(IX1),IX1=1,INANT)
      READ(5,110) (HCH0(IX1),IX1=1,INANT)
      WRITE(8,211) (HCH0(IX1),IX1=1,INANT)
      READ(5,110) (GAMMB(IX1),IX1=1,INANT)
      WRITE(8,212) (GAMMB(IX1),IX1=1,INANT)
      READ(5,110) (PPER(IX1),IX1=1,INANT)
      SUM=0.
      DO 29 I=1,INANT
29    SUM=SUM+PPER(I)
      WRITE(8,213)(PPER(IX1),IX1=1,INANT)
      IF(ABS(SUM-1.0).LE.0.001) GO TO 31
      WRITE(6,214) SUM
      GO TO 999
31    CONTINUE
      IF(IABS(ID).EQ.4) READ(5,109) TEXT
      M = N+IA
      IF ( M.GT.21 )  GO TO 951
      NS = M
      DO 2  I=1,M
    2 STA(I) = I-0.50*(1.0+IA)
      READ(5,903) BPL,RO,GRAV,DISPL,PDISPL
      IF(IHYDRO.NE.1) GO TO 30
      READ(2,108) TXTHYD,INHYD,INFOR,INAKT
      WRITE(6,215) TXTHYD,INHYD,INFOR,INAKT
      ING=2*INHYD
      READ(2,107)(ADJUP(IV),IV=1,ING)
      WRITE(6,600)(ADJUP(IV),IV=1,ING)
      INTOT=INFOR + INAKT
      INA1=INFOR + 1
      GO TO(51,52,53,54) ,INHYD
51    DO 151 I=1,INTOT
      READ(2,905)  BSTAR(I),SECOE(I),DRAFT(I)
      IF(DRAFT(I).LT.0.0) DRAFT(I)=0.0
151   CONTINUE
      GO TO 33
52    CONTINUE
      IF(IDEPTH.EQ.2) GO TO 152
      DO 153 I=1,INFOR
      READ(2,905)  BSTAR(I),SECOE(I),DRAFT(I)
      IF(DRAFT(I).LT.0.0) DRAFT(I)=0.0
153   CONTINUE
152   DO 154 I=1,INFOR
154   READ(2,907) ADUM
      IF(IDEPTH.EQ.2) GO TO 156
      DO 155 I=INA1,INTOT
      READ(2,905)  BSTAR(I),SECOE(I),DRAFT(I)
      IF(DRAFT(I).LT.0.0) DRAFT(I)=0.0
155   CONTINUE
      GO TO 33
156   DO 157 I=1,INFOR
      READ(2,905)  BSTAR(I),SECOE(I),DRAFT(I)
      IF(DRAFT(I).LT.0.0) DRAFT(I)=0.0
157   CONTINUE
      DO 251 I=INA1,INTOT
251   READ(2,907) ADUM
      DO 252 I=INA1,INTOT
      READ(2,905)  BSTAR(I),SECOE(I),DRAFT(I)
      IF(DRAFT(I).LT.0.0) DRAFT(I)=0.0
252   CONTINUE
      GO TO 33
C   3 ST DJUPG]ENDE
53    GO TO(254,158,159) ,IDEPTH
254   DO 160 I=1,INFOR
      READ(2,905)  BSTAR(I),SECOE(I),DRAFT(I)
      IF(DRAFT(I).LT.0.0) DRAFT(I)=0.0
160   CONTINUE
      DO 161 IV=1,2
      DO 161 I=1,INFOR
161   READ(2,907) ADUM
      DO 162 I=INA1,INTOT
      READ(2,905)  BSTAR(I),SECOE(I),DRAFT(I)
      IF(DRAFT(I).LT.0.0) DRAFT(I)=0.0
162   CONTINUE
      GO TO 33
158   DO 163 I=1,INFOR
163   READ(2,907) ADUM
      DO 164 I=1,INFOR
      READ(2,905)  BSTAR(I),SECOE(I),DRAFT(I)
      IF(DRAFT(I).LT.0.0) DRAFT(I)=0.0
164   CONTINUE
      DO 165 I=1,INFOR
165   READ(2,907) ADUM
      DO 253 I=INA1,INTOT
253   READ(2,907) ADUM
      DO 166 I=INA1,INTOT
      READ(2,905)  BSTAR(I),SECOE(I),DRAFT(I)
      IF(DRAFT(I).LT.0.0) DRAFT(I)=0.0
166   CONTINUE
      GO TO 33
C    3 DJUPG]ENDE : DJUPG]ENDE 3
159   DO 167 IV=1,2
      DO 167 I=1,INFOR
167   READ(2,907) ADUM
      DO 168 I=1,INFOR
      READ(2,905)  BSTAR(I),SECOE(I),DRAFT(I)
      IF(DRAFT(I).LT.0.0) DRAFT(I)=0.0
168   CONTINUE
      DO 169 IV=1,2
      DO 169 I=INA1,INTOT
169   READ(2,907) ADUM
      DO 170 I=INA1,INTOT
      READ(2,905)  BSTAR(I),SECOE(I),DRAFT(I)
      IF(DRAFT(I).LT.0.0) DRAFT(I)=0.0
170   CONTINUE
      GO TO 33
C   4 ST DJUPG]ENDE :
54    GO TO(171,172,173,174) ,IDEPTH
171   DO 175 I=1,INFOR
      READ(2,905)  BSTAR(I),SECOE(I),DRAFT(I)
      IF(DRAFT(I).LT.0.0) DRAFT(I)=0.0
175   CONTINUE
      DO 176 IV=1,3
      DO 176 I=1,INFOR
176   READ(2,907) ADUM
      DO 177 I=INA1,INTOT
      READ(2,905)  BSTAR(I),SECOE(I),DRAFT(I)
      IF(DRAFT(I).LT.0.0) DRAFT(I)=0.0
177   CONTINUE
      GO TO 33
C   4 ST DJUPG]ENDE -  DJUPG]ENDE 2
172   CONTINUE
      DO 178 I=1,INFOR
178   READ(2,907) ADUM
      DO 179 I=1,INFOR
      READ(2,905)  BSTAR(I),SECOE(I),DRAFT(I)
      IF(DRAFT(I).LT.0.0) DRAFT(I)=0.0
179   CONTINUE
      DO 180 IV=1,2
      DO 180 I=1,INFOR
180   READ(2,907) ADUM
      DO 181 I=INA1,INTOT
181   READ(2,907) ADUM
      DO 182 I=INA1,INTOT
      READ(2,905)  BSTAR(I),SECOE(I),DRAFT(I)
      IF(DRAFT(I).LT.0.0) DRAFT(I)=0.0
182   CONTINUE
      GO TO 33
C   4 ST DJUPG]ENDE  -  3:E DJUPG]ENDET
173   DO 183 IV=1,2
      DO 183 I=1,INFOR
183   READ(2,907) ADUM
      DO 184 I=1,INFOR
      READ(2,905)  BSTAR(I),SECOE(I),DRAFT(I)
      IF(DRAFT(I).LT.0.0) DRAFT(I)=0.0
184   CONTINUE
      DO 185 I=1,INFOR
185   READ(2,907) ADUM
      DO 186 IV=1,2
      DO 186 I=INA1,INTOT
186   READ(2,907) ADUM
      DO 187 I=INA1,INTOT
      READ(2,905)  BSTAR(I),SECOE(I),DRAFT(I)
      IF(DRAFT(I).LT.0.0) DRAFT(I)=0.0
187   CONTINUE
      GO TO 33
C   4 ST DJUPG]ENDE  -  4:E DJUPG]ENDET
174   DO 188 IV=1,3
      DO 188 I=1,INFOR
188   READ(2,907) ADUM
      DO 189 I=1,INFOR
      READ(2,905)  BSTAR(I),SECOE(I),DRAFT(I)
      IF(DRAFT(I).LT.0.0) DRAFT(I)=0.0
189   CONTINUE
      DO 190 IV=1,3
      DO 190 I=INA1,INTOT
190   READ(2,907) ADUM
      DO 191 I=INA1,INTOT
      READ(2,905)  BSTAR(I),SECOE(I),DRAFT(I)
      IF(DRAFT(I).LT.0.0) DRAFT(I)=0.0
191   CONTINUE
      GO TO 33
30    READ(5,904) (BSTAR(I),SECOE(I),DRAFT(I),ZBAR(I),I=1,M)
33    CONTINUE
      IF  ( ZBAR(2).GT.0.0 .OR. IE.LT.1 )  GO TO 4
      DO 3  I=1,M
      A = (1.0+2.0*SECOE(I))/6.0
      IF ( A .GT. 0.80 )  A = 0.80
    3 ZBAR(I) = DRAFT(I)*A
    4 IF ( IE.LT.1 )  GO TO 12
      READ(5,904) ZCG,RADGRO,CGM
   12 IF (IB.GT.0 )  GO TO 10
      READ(5,904) RADGYR,CGL
      GO TO 11
   10 READ(5,904) (DWEIGH(I),ZWT(I),GRL(I),A,I=1,M)
      IF ( GRL(2).GT.0.0 .OR. IE.LT.1 )  GO TO 11
      DO 6  I=1,M
    6 GRL(I) = RADGRO
   11 READ(5,906) MINKRI,MAXKRI,INCRES,NSTA
      NSTA=NSTA+1
      GAMMA=RO*GRAV
C-02  PRELIMINARY CALCULATIONS UPON BASIC INPUT DATA
      DXI = BPL/N
      IF ( IB.GT.0 )  GO TO 13
      TMASS = DISPL
      XI(1) = (BPL-(1-IA)*DXI)/2.0-CGL
      YNERT = TMASS*RADGYR*RADGYR
      GO TO 17
   13 DO 16  I=1,M
      DMASS(I) = DWEIGH(I)/DXI
      IF ( IA.EQ.0 )  GO TO 15
      IF ( I.EQ.1 )  DMASS(1) = DMASS(1)*2.0
      IF ( I.EQ.M )  DMASS(M) = DMASS(M)*2.0
   15 Y(I) = DMASS(I)*(I-1)
   16 W(I) = DMASS(I)*ZWT(I)
      TMASS = SINT(IA,M,DMASS,DXI)
      HISPL = TMASS
      XI(1) = SINT(IA,M,Y,DXI)*DXI/TMASS
      CGL = (BPL-(1-IA)*DXI)/2.0-XI(1)
      IF ( IE.LT.1 )  GO TO 17
      WZS = SINT(IA,M,W,DXI)
   17 IF (IE.GT.0) XNERT=TMASS*RADGRO*RADGRO
      DO 18  I=1,M
      AREA(I) = BSTAR(I)*DRAFT(I)*SECOE(I)
      Y(I) = AREA(I)*(I-1)
      W(I) = BSTAR(I)**3/12.0-AREA(I)*ZBAR(I)
      XI(I) = XI(1)-DXI*(I-1)
   18 XISQ(I) = XI(I)*XI(I)
      CDIS = SINT(IA,M,AREA,DXI)*RO
      CBL =-SINT(IA,M,Y,DXI)*DXI*RO/CDIS+(BPL-(1-IA)*DXI)/2.0
      IF ( IE.GT.0 )  GM = SINT(IA,M,W,DXI)*RO/CDIS-ZCG-CGM
      XZPERT = 0.0
      IF ( IB.EQ.0 )  GO TO 20
C-03  CALCULATE LONGITUDINAL MASS MOMENT OF INERTIA
      DO 19  I=1,M
   19 Y(I) = DMASS(I)*XISQ(I)
      YNERT = SINT(IA,M,Y,DXI)
      RADGYR = SQRT(YNERT/TMASS)
      IF ( IE.LT.1 )  GO TO 20
      ZWTC = WZS/TMASS
      DO 22 I=1,M
      ZWT(I) = ZWT(I)-ZWTC
   22 W(I) = DMASS(I)*ZWT(I)*XI(I)
      XZPERT = SINT(IA,M,W,DXI)
   20 IF (IB.GT.0) GO TO 26
      DO 25 I=1,M
      DWEIGH(I)=0.0
      ZWT(I)=0.0
   25 GRL(I)=0.0
   26 CONTINUE
C-04  PRINT OUT BASIC DATA (INCLUDING RESULTS OF PROCESSING)
      WRITE(6,920) HDA
      WRITE(6,802) IA,IB,IC,ID,IE,IF,IG,IH,II,IJ,IK,IL,N,IPLO
      IDS=ID
      ID=IABS(ID)
      WRITE(6,830)
      WRITE(6,803) BPL,DISPL,RO,GRAV
      WRITE(6,804) (STA(I),BSTAR(I),SECOE(I),DRAFT(I),ZBAR(I),DWEIGH(I),
     X            ZWT(I),GRL(I),I=1,M)
      IF ( IB.EQ.0 )  WRITE(6,806) CGL,RADGYR
      IF ( IE.GT.0 )  WRITE(6,805) ZCG,RADGRO
      IF ( IB.EQ.2 .AND. MINKRI.EQ.MAXKRI )  WRITE(6,807) MINKRI
      WRITE(6,833)
      IF ( IB.GT.0 )  WRITE(6,809) HISPL
      WRITE(6,810) CDIS,CBL
      IF ( IB.GT.0 )  WRITE(6,806) CGL,RADGYR
      IF (IE.GT.0 )  WRITE(6,808) GM,CGM
C-05  CHECK WTS., VOLUME, L.C.B. AGAINST DISPLACEMENT, L.C.G.
      IF(PDISPL.GT.1.E-3) GO TO 120
      IF ( IB.EQ.0 )  GO TO 21
      IF ( ABS(HISPL-DISPL)/DISPL .GT. 0.02 )  GO TO 950
   21 IF ( ABS(CDIS-DISPL)/DISPL .GT. 0.02)  GO TO 949
      DISPL = CDIS
      IF ( ABS(CBL-CGL)/BPL .GT. 0.005 )  GO TO 948
      RETURN
120   CONTINUE
      IF(IB.EQ.0) GO TO 121
      IF ( ABS(HISPL-DISPL)/DISPL .GT. 0.02 )  GO TO 1950
121   IF(ABS(CDIS-PDISPL)/PDISPL.GT.0.02) GO TO 1949
      RETURN
C-06  ERROR STOPS
  948 IX = IX+1
  949 IX = IX+1
  950 IX = IX+1
  951 WRITE(6,940) IX
999   CONTINUE
      STOP
1949  IX=IX+1
1950  IX=IX+1
      WRITE(6,940) IX
      STOP
107   FORMAT(8F6.3)
108   FORMAT(6A4,3I2)
109   FORMAT(20A4)
110   FORMAT(10F8.0)
111   FORMAT(10F8.0)
209   FORMAT(' INDATA FR]N SKIVA:'//1X,20A4)
210   FORMAT(/' H00  =',10(F8.5,1X)/)
211   FORMAT(' HCH0 =',10(F8.5,1X)/)
212   FORMAT(' GAMMA=',10(F8.5,1X)/)
213   FORMAT(' PPER =',10(F8.5,1X)/)
214   FORMAT(' SUMMA PPER AVVIKER MED MER [N 0.1% !',2X,'SUMPPER=',F8.5)
215   FORMAT(' INDATA FR]N HYDROSTATPROGRAMMET   '/1X,6A4/5X,'ANTAL DJUP
     CG]ENDE ',I2,5X,'ANTAL SPANT  (F\R) - ',I2,' (AKTER) - ',I2/)
219   FORMAT(' INDATA FR]N KORT:'//1X,20A4)
600   FORMAT(' DJUPG]ENDE    ',4(2(F6.3,2X),5X))
  802 FORMAT(1X,'OPTION CONTROL TAGS -  A  B  C  D  E',
     *       2X,'F  G  H  I  J  K  L',23X,'O'/
     *       22X,12I3,2X,'NO. OF STATIONS=',2I3)
  803 FORMAT(1X,'LENGTH  =',F10.3,' M'/
     *       1X,'DISPL.  =',F10.1,' TON'/
     *       1X,'DENSITY =',F10.5,' TON/M**3'/
     *       1X,'GRAVITY =',F10.5,' M/SEC**2'/)
  804 FORMAT(1X,'STATION   BEAM   AREA.COEF.  DRAFT',
     *       3X,'Z-BAR    WEIGHT     ZETA   GYR.ROLL'/
     *       11X,'(M)',7X,'(-)',7X,'(M)',5X,'(M)',6X,'(TON)',
     *       5X,'(M)',6X,'(M)'/(2X,F5.2,3(F9.3,1X),F7.3,F10.1,
     *       1X,2F8.3))
  805 FORMAT ( 1H0,'VERT. C.G.',10X,'=',F10.3,'  M  (ABOVE WATERLINE)'/
     X1X,'GYRADIUS (ROLL)     =',F10.3,'  M')
  806 FORMAT (/1X,'LONG. C.G.',10X,'=',F10.3,'  M  (FWD OF MIDSHIPS)'/
     X1X,'GYRADIUS (PITCH)    =',F10.3,'  M')
  807 FORMAT ( 1X, 28HCALCULATE MOMENTS AT STATION , I3 )
  808 FORMAT ( 1X,'METACENTRIC HEIGHT  =',F10.3,'  M',2X,
     B        '(CORRECTION FOR FREE FLUIDS =',F6.3,' M)')
  809 FORMAT ( 1X,'DISPL. (WEIGHT)     =',F10.1,'  TON')
  810 FORMAT ( 1X,'DISPL. (VOLUME)     =',F10.1,'  TON',/
     X1X,'LONG. C.B.',10X,'=',F10.3,'  M  (FWD OF MIDSHIPS)')
  830 FORMAT(1X,'BASIC INPUT DATA'/)
  833 FORMAT ( 1X,'DERIVED RESULTS:')
  901 FORMAT ( 20A4)
  902 FORMAT(17I2)
  903 FORMAT ( 10X,F10.3,2F10.5,2F10.1)
  904 FORMAT ( 4F10.3)
  905 FORMAT(10X,3F10.5)
  906 FORMAT ( 4I10)
907   FORMAT(A4)
  920 FORMAT (1H1,20A4)
  940 FORMAT ( 39H0STOP IN SUBROUTINE PRELIMB.  ERROR NO. , I3)
      END
      SUBROUTINE ZIPSMO (DET)
      COMMON / TDR / NS,SBH(21),SBBB(21)
      COMMON /   / TDP(21,25,10)
      COMMON / PIN / PSERH(25,10),QSERH(25,10),PSERS(25,10),QSERS(25,10)
     X              ,PSERR(25,10),QSERR(25,10),AXO(10),AYO(10),NSTA
      COMMON / PROGRA / STORAG(197),DDT,
     *                  CO(11),SI(11),COP(11),SIP(11),SIKI(4,5),
     *                  SIKJ(4,4),SSB(11),SPB(11),SDB(11),SSA(11),
     *                  SPA(11),SDA(11),EPA(5,5),EQA(5),EPB(5),
     *                  B1(10,11),EPX(5),EQX(5),SMINNE(102)
      DIMENSION F2M(10,10),P(10),Q(10)
      DIMENSION     OMT(25)
      DATA NF / 25 /
      DATA OMT / 0.0, 0.01, 0.03, 0.06, 0.10, 0.15, 0.21, 0.28, 0.36,
     X           0.45, 0.55, 0.67, 0.82, 1.01, 1.25, 1.55, 1.95, 2.45,
     X           3.05, 3.8, 4.7, 5.8, 7.1, 8.7, 10.7 /
      DET = 1.0
C-01  SET UP TRIGONOMETRIC FUNCTIONS
      DO 1 I=1,11
      XI=I-1
      CO(I)=COS(XI*0.157078)
      SI(I)=SIN(XI*0.157078)
      COP(I)=COS(XI*0.471234)
    1 SIP(I)=SIN(XI*0.471234)
      DO 2 K=1,4
      AK = K*2
      AK = AK*0.157078
      DO 6 I=1,5
      AI=I-1
    6 SIKI(K,I)=SIN( AK*(2.0*AI+1.0))
      DO 7 J=1,4
      AJ=J
    7 SIKJ(K,J)=SIN( AK*2.0*AJ)
    2 CONTINUE
C-02  LOOP OVER NUMBER OF STATIONS
      DO 1005 K1=1,NS
      IF ( K1 .EQ. 1 )  GO TO 85
C-03  CHECK FOR CONSTANT SECTION PARAMETERS
      KK = K1-1
      IF ( SBBB(K1).NE.SBBB(KK))  GO TO 85
      IF ( SBH(K1).NE.SBH(KK) )  GO TO 85
      IF (K1.EQ.NSTA) GO TO 85
      DO 80  IF =1,NF
      TDP(K1,IF,1) = TDP(KK,IF,1)
   80 TDP(K1,IF,2) = TDP(KK,IF,2)
      GO TO 1005
C-04  CHECK FOR ZERO SECTION
   85 IF ( SBBB(K1).LE.0.0 .OR. SBH(K1).LE.0.0 )  GO TO 88
      SAN=3.14159+(SBBB(K1)*4.0-3.14159)*SBH(K1)/
     1((SBH(K1)+1.0)*(SBH(K1)+1.0))
      SWA=5.55165-1.57078*SAN
      IF (SWA) 11,12,12
   11 WRITE (6,120)  K1
  120 FORMAT(47H0INCORRECT PARAMETERS, ZIPSMO QUITS FOR STATION ,I3)
      DET = 0.0
      GO TO 1005
   12 SAZ=2.35619+SQRT(SWA)
      SA=(SBH(K1)-1.0)/(SBH(K1)+1.0)*SAZ/SAN
      SB=SAZ/SAN-1.0
      SAA=SA*SA+3.0*SB
      SAAA=SA*SAA+3.0*SA*SB
      SAZ=-(1.0+SA)*(0.33333+0.06667*SA+0.02857*SAA+0.01587*SAAA)
     X+9.0*SB*(0.2-0.14286*SA-0.03704*SAA-0.01818*SAAA)
      SAN=-(1.0+SA)*(0.06667+0.02857*SA+0.01587*SAA)-9.0*SB
     1*(0.14286+0.03704*SA+0.01818*SAA)
      SF3=-(1.0+SA)*(0.02857+0.01587*SA)-9.0*SB*(0.03704+0.01818*SA)
      SF4=-(1.0+SA)*0.01587-9.0*SB*0.01818
C-05  LOOP OVER FREQUENCY RANGE
   88 DO 1004  IF=1,NF
      SFRPA = OMT(IF)*SBH(K1)
      IF ( SFRPA .GT. 0.0)  GO TO 3
      SAR = 0.0
      SC = 0.0
      GO TO 1003
    3 SW=SFRPA        /(1.0+SA+SB)
      SF1 = SAZ-0.78540*SW*(1.0+SA)
      SF2 = SAN-0.78540*SW*SB
      SSB0=3.14159*SIN(SFRPA)
      DO 15 I=1,11
      BI=I-1
      XX = SW*((1.0+SA)*CO(I)+SB*COP(I))
      YY = SW*((1.0-SA)*SI(I)-SB*SIP(I))
      IF (K1.NE.NSTA.OR.I.EQ.11) GO TO 5
      KN=11-I
      AXO(KN)=XX/SFRPA
      AYO(KN)=YY/SFRPA
    5 EHY=EXP(-YY)
      CX=COS(XX)
      SIX=SIN(XX)
      SSB(I)=3.14159*SIX*EHY
      SPB(I)=3.14159*CX*EHY
      SDB(I)=SSB(I)-SSB0*(1.0-BI*0.1)
      BA=SQRT(XX*XX+YY*YY)
      BB1 = BA
      IF (ABS(YY) .GT. 0.1E-5)  GO TO 13
      BC=1.5708
      GO TO 16
   13 BC=ASIN(XX/BA)
   16 BD=0
      BE=0
      COBC2=COS(BC)
      COBC=COBC2
      SIBC2=SIN(BC)
      SIBC=SIBC2
      IF (BA .GT. 6.0)  GO TO 17
      AMM = 2.0
   20 BD=BD+BB1*COBC2
      BE=BE-BB1*SIBC2
      BB1=BB1*BA*(AMM-1.0)/(AMM*AMM)
      COBC1=COBC2*COBC-SIBC2*SIBC
      SIBC2=SIBC2*COBC+SIBC*COBC2
      COBC2=COBC1
      AMM=AMM+1.0
      IF((BB1)-(0.001*BA)) 21,21,20
   21 BD=(-BD-ALOG(1.781*BA))*EHY
      BE=(-BE+BC)*EHY
      GA=BD*CX-BE*SIX
      GB=BE*CX+BD*SIX
      GO TO 1000
   17 BB1=1.0/BB1
      DO 22 MM=1,5
      AMM=MM
      BD=BD-COBC2*BB1
      BE=BE-SIBC2*BB1
      BB1=BB1*AMM/BA
      COBC1=COBC2*COBC-SIBC2*SIBC
      SIBC2=SIBC2*COBC+SIBC*COBC2
      COBC2=COBC1
   22 CONTINUE
      GA=BD-3.141592652*EHY*SIX
      GB=BE+3.141592652*EHY*CX
 1000 SSA(I)=-GB
      SPA(I)=-GA
   15 CONTINUE
      SSA0=SSA(1)
      SFP1=0
      SFQ1=0
      SQ=-0.05236
      DO 25 I=2,11
      AI=I
      SDA(I)=SSA(I)-SSA0*(1.0-(AI-1.0)/10.0)
      SQ=-SQ
      SFM=((1.0+SA)*SI(I)+3.0*SB*SIP(I))*(0.157078+SQ)
      SFQ1=SFQ1+SPB(I)*SFM
      SFP1=SFP1+SPA(I)*SFM
   25 CONTINUE
      SFQ1=SFQ1-0.5*SPB(11)*SFM
      SFP1=SFP1-0.5*SPA(11)*SFM
      EPA(1,1)=SSA0
      EQA(1)  =SSB0
      DO 27 K=1,4
      KK=K+1
      S1B=0
      S2B=0
      S1A=0
      S2A=0
      DO 28 J=1,5
      ISUB=2*J
      S1A=S1A+SDA(ISUB)*SIKI(K,J)
      S1B=S1B+SDB(ISUB)*SIKI(K,J)
   28 CONTINUE
      DO 29 J=1,4
      ISUB=2*J+1
      S2B=S2B+SDB(ISUB)*SIKJ(K,J)
      S2A=S2A+SDA(ISUB)*SIKJ(K,J)
   29 CONTINUE
      EQA(KK)  =0.266667*S1B+0.133333*S2B
   27 EPA(KK,1)=0.266667*S1A+0.133333*S2A
      EPA(1,2)=-SW
      EPA(2,2)=-1.0-0.21221*SW
      EPA(3,2)=-SA-0.02122*SW
      EPA(4,2)=-SAA-0.00606*SW
      EPA(5,2)=-SAAA-0.00253*SW
      EPA(1,3)=-0.333333*SW
      EPA(2,3)=+0.38197*SW
      EPA(3,3)=-1.0-0.13642*SW
      EPA(4,3)=-SA-0.02358*SW
      EPA(5,3)=-SAA-0.00868*SW
      EPA(1,4)=-0.20*SW
      EPA(2,4)=0.15158*SW
      EPA(3,4)=0.17684*SW
      EPA(4,4)=-1.0-0.09646*SW
      EPA(5,4)=-SA-0.02040*SW
      EPA(1,5)=-0.1429*SW
      EPA(2,5)=0.09903*SW
      EPA(3,5)=0.06752*SW
      EPA(4,5)=0.11427*SW
      EPA(5,5)=-1.0-0.07428*SW
      EPB(1)=1.0+SA+SB
      EPB(2)=0.63662*(0.333333*(1.0+SA)-1.80*SB)
      EPB(3)=0.31831*(0.06667+0.06667*SA+1.28571*SB)
      EPB(4)=0.63662*(0.00952+0.00952*SA+0.11111*SB)
      EPB(5)=0.31831*(0.00793+0.00793*SA+0.08182*SB)
      DO 100 I=1,5
      DO 101 J=1,5
  101 B1(I,J) = EPA(I,J)
      B1(I,6) = -EQA(I)
      DO 107 J=7,10
  107 B1(I,J) = -0.0
  100 B1(I,11) = EPB(I)
      DO 105 I=6,10
      IJ = I-5
      B1(I,1) = EQA(IJ)
      DO 104 J=2,5
  104 B1(I,J) = 0.0
      DO 106 J=6,10
      JJ = J-5
  106 B1(I,J) = EPA(IJ,JJ)
  105 B1(I,11) = 0.0
C-06  CALL MATPAC
      CALL MATPAC
      IF (DDT.EQ.0.0)  DET = 0.0
      DO 35 I=1,5
      EPX(I) = B1(I,11)
   35 EQX(I) = B1(I+5,11)
      SPF=EPX(1)*SFP1-EQX(1)*SFQ1+EPX(2)*SF1+EPX(3)*SF2
     1+EPX(4)*SF3+EPX(5)*SF4
      SC=SPF/(0.7854*(1.0+SA+SB)*(1.0+SA+SB))
      SAR=3.14159*SW*SQRT(EPX(1)*EPX(1)+EQX(1)*EQX(1))
C-07  COMBINE TERMS FOR VERTICAL HYDRODYNAMIC PRESSURE CALCULATION
      IF (K1.NE.NSTA) GO TO 40
      HO=SBH(K1)
      SIG=SBBB(K1)
C     CALC. A1 , A3
      PI=3.14159
      XA=1.0+HO
      XB=XA*XA
      XC=1.0-HO
      XN=XC*XC
      BB=XN/XB
      CC=16.0*SIG*HO/(PI*XB)
      AA=CC+BB+3.0
      BB=2.0*(BB+CC)
      CC=CC-4.0*HO/XB
      A3=(-BB+SQRT(BB*BB-4.0*AA*CC))/(2.0*AA)
      A1=-XC*(1.0+A3)/XA
C     CALC. P-2M AND Q-2M
      DO 41 I=2,10
      AN1=11-I
      TET=0.157078*AN1
      F2M(I,1)=0.0
      F2M(1,I)=0.0
      B1(I,1)=0.0
      B1(1,I)=0.0
      DO 42 K=2,10
      DM=2*K-2
      L=K-1
      F2M(I,K)=-(SIN(DM*TET)+SFRPA/(1.0+A1+A3)*(SIN((DM-1.0)*TET)/(DM-
     X   1.0)+A1*SIN((DM+1.0)*TET)/(DM+1.0)-3.0*A3*SIN((DM+3.0)*TET)/
     X   (DM+3.0))+((-1.0)**L)*SFRPA/((1.0+A1+A3)**2)*(1.0/(DM-1.0)-A1/
     X   (DM+1.0)-3.0*A3/(DM+3.0))*(SIN(TET)+A1*SIN(TET)-A3*SIN(3.0*TET)
     X   ))
   42 B1(I,K)=F2M(I,K)
   41 B1(I,11)=SSB(I)-SSB(1)*(SIN(TET)+A1*SIN(TET)-A3*SIN(3.0*TET))/
     X   (1.0+A1+A3)
      F2M(1,1)=1.0
      B1(1,1)=1.0
      B1(1,11)=0.0
      CALL MATPAC
      DO 43 I=1,9
   43 P(I)=B1(I+1,11)
      DO 44 I=1,10
      AN1=11-I
      TET=0.157078*AN1
      DO 45 K=1,10
   45 B1(I,K)=F2M(I,K)
   44 B1(I,11)=SSA(I)-SSA(1)*(SIN(TET)+A1*SIN(TET)-A3*SIN(3.0*TET))/
     X   (1.0+A1+A3)
      CALL MATPAC
      DO 46 I=1,9
   46 Q(I)=B1(I+1,11)
C     CALC. A0 AND B0
      A0=0.0
      B0=0.0
      DO 47 I=1,9
      DM=I*2
      AA0=P(I)*((-1.0)**(I-1))*SFRPA/(1.0+A1+A3)*(1.0/(DM-1.0)-A1/(DM+
     X    1.0)-3.0*A3/(DM+3.0))
      A0=A0+AA0
      BB0=Q(I)*((-1.0)**(I-1))*SFRPA/(1.0+A1+A3)*(1.0/(DM-1.0)-A1/(DM+
     X    1.0)-3.0*A3/(DM+3.0))
   47 B0=B0+BB0
      A0=A0+SSB(1)
      B0=B0+SSA(1)
C     CALC. PRESSURE TERMS
      DELTA=ATAN2( A0, B0)
      DO 48 I=1,10
      AN1=11-I
      TET=0.157078*AN1
      PTH=0.0
      QTH=0.0
      DO 49 J=1,9
      DM=2*J
      SERIE= COS(DM*TET)+SFRPA/(1.0+A1+A3)*(COS((DM-1.0)*TET)/(DM-1.0)+
     X  A1*COS((DM+1.0)*TET)/(DM+1.0)-3.0*A3*COS((DM+3.0)*TET)/(DM+3.0))
      PTH=PTH+SERIE*P(J)
   49 QTH=QTH+SERIE*Q(J)
      PTH=PTH+SPB(I)
      QTH=QTH+SPA(I)
      PTH=PTH*SFRPA/SQRT(A0*A0+B0*B0)
      QTH=QTH*SFRPA/SQRT(A0*A0+B0*B0)
      K=11-I
      PSERH(IF,K)= PTH*COS(DELTA)-QTH*SIN(DELTA)
      QSERH(IF,K)= PTH*SIN(DELTA)+QTH*COS(DELTA)
      PSERH(1,K)=0.0
      QSERH(1,K)=0.0
   48 CONTINUE
   40 CONTINUE
C-08  STORE RESULTS IN TDP ARRAY
 1003 TDP(K1,IF,1) = SC
 1004 TDP(K1,IF,2) = SAR*SAR
 1005 CONTINUE
      RETURN
      END
      SUBROUTINE MATPAC
      COMMON / PROGRA / STORAG(197),DET,SPACE(181),A(10,11),SPACX(112)
      DET=1.
      DO 4 J=1,9
      C=ABS(A(J,J))
      JP1=J+1
      DO 5 I=JP1,10
      D=ABS(A(I,J))
      IF (C-D) 6,5,5
    6 DET=-DET
      DO 7 K=J,11
      B=A(I,K)
      A(I,K)=A(J,K)
    7 A(J,K)=B
      C=D
    5 CONTINUE
      IF(ABS(A(J,J))) 20,20,15
   15 DO 4 I=JP1,10
      CONST=A(I,J)/A(J,J)
      DO 4 K=JP1,11
    4 A(I,K)=A(I,K)-CONST*A(J,K)
      IF(ABS(A(10,10))) 20,20,18
   18 DO 12 I=1,10
      K=11-I
      KP1=K+1
      S=0.0
      DO 13 J=KP1,10
   13 S=S+A(K,J)*A(J,11)
   12 A(K,11)=(A(K,11)-S)/A(K,K)
   22 RETURN
C-01  PRINT WARNING MESSAGE
   20 WRITE (6,30)
      DET=0
      GO TO 22
   30 FORMAT(34H0ZERO DETERMINANT IN SUBR. MATPAC )
      END
      SUBROUTINE TDLR (DET)
C     THIS SUBROUTINE PERFORMS THE CALCULATION OF THE POTENTIAL THEORY
C     ADDED MASS AND WAVE DAMPING PROPERTIES OF TWO-DIMENSIONEL LEWIS
C     FORMS IN LATERAL AND ROLL MOTION MODES. THE METHOD EMPLOYED IS
C     THAT OF FUKUZO TASAI, *HYDRODYNAMIC FORCE AND MOMENT PRODUCED BY
C     SWAYING AND ROLLING OSCILLATION OF CYLINDERS ON THE FREE SURFACE*,
C     IN REPORTS OF RESEARCH INSTITUTE FOR APPLIED MECHANICS, KYUCHU
C     UNIVERSITY, JAPAN, VOLUME IX, NUMBER 35, 1961.
C     SEE ALSO REPORT BY J. H. VUGTS, *THE HYDRODYNAMIC COEFFICIENTS FOR
C     SWAYING, HEAVING AND ROLLING CYLINDERS IN A FREE SURFACE*, REPORT
C     NO. 194 (IN ENGLISH) OF LABORATORIUM VOOR SCHEEPSBOUWKUNDE,
C     TECHNISCHE HOGESCOOL DELFT, THE NETHERLANDS, JANUARY 1968.
C     FEBRUARY 1970 -  OCEANICS, INC.  -  A. I. RAFF
C                   - PROJECT NO. 1093 (SSC-SRC PROJECT SR-174).
C
C     BASIC INPUT AND OUTPUT VARIABLES
C     HO = HALF-BREADTH TO DRAFT RATIO
C     SIG = SECTION AREA COEFFICIENT
C     XIB = NON DIMENSIONAL FREQUENCY PARAMETER (OMEGA-SQUARED OVER
C          GRAVITY, TIMES HALF-BREADTH)
C     R(I) = ADDED MASS AND DAMPING RESULTANT ARRAY IN NON-DIMENSIONAL
C            FORM ( AS IN VUGTS, ABOVE )
C     M = NO. OF TERMS IN P AND Q (POLYNOMIAL) SERIES (SET =9)
C     N = NO. OF POINTS ON CONTOUR FOR LEAST SQUARE FIT (SET = 9)
C     N1 = NO. OF INTERVALS FOR N,SUB-0 AND X,SUB-R INTEGRATION (N1=N+1)
      COMMON / TDR / NS,SBH(21),SBBB(21)
      COMMON /   / TDP(21,25,10)
      COMMON / PIN / PSERH(25,10),QSERH(25,10),PSERS(25,10),QSERS(25,10)
     X              ,PSERR(25,10),QSERR(25,10),AXO(10),AYO(10),NSTA
      COMMON / PROGRA / STORAG(69),A(15,10),Y(16),Y1(16),R(8),S(9,10),
     *                  COEFF1(16),COEFF2(16),SEC1(9),SEC2(9),PCO(16),
     *                  PSO(16),Z(9),Z1(9),XS(16),YS(16),P(9),Q(9),
     *                  SMINNE(102)
      DIMENSION     OMT(25)
      DIMENSION ERM(30)
      DATA NF / 25 /
      DATA OMT / 0.0, 0.01, 0.03, 0.06, 0.10, 0.15, 0.21, 0.28, 0.36,
     X           0.45, 0.55, 0.67, 0.82, 1.01, 1.25, 1.55, 1.95, 2.45,
     X           3.05, 3.8, 4.7, 5.8, 7.1, 8.7, 10.7 /
      DATA  ERM /3HNEG,3HATI,3HVE ,3HCON,3HTOU,3HR  ,
     X           3HILL,3H-BE,3HHAV,3HED ,3HMAT,3HRIX,
     X           3HA1 ,3H+ A,3H3 C,3HALC,3H ER,3HROR,
     X           3HNEG,3HATI,3HVE ,3HFRE,3HQUE,3HNCY,
     X           3HENE,3HRGY,3H VA,3HL. ,3HERR,3HOR /
      PI=3.1415927
      DET=1.0
      IX=0
C-01  LOOP OVER NUMBER OF STATIONS
      DO 105 K1=1,NS
      HO=SBH(K1)
      SIG=SBBB(K1)
      IF (K1.EQ.1) GO TO 85
C-02  CHECK FOR CONSTANT SECTION PARAMETERS
      KK=K1-1
      IF (SBBB(K1).NE.SBBB(KK)) GO TO 85
      IF (SBH(K1).NE.SBH(KK)) GO TO 85
      IF (K1.EQ.NSTA) GO TO 85
      DO 80 IF=1,NF
      DO 80 J=3,10
   80 TDP(K1,IF,J)=TDP(KK,IF,J)
      GO TO 105
C-03  CHECK FOR ZERO SECTION
   85 IF (SIG.GT.0.0.AND.HO.GT.0.0) GO TO 88
      DO 86 IF=1,NF
      DO 86 J=3,10
   86 TDP(K1,IF,J)=0.0
      GO TO 105
C-04  COMPUTE GEOMETRIC PARAMETERS A,SUB-1 AND A,SUB-3
   88 XA=1.0+HO
      XB=XA*XA
      XC=1.0-HO
      XN=XC*XC
      BB=XN/XB
      CC=16.*SIG*HO/(PI*XB)
      AA=CC+BB+3.
      BB=2.*(BB+CC)
      CC=CC-4.0*HO/XB
      A3=(-BB+SQRT(BB*BB-4.*AA*CC))/(2.*AA)
      A1=-XC*(1.0+A3)/XA
      A13=1.+A1+A3
      AA13=A13*A13
      TA3=3.0*A3
C-05  CHECK THE RESULT
      IF (ABS(HO-A13/(1.0-A1+A3)).GT.10.E-3) GO TO 29
      IF (ABS(SIG-PI*HO*(1.0-A1*A1-TA3*A3)/(4.0*AA13)).LE.10.E-3)
     X   GO TO 30
C-06  ERROR RETURN
   29 IX=2
   90 IX=IX+1
      WRITE(6,97) ERM(6*IX-5),ERM(6*IX-4),ERM(6*IX-3),ERM(6*IX-2),ERM(6*
     XIX-1),ERM(6*IX),HO,SIG,XIB
      DET=0.0
      IX=0
      GO TO 105
C-07  SET UP VARIOUS CONSTANT FACTORS
   30 N=9
      N1=N+1
      FAC=N1
      PN=PI/(2.0*FAC)
      CC=PN/3.0
      MM=2
      M=9
      MP=M+1
      CONST1=-TA3*PI/4.0
C-08  CALCULATE FUNCTIONS OF THETA AROUND SECTION CONTOUR
      DO 32 I=1,N1
      FAC=I
      SS=PN*FAC
      CSS=COS(SS)
      CTS=COS(3.*SS)
      SSS=SIN(SS)
      STS=SIN(3.*SS)
      XO=((1.+A1)*SSS-A3*STS)/A13
      YO=((1.-A1)*CSS+A3*CTS)/A13
      IF (ABS(XO).LT.10.E-6) XO=0.0
      IF (ABS(YO).LT.10.E-6) YO=0.0
      IF (K1.NE.NSTA) GO TO 38
      AXO(I)=XO
      AYO(I)=YO
   38 IF (XO.LT.0.0.OR.YO.LT.0.0) GO TO 90
      XS(I)=XO
      YS(I)=YO
      COEFF1(I)=(1.-A1)*SSS+TA3*STS
      COEFF2(I)=(1.+A3)*A1*SIN(2.*SS)-2.*A3*SIN(4.*SS)
C-09  CALCULATE P,SUB-O COEFFICIENTS FOR SWAY AND ROLL
      IF (I.EQ.N1) GO TO 32
      A(I,1)=YO
      A(I,MP)=XO*XO+YO*YO-1.0
   32 CONTINUE
C-10  LOOP OVER FREQUENCY RANGE
      DO 104 IF=1,NF
      XIB=OMT(IF)*HO
      IF (XIB) 95,70,31
   31 CONST2=PI*XIB/8.0
C-11  CALCULATE STREAM AND POTENTIAL FUNCTIONS
      DO 40 I=1,N1
      XO=XS(I)
      YO=YS(I)
      XX=XO*XO+YO*YO
      XK=XIB*XO
      SXK=SIN(XK)
      CXK=COS(XK)
      EKY=EXP(-XIB*YO)
C-12  CALCULATE Q AND S SERIES FOR WAVE INTEGRAL APPROXIMATIONS
      IF (YO.GT.0.0000001) GO TO 33
      XI=PI/2.0
      GO TO 34
   33 XI=ATAN2(XO,YO)
   34 XA=XIB*SQRT(XX)
      XB=XA
      XC=XA
      XN=1.0
      QQ=0.5772156649+ALOG(XA)
      PS=XI
      CSS=COS(XI)
      SSS=SIN(XI)
      CTS=CSS
      STS=SSS
   36 QQ=QQ+XA*CTS
      PS=PS+XA*STS
      XN=XN+1.0
      XB=XB*XC/XN
      XA=XB/XN
      IF (XA.LT.10.0E-7) GO TO 37
      XI=CSS*CTS-SSS*STS
      STS=SSS*CTS+CSS*STS
      CTS=XI
      GO TO 36
C-13  WAVE INTEGRAL APPROXIMATIONS
   37 XA=EKY*(QQ*CXK+(PS-PI)*SXK)
      XB=EKY*(QQ*SXK-(PS-PI)*CXK)
C-14  COMBINE TERMS FOR PSI AND PHI
      XX=XX*XIB
      EKY=EKY*PI
      Y(I)=EKY*CXK
      Y1(I)=EKY*SXK+XA-YO/XX
      PCO(I)=-EKY*SXK
      PSO(I)=EKY*CXK-XB+XO/XX
   40 CONTINUE
C-15  COMPUTE INTEGRALS FOR N,SUB-O AND X,SUB-R EVALUATIONS
      XA=PCO(N1)*COEFF1(N1)
      XB=PSO(N1)*COEFF1(N1)
      XC=PCO(N1)*COEFF2(N1)
      XN=PSO(N1)*COEFF2(N1)
      PP=-1.0
      DO 45 I=1,N
      PP=-PP
      PQ=3.0+PP
      XA=XA+PQ*PCO(I)*COEFF1(I)
      XB=XB+PQ*PSO(I)*COEFF1(I)
      XC=XC+PQ*PCO(I)*COEFF2(I)
      XN=XN+PQ*PSO(I)*COEFF2(I)
      Y(I)=Y(I)-Y(N1)
   45 Y1(I)=Y1(I)-Y1(N1)
C-16  DETERMINE ALL COEFFICIENTS OF P AND Q SERIES
      DO 55 I=1,N
      FAC=I
      SS=PN*FAC
      AA=+1.0
      PR=COS(SS)
      PS=2.0*PR*PR-1.0
      YR=PS
      PQ=2.0*PS*PS-1.0
      XI=SIN(SS)
      XX=2.0*XI*PR
      XR=XX
      XK=2.0*XX*PS
      QQ=0.0
      DO 50 J=MM,M
      QQ=QQ+2.0
      SXK=A1/(QQ+2.0)
      CXK=TA3/(QQ+4.0)
      BB=YR*PR-XR*XI
      PP=PQ*PS-XK*XX
      A(I,J)=BB+(XIB/A13)*(YR/QQ+PQ*SXK-PP*CXK+AA*(1.0/QQ-SXK-CXK))
      YR=PQ
      PQ=PP
      XR=XK
      XK=XR*PS+YR*XX
      IF (I.NE.N) GO TO 50
      EP=QQ*QQ
      EQ=(QQ+2.0)*(QQ+2.0)
      ER=(QQ+4.0)*(QQ+4.0)
      ES=(QQ+1.0)*(QQ+1.0)
      SEC1(J)=XIB*AA*((1.0/(EP-1.0)-A1/(EQ-1.0)-TA3/(ER-1.0))*
     X       (1.0-A1)+TA3*(-1.0/(EP-9.0)+A1/(EQ-9.0)+TA3/(ER-9.0)))
      SEC2(J)=AA*(2.0*A1*(1.0+A3)/(ES-4.0)+8.0*A3/(ES-16.0))
   50 AA=-AA
   55 CONTINUE
C-17  SOLVE SIMULTANEOUS EQUATIONS FOR P AND Q SERIES.
C     FORM M BY M COEFFICIENT MATRIX BY LEAST SQUARES METHOD
   62 DO 7 I=1,M
      DO 7 J=I,M
      S(I,J)=0.0
      DO 9 K=1,N
    9 S(I,J)=S(I,J)+A(K,I)*A(K,J)
    7 S(J,I)=S(I,J)
C-17  FORM R.H.S (M VECTOR) BY LEAST SQUARES METHOD
      DO 4 I=1,M
      Z(I)=0.
      Z1(I)=0.
      DO 4 J=1,N
      Z(I)=Z(I)+A(J,I)*Y(J)
    4 Z1(I)=Z1(I)+A(J,I)*Y1(J)
C-17  INVERT COEFFICIENT MATRIX, IT REPLACES ORGINAL MATRIX
      DO 10 I=1,M
      DO 5 J=1,M
    5 S(J,MP)=0.0
      S(I,MP)=1.0
      DIV=S(I,I)
      IF (ABS(DIV).LT.10.E-16) GO TO 92
      DO 6 J=1,MP
    6 S(I,J)=S(I,J)/DIV
      DO 2 J=1,M
      IF (I.EQ.J) GO TO 2
      FAC=S(J,I)
      DO 3 K=1,MP
    3 S(J,K)=S(J,K)-S(I,K)*FAC
    2 CONTINUE
      DO 8 J=1,M
    8 S(J,I)=S(J,MP)
   10 CONTINUE
C-17  CALCULATE P,SUB-2M AND Q,SUB-2M SERIES
      DO 11 I=1,M
      P(I)=0.0
      Q(I)=0.0
      DO 11 J=1,M
      P(I)=P(I)+S(I,J)*Z(J)
   11 Q(I)=Q(I)+S(I,J)*Z1(J)
C-17  COMBINE TERMS FOR LATERAL HYDRODYNAMIC PRESSURE CALCULATION
      IF (K1.NE.NSTA) GO TO 12
      IF (MM.EQ.2)     EPSS=ATAN2(-P(1),-Q(1))
      IF (MM.EQ.1)     EPSR=ATAN2( P(1),Q(1))
      DO 15 I=1,N1
      AN1=I
      BN1=N1
      TET=PI*AN1/(2.0*BN1)
      IF (MM.EQ.1) GO TO 14
      PTS=0.0
      QTS=0.0
      GO TO 13
   14 PTR=0.0
      QTR=0.0
   13 CONTINUE
      DO 16 J=2,M
      DM=J-1
      SERIE  = SIN((2.0*DM+1.0)*TET)+XIB/A13*(SIN(2.0*DM*TET)/(2.0*DM)+
     X A1/(2.0*DM+2.0)*SIN((2.0*DM+2.0)*TET)-3.0*A3/(2.0*DM+4.0)*
     X SIN((2.0*DM+4.0)*TET))
      IF (MM.EQ.1) GO TO 17
      PTS=PTS+SERIE*P(J)
      QTS=QTS+SERIE*Q(J)
      GO TO 16
   17 PTR=PTR+SERIE*P(J)
      QTR=QTR+SERIE*Q(J)
   16 CONTINUE
      IF (MM.EQ.1) GO TO 18
      PTS=PTS+PCO(I)
      QTS=QTS+PSO(I)
      PTS=PTS*XIB/SQRT(P(1)*P(1)+Q(1)*Q(1))
      QTS=QTS*XIB/SQRT(P(1)*P(1)+Q(1)*Q(1))
      PSERS(IF,I)= PTS*COS(EPSS)-QTS*SIN(EPSS)
      QSERS(IF,I)= PTS*SIN(EPSS)+QTS*COS(EPSS)
      GO TO 15
   18 PTR=PTR+PCO(I)
      QTR=QTR+PSO(I)
      PTR=PTR*XIB/2.0/SQRT(P(1)*P(1)+Q(1)*Q(1))
      QTR=QTR*XIB/2.0/SQRT(P(1)*P(1)+Q(1)*Q(1))
      PSERR(IF,I)= PTR*COS(EPSR)-QTR*SIN(EPSR)
      QSERR(IF,I)= PTR*SIN(EPSR)+QTR*COS(EPSR)
   15 CONTINUE
   12 CONTINUE
C-18  CALCULATE N,SUB-O, M,SUB-O, X,SUB-R AND Y,SUB-R
      PP=0.0
      PQ=0.0
      PR=0.0
      PS=0.0
      DO 64 J=2,M
      PP=PP+P(J)*SEC1(J)
      PQ=PQ+Q(J)*SEC1(J)
      PR=PR+P(J)*SEC2(J)
   64 PS=PS+Q(J)*SEC2(J)
      FNO=(-XA*CC+CONST1*P(2))/A13-PP/AA13
      FMO=(-XB*CC+CONST1*Q(2))/A13-PQ/AA13
      XR=(XC*CC+CONST2*(A1*P(2)-A3*P(3))+PR)/AA13
      YR=(XN*CC+CONST2*(A1*Q(2)-A3*Q(3))+PS)/AA13
C-19  COMBINE TERMS FOR FINAL RESULTS
      IF(ABS(P(1)).LT.1.E10.AND.ABS(Q(1)).LT.1.E10) GO TO 39
      IF(Q(1).GT.1.E20) Q(1)=1.E20
      IF(Q(1).LT.-1.E20) Q(1)=-1.E20
39    PP=P(1)*P(1)+Q(1)*Q(1)
      QQ=FMO*P(1)-FNO*Q(1)
      IF(FMO.GT.1.E10) FMO=1.E10
      IF(FMO.LT.-1.E10) FMO=-1.E10
      PQ=FNO*P(1)+FMO*Q(1)
      IF(ABS(XR).LT.1.E10.AND.ABS(YR).LT.1.E10) GO TO 41
      IF(XR.LT.-1.E10) XR=-1.E10
      IF(XR.GT.1.E10) XR=1.E10
      IF(YR.LT.-1.E10) YR=-1.E10
      IF(YR.GT.1.E10) YR=1.E10
41    PR=XR*P(1)+YR*Q(1)
      PS=YR*P(1)-XR*Q(1)
      IF (MM.EQ.1) GO TO 67
C-20  SWAY RESULTS
      XX=ABS(QQ*2.0/(PI*PI)-1.0)
      IF (XX.LT.0.0250) GO TO 65
      IF (ABS(QQ-4.9348)/AMAX1(ABS(FMO*P(1)),ABS(FNO*Q(1))).GT.0.10)
     X IX=1
      ALVAR=ABS(QQ-4.9348)/AMAX1(ABS(FMO*P(1)),ABS(FNO*Q(1)))
      IF (IX.EQ.1) WRITE(6,201) ALVAR
  201 FORMAT (//' ALVAR=',F10.4/)
   65 XK=HO/(SIG*PP)
      R(1)=XK*PQ
      R(3)=XK*PR
      XK=XK*SQRT(XIB)
      R(2)=PI*PI*XK/2.0
      R(4)=XK*PS
C-21  SWITCH COEFFICIENTS FOR SUBSEQUENT ROLL OR SWAY CALC.
   68 DO 66 I=1,N
      XK=A(I,MP)
      A(I,MP)=A(I,1)
   66 A(I,1)=XK
      IF (MM.EQ.1) GO TO 96
      MM=1
      GO TO 62
C-22  ROLL RESULTS
   67 XI=ABS(PS*8.0/(PI*PI)-1.0)
      XK=HO/(4.0*SIG*PP)
      R(5)=XK*PR
      R(7)=XK*PQ
      XK=XK*SQRT(XIB)
      R(6)=PI*PI*XK/8.0
      R(8)=XK*QQ
      GO TO 68
C-23  ZERO FREQUENCY CALCULATIONS
   70 XA=1.0-A1+A3
      XC=XA*XA
      R(1)=PI*((1.0-A1)**2+TA3*A3)/(4.0*HO*SIG*XC)
      XB=A1*(1.0-A1*(1.0+A3)+A3*(4.0+3.0*A3)/5.0)+A3*(0.80-12.0*A3/7.0)
      XC=2.0*HO/(SIG*AA13*A13)
      R(3)=-XC*XB/3.0
      R(5)=XC*((A1*(1.0+A3))**2+8.0*A3*(A1+A3*(A1+2.0))/9.0)/(PI*A13)
      R(7)=R(3)
      DO 72 I=2,8,2
   72 R(I)=0.0
      IF (K1.NE.NSTA) GO TO 103
      DO 73 I=1,N1
      PSERS(1,I)=0.0
      QSERS(1,I)=0.0
      PSERR(1,I)=0.0
   73 QSERR(1,I)=0.0
      GO TO 103
C-24  ERROR RETURNS
   96 IF (IX.EQ.0) GO TO 103
   95 IX=IX+2
   92 IX=IX+2
      WRITE(6,97) ERM(6*IX-5),ERM(6*IX-4),ERM(6*IX-3),ERM(6*IX-2),ERM(6*
     XIX-1),ERM(6*IX),HO,SIG,XIB
      IF (IX.LT.5) GO TO 93
      WRITE(6,99) P,Q
      WRITE(6,91) FNO,FMO,XR,YR
   93 IF (IX.LT.5) DET=0.0
      IX=0
C-25  STORE RESULTS IN COMMON ARRAY
  103 MM=2
      DO 69 I=1,8
      J=I+2
   69 TDP(K1,IF,J)=R(I)
  104 CONTINUE
  105 CONTINUE
      RETURN
   97 FORMAT (32H0STOP IN SUBROUTINE TDLR DUE TO ,6A3 / 20H PARAMETERS-
     X  HO=  ,F10.4,3X,6HSIG = ,F10.6,3X,6HXIB = ,F12.6)
   99 FORMAT (11H P SERIES -,9E13.4 / 11H Q SERIES -,9E13.4)
   91 FORMAT (5H NO =,E12.4,6H, MO =,E12.4,6H, XR =,E12.4,6H, YR =,E12.4
     X)
      END
      SUBROUTINE ROLD
      COMMON / CONDA / PI,GAMMA,GRAV,RO
      COMMON / BASDA / BPL,DISPL,TMASS,YNERT,BSTAR(21),AREA(21),
     X                 SECOE(21),DRAFT(21),ZBAR(21),XI(21),XISQ(21),
     X                 DWEIGH(21),DMASS(21),ZWT(21),GRL(21),ZCG,XNERT,
     X                 XZPERT,GM,MINKRI,MAXKRI,INCRES,ROLDPF
      COMMON / TDIR / WE,WEN,ANS(21,10),KL,KU,IO,IW
      COMMON / MIMD / IA,NS,DXI,V,WANG,OMEGA,WAVEN,CW,DIX(21,5),FAC,WA
      COMMON / PROGRA / STORAG(457),Y(21),W(21),SMINNE(102)
C-01  INITIALIZE PARAMETERS REQUIRED
      KL = 7
      KU = 8
      WE = 0.0
      RAI = 0.0
C-02  CALCULATE NATURAL ROLL FREQUENCY, INCLUDING ADDED INERTIA
    2 WEX = WE
      WE = SQRT(DISPL*GRAV*GM/(XNERT+RAI))
      IF (ABS(WEX/WE-1.0) .LT. 0.01 )  GO TO 10
      WEN = WE*WE/GRAV
      CALL ALINT
      DO 5 I=1,NS
      Y(I) = ANS(I,7)
    5 W(I) = ANS(I,8)
      RAI = SINT(IA,NS,Y,DXI)
      RWD = SINT(IA,NS,W,DXI)
      GO TO 2
C-03  CALCULATE ADDITIONAL ROLL DAMPING
   10 ROLDPF = 2.0*ROLDPF*DISPL*GRAV*GM/WE-RWD
      WRITE(6,50) WE,RWD,ROLDPF
      RETURN
   50 FORMAT ( ///13X, 25HNATURAL ROLL FREQUENCY =  ,F11.5,6X,'RAD/SEC'/
     X4X,34HCALCULATED WAVE DAMPING IN ROLL =  ,E14.4,3X,'TONM**2/SEC'/
     X38H ADDITIONAL VISCOUS DAMPING IN ROLL =  ,E14.4,3X,'TONM**2/SEC')
      END
      FUNCTION SINT (INTG,J,Y,DXI)
C     INTEGRATE THE FUNCTION Y(I), WHICH IS TABULATED FOR J POINTS AT
C     EQUI-DISTANT INTERVALS OF DXI
C           IF INTG = 0, USE SIMPLE SUMMATIN TIMES DXI
C           IF INTG = 1, USE TRAPEZOIDAL RULE
      DIMENSION Y(1)
      SUMA = 0.0
      DO 10  I=1,J
   10 SUMA = SUMA+Y(I)
      IF ( INTG .EQ. 1 )  SUMA = SUMA-(Y(1)+Y(J))/2.0
      SINT = DXI*SUMA
      RETURN
      END
      SUBROUTINE ALINT
C     INTERPOLATE ALL REQUIRED TWO-DIMENSIONAL PROPERTIES AT PARTICULAR
C     FREQUENCY, FOR ALL SECTIONS. USE CONTINUED FRACTION METHOD, WITH
C     SIX POINTS, THREE ON EACH SIDE OF GIVEN POINT. ADOPTED FROM
C     SUBROUTINES ACFI AND ATSM OF *SYSTEM/360 SCIENTIFIC SUBROUTINE
C     PACKAGE, VERS. III*, IBM PUB. NO. H20-0205-3 (1968).
      COMMON / BASDA / BPL,DISPL,TMASS,YNERT,BSTAR(21),AREA(21),
     X                 SECOE(21),DRAFT(21),ZBAR(21),XI(21),XISQ(21),
     X                 DWEIGH(21),DMASS(21),ZWT(21),GRL(21),ZCG,XNERT,
     X                 XZPERT,GM,MINKR1,MAXKR1,INCRES,ROLDPF
      COMMON / TDR / NS,SBH(21),SBBB(21)
      COMMON /   / TDP(21,25,10)
      COMMON / TDIR / WE,WEN,ANS(21,10),KL,KU,IO,IW
      DIMENSION     OMT(25)
      DIMENSION VAL(6),ARG(6)
      DATA NF / 25 /
      DATA OMT / 0.0, 0.01, 0.03, 0.06, 0.10, 0.15, 0.21, 0.28, 0.36,
     X           0.45, 0.55, 0.67, 0.82, 1.01, 1.25, 1.55, 1.95, 2.45,
     X           3.05, 3.8, 4.7, 5.8, 7.1, 8.7, 10.7 /
C-01  LOOP OVER NUMBER OF STATIONS
      DO 20 K1=1,NS
      KM=KL
      X=WEN*DRAFT(K1)
C-02  CHECK FOR ZERO SECTION
      IF (DRAFT(K1).GT.0.0) GO TO 1
      DO 7 K=KM,KU
    7 ANS(K1,K)=0.0
      GO TO 20
C-03  CHECK IF X IS IN RANGE
    1 IF (X.LE.OMT(NF)) GO TO 5
    2 JJ=NF-3
      GO TO 4
C-04  BINARY SEARCH IN OMT ARRAY FOR X
    5 J=NF
      I=1
    6 K=(J+I)/2
      IF (X.GT.OMT(K)) GO TO 8
      J=K
      GO TO 9
    8 I=K
    9 IF (IABS(J-I).GT.1) GO TO 6
      JJ=I
C-05  OMT(JJ) IS JUST BELOW X IN ARRAY OMT
      IF (JJ+3.GT.NF) GO TO 2
      IF (JJ.GE.3) GO TO 4
      IF (JJ.GT.1.OR.KL.GT.1) GO TO 3
C-06  FREQUENCY PARAMETER NEXT TO OMT(1), ZERO FREQUENCY
      KM=2
      IF (X.GT.0.0) GO TO 33
      ANS(K1,1)=1.0E0
      GO TO 3
   33 XH=1.0+BSTAR(K1)/(2.0*DRAFT(K1))
      ANS(K1,1)=TDP(K1,2,1)*(0.23-ALOG(X*XH))/(0.23-ALOG(OMT(2)*XH))
    3 JJ=3
C-07  SET UP LOOPS AND STORE VALUES FOR INTERPOLATION
    4 DO 16 K=KM,KU
      KK=JJ-3+4/(K+JJ)
      DO 11 I=1,6
      IK=KK+I
      VAL(I)=TDP(K1,IK,K)
   11 ARG(I)=OMT(IK)
      P1=1.0
      P2=VAL(1)
      Q1=0.0
      Q2=1.0
      XHN=1.0E30
C-08  CONTINUED FRACTION INTERPOLATION LOOP
      DO 12 I=2,6
      II=0
      JE=I-1
   18 CONTINUE
      DO 13 J=1,JE
      H=VAL(I)-VAL(J)
      IF (H.NE.0.0) GO TO 14
      IF(J-JE) 21,19,19
   19 II=II+1
      III=II+I
      IF(III-6) 18,18,23
   23 XHN=VAL(1)
      GOTO 22
   21 CONTINUE
      VAL(I)=1.0E30
      GO TO 13
   14 VAL(I)=(ARG(I)-ARG(J))/H
   13 CONTINUE
      XH=XHN
      P3=VAL(I)*P2+(X-ARG(I-1))*P1
      Q3=VAL(I)*Q2+(X-ARG(I-1))*Q1
      IF (Q3.NE.0.0) GO TO 15
c
c      ƒndring av exponenten till e30 i.s.f e70 981123/lb
c
c      XHN=1.0E70
	XHN=1.0E30
      GO TO 17
   15 XHN=P3/Q3
   17 IF (ABS(1.0-XHN/XH).LT.0.02) GO TO 22
      P1=P2
      P2=P3
      Q1=Q2
      Q2=Q3
   12 CONTINUE
C-09  STORE RESULTS
   22 ANS(K1,K)=XHN
   16 CONTINUE
   20 CONTINUE
      RETURN
      END
      SUBROUTINE BLINT
      COMMON / MHDT / HDA(20),IB,IC,ID,IE,IF,IG,IH,II,IJ,IK,IL,INANT,
     B                H00(10),HCH0(10),GAMMB(10),PPER(10),TEXT(20),
     C                ASTA,IDS
      COMMON / PIN / PSERH(25,10),QSERH(25,10),PSERS(25,10),QSERS(25,10)
     X              ,PSERR(25,10),QSERR(25,10),AXO(10),AYO(10),NSTA
      COMMON / PUT / PH(51,10),QH(51,10),PS(51,10),QS(51,10),
     X               PR(51,10),QR(51,10)
      COMMON / BASDA / BPL,DISPL,TMASS,YNERT,BSTAR(21),AREA(21),
     X                 SECOE(21),DRAFT(21),ZBAR(21),XI(21),XISQ(21),
     X                 DWEIGH(21),DMASS(21),ZWT(21),GRL(21),ZCG,XNERT,
     X                 XZPERT,GM,MINKRI,MAXKRI,INCRES,ROLDPF
      COMMON / TDIR / WE,WEN,ANS(21,10),KL,KU,IO,IW
      DIMENSION OMT(25)
      DATA NF / 25 /
      DATA OMT / 0.0, 0.01, 0.03, 0.06, 0.10, 0.15, 0.21, 0.28, 0.36,
     X           0.45, 0.55, 0.67, 0.82, 1.01, 1.25, 1.55, 1.95, 2.45,
     X           3.05, 3.8, 4.7, 5.8, 7.1, 8.7, 10.7 /
      X=WEN*DRAFT(NSTA)
      IF (IE.LT.2) GO TO 4
      DO 5 I=1,NF
      DO 5 J=1,10
      PSERH(I,J)=0.0
    5 QSERH(I,J)=0.0
    4 IF (IE.GT.0) GO TO 6
      DO 7 I=1,NF
      DO 7 J=1,10
      PSERS(I,J)=0.0
      QSERS(I,J)=0.0
      PSERR(I,J)=0.0
    7 QSERR(I,J)=0.0
    6 CONTINUE
C     INTERPOLATION
      DO 1 I=2,NF
      IF (OMT(I)-X.LT.0.0) GO TO 1
      DO 2 J=1,10
      PS(IO,J)=(PSERS(I,J)-PSERS(I-1,J))*(X-OMT(I-1))/
     X         (OMT(I)-OMT(I-1))+PSERS(I-1,J)
      QS(IO,J)=(QSERS(I,J)-QSERS(I-1,J))*(X-OMT(I-1))/
     X         (OMT(I)-OMT(I-1))+QSERS(I-1,J)
      PR(IO,J)=(PSERR(I,J)-PSERR(I-1,J))*(X-OMT(I-1))/
     X         (OMT(I)-OMT(I-1))+PSERR(I-1,J)
      QR(IO,J)=(QSERR(I,J)-QSERR(I-1,J))*(X-OMT(I-1))/
     X         (OMT(I)-OMT(I-1))+QSERR(I-1,J)
      PH(IO,J)=(PSERH(I,J)-PSERH(I-1,J))*(X-OMT(I-1))/
     X         (OMT(I)-OMT(I-1))+PSERH(I-1,J)
      QH(IO,J)=(QSERH(I,J)-QSERH(I-1,J))*(X-OMT(I-1))/
     X         (OMT(I)-OMT(I-1))+QSERH(I-1,J)
    2 CONTINUE
      GO TO 3
    1 CONTINUE
    3 RETURN
      END
      SUBROUTINE COEFF
      COMMON / CONDA / PI,GAMMA,GRAV,RO
      COMMON / BASDA / BPL,DISPL,TMASS,YNERT,BSTAR(21),AREA(21),
     X                 SECOE(21),DRAFT(21),ZBAR(21),XI(21),XISQ(21),
     X                 DWEIGH(21),DMASS(21),ZWT(21),GRL(21),ZCG,XNERT,
     X                 XZPERT,GM,MINKRI,MAXKRI,INCRES,ROLDPF
      COMMON / TDIR / WE,WEN,ANS(21,10),KL,KU,IO,IW
      COMMON / MIMD / IA,NS,DXI,V,WANG,OMEGA,WAVEN,CW,DIX(21,5),FAC,WA
      COMMON / EQMO / CV(12),CL(27),SLASK,ZW,MW,YW,NW,KW
      COMPLEX ZW,MW,YW,NW,KW
      COMMON / PROGRA / STORAG(442),F(10),FX(10),FXS(4),DF(5),DFX(5),
     *                  DFXS(2),Y(21),SMINNE(102)
      IT=IA
      M=NS
      DX=DXI
      TV=2.0*V
C-01  CALCULATE REQUIRED INTEGRALS OVER SHIP LENGTH
      DO 10 K=KL,KU
      DO 2 I=1,M
    2 Y(I)=ANS(I,K)
      F(K)=SINT(IT,M,Y,DX)
      IF ((K+1)/2.EQ.4) GO TO 10
      DO 4 I=1,M
    4 Y(I)=Y(I)*XI(I)
      FX(K)=SINT(IT,M,Y,DX)
      IF (K.GT.4) GO TO 10
      DO 6 I=1,M
    6 Y(I)=Y(I)*XI(I)
      FXS(K)=SINT(IT,M,Y,DX)
   10 CONTINUE
      BI=SINT(IT,M,BSTAR,DX)*GAMMA
      DO 13 I=1,M
   13 Y(I)=BSTAR(I)*XI(I)
      BXI=SINT(IT,M,Y,DX)*GAMMA
      DO 14 I=1,M
   14 Y(I)=Y(I)*XI(I)
      BXSI=SINT(IT,M,Y,DX)*GAMMA
C-02  INCREASE ROLL DAMPING (TO ACCOUNT FOR VISCOUS EFFECTS)
      F(8)=F(8)+ROLDPF
      IF (KL.GT.2) GO TO 19
      FAC=RO/SQRT(WEN**3/GRAV)
      F(2)=F(2)*FAC
      FX(2)=FX(2)*FAC
      FXS(2)=FXS(2)*FAC
C-03  CALCULATE REQUIRED DERIVATIVES AND THEIR INTEGRALS
   19 TDX=2.0*DXI
      MM=M-1
      DO 20 K=KL,KU,2
      KK=(K+1)/2
      DIX(1,KK)=(ANS(1,K)-ANS(2,K))/DXI
      DIX(M,KK)=(ANS(M-1,K)-ANS(M,K))/DXI
      DO 22 I=2,MM
   22 DIX(I,KK)=(ANS(I-1,K)-ANS(I+1,K))/TDX
      DO 24 I=1,M
   24 Y(I)=DIX(I,KK)
      DF(KK)=SINT(IT,M,Y,DX)
      IF (KK.EQ.4) GO TO 20
      DO 25 I=1,M
   25 Y(I)=Y(I)*XI(I)
      DFX(KK)=SINT(IT,M,Y,DX)
      IF (KK.GT.2) GO TO 20
      DO 26 I=1,M
   26 Y(I)=Y(I)*XI(I)
      DFXS(KK)=SINT(IT,M,Y,DX)
   20 CONTINUE
      IF (KL.GT.2) GO TO 30
C-04  FORM COEFFICIENTS FOR VERTICAL PLANE MOTIONS (HEAVE + PITCH)
      CV(1)=TMASS+F(1)
      CV(2)=F(2)-V*DF(1)
      CV(3)=BI
      CV(4)=FX(1)
      CV(5)=FX(2)-V*DFX(1)-TV*F(1)
      CV(6)=BXI-V*CV(2)
      CV(7)=YNERT+FXS(1)
      CV(8)=FXS(2)-V*DFXS(1)-TV*FX(1)
      CV(9)=BXSI-V*FX(2)+V*V*DFX(1)
      CV(10)=FX(1)
      CV(11)=FX(2)-V*DFX(1)
      CV(12)=BXI
      IF (KU.LT.3) GO TO 40
C-05  FORM COEFFS. FOR LATERAL PLANE MOTIONS (SWAY, YAW + ROLL)
   30 CL(1)=TMASS+F(3)
      CL(2)=F(4)-V*DF(2)
      CL(3)=0.0
      CL(4)=FX(3)
      CL(5)=FX(4)-V*DFX(2)-TV*F(3)
      CL(6)=-V*CL(2)
      CL(7)=-F(9)-ZCG*F(3)
      CL(8)=-F(10)-ZCG*CL(2)+V*DF(5)
      CL(9)=0.0
      CL(10)=FX(3)
      CL(11)=FX(4)-V*DFX(2)
      CL(12)=0.0
      CL(13)=YNERT+FXS(3)
      CL(14)=FXS(4)-V*DFXS(2)-TV*FX(3)
      CL(15)=-V*CL(11)
      CL(16)=-XZPERT-FX(9)-ZCG*FX(3)
      CL(17)=-FX(10)-ZCG*CL(11)+V*DFX(5)
      CL(18)=0.0
      CL(19)=-F(5)-ZCG*F(3)
      CL(20)=-F(6)-ZCG*CL(2)+V*DF(3)
      CL(21)=0.0
      CL(22)=-XZPERT-FX(5)-ZCG*FX(3)
      CL(23)=-FX(6)-ZCG*CL(11)+V*DFX(3)-TV*CL(19)
      CL(24)=-V*CL(20)
      CL(25)=XNERT+F(7)+ZCG*F(9)-ZCG*CL(19)
      CL(26)=F(8)-ZCG*CL(20)+ZCG*(F(10)-V*DF(5))-V*DF(4)
      CL(27)=DISPL*GRAV*GM
   40 RETURN
      END
      SUBROUTINE EXCITE
      COMMON / CONDA / PI,GAMMA,GRAV,RO
      COMMON / BASDA / BPL,DISPL,TMASS,YNERT,BSTAR(21),AREA(21),
     X                 SECOE(21),DRAFT(21),ZBAR(21),XI(21),XISQ(21),
     X                 DWEIGH(21),DMASS(21),ZWT(21),GRL(21),ZCG,XNERT,
     X                 XZPERT,GM,MINKRI,MAXKRI,INCRES,ROLDPF
      COMMON / TDIR / WE,WEN,ANS(21,10),KL,KU,IO,IW
      COMMON / MIMD / IA,NS,DXI,V,WANG,OMEGA,WAVEN,CW,DIX(21,5),FAC,WA
      COMMON / EQMO / CV(12),CL(27),SLASK,ZW,MW,YW,NW,KW
      COMPLEX ZW,MW,YW,NW,KW
      COMMON / BMDA / CXFST(21),CXFL(21),CXMR(21),SBMM(51,3),SBMP(51,3)
      COMPLEX CXFST,CXFL,CXMR
      COMMON / PROGRA / STORAG(457),Y(21),W(21),SMINNE(102)
      COMMON /EXCIT/ ZAMP(51),ZPH(51),PAMP(51),PPH(51),SWAMP(51),
     *               SWPH(51),YAMP(51),YPH(51),RAMP(51),RPH(51)
      IT=IA
      M=NS
      DX=DXI
      WN=WAVEN
      CWAN=COS(WANG)
      SWAN=SIN(WANG)
      MS=(NS+1)/2
      SLASK=1.0/(GAMMA*BPL*BPL*BSTAR(MS)*WA)
      ZAMP(IO)=0.0
      ZPH(IO)=0.0
      PAMP(IO)=0.0
      PPH(IO)=0.0
      SWAMP(IO)=0.0
      SWPH(IO)=0.0
      YAMP(IO)=0.0
      YPH(IO)=0.0
      RAMP(IO)=0.0
      RPH(IO)=0.0
C-01  CALCULATE WAVE EXITATION AT EACH STATION
      DO 30 I=1,NS
      XKCB=-WN*XI(I)*CWAN
      CXK=COS(XKCB)
      SXK=SIN(XKCB)
      EXY=-EXP(-WN*DRAFT(I)*SECOE(I))*WA
      XA=BSTAR(I)*WN*SWAN/2.0
      IF (XA.EQ.0.0) GO TO 12
      EXY=EXY*SIN(XA)/XA
   12 IF (KL.GT.2) GO TO 10
C-02  FORM VERTICAL FORCE COMPONENTS
      FKL=GAMMA*BSTAR(I)-WN*GRAV*ANS(I,1)
      SKL=WN*CW*(ANS(I,2)*FAC-V*DIX(I,1))
      CX=(FKL*SXK+SKL*CXK)*EXY
      SX=(FKL*CXK-SKL*SXK)*EXY
      CXFST(I)=CMPLX(CX,SX)
      IF (KU.LT.3) GO TO 30
C-03  FORM LATERAL FORCE COMPONENTS
   10 FKL=GRAV*(RO*AREA(I)+ANS(I,3)-WN*ANS(I,5))
      SKL=CW*(ANS(I,4)-V*DIX(I,2)+WN*V*DIX(I,3))
      EXY=WN*EXY*SWAN
      CX=(FKL*CXK+SKL*SXK)*EXY
      SX=(-FKL*SXK+SKL*CXK)*EXY
      CXFL(I)=CMPLX(CX,SX)
C-04  FORM ROLL MOMENT COMPONENTS
      FKL=GRAV*(RO*(BSTAR(I)**3/12.0-AREA(I)*ZBAR(I))-ANS(I,5))-ZCG*FKL
      SKL=CW*(-ANS(I,6)+V*DIX(I,3))-ZCG*SKL
      CX=(FKL*CXK+SKL*SXK)*EXY
      SX=(-FKL*SXK+SKL*CXK)*EXY
      CXMR(I)=CMPLX(CX,SX)
   30 CONTINUE
      IF (KL.GT.2) GO TO 40
C-05  INTEGRATE VERTICAL FORCE AND PITCH MOMENT
      DO 32 I=1,NS
      Y(I)=REAL(CXFST(I))
   32 W(I)=AIMAG(CXFST(I))
      CX=SINT(IT,M,Y,DX)
      SX=SINT(IT,M,W,DX)
      ZW=CMPLX(CX,SX)
      DO 33 I=1,NS
      Y(I)=Y(I)*XI(I)
   33 W(I)=W(I)*XI(I)
      CX=-SINT(IT,M,Y,DX)
      SX=-SINT(IT,M,W,DX)
      MW=CMPLX(CX,SX)
      ZAMP(IO)=CABS(ZW)*SLASK*BPL
      ZPH(IO)=ATAN2(REAL(ZW),AIMAG(ZW))*57.296
      PAMP(IO)=CABS(MW)*SLASK
      PPH(IO)=ATAN2(REAL(MW),AIMAG(MW))*57.296
      IF (KU.LT.3) GO TO 50
C-06  INTEGRATE LATERAL FORCE, YAW MOMENT AND ROLL MOMENT
   40 DO 42 I=1,NS
      Y(I)=REAL(CXFL(I))
   42 W(I)=AIMAG(CXFL(I))
      CX=SINT(IT,M,Y,DX)
      SX=SINT(IT,M,W,DX)
      YW=CMPLX(CX,SX)
      DO 43 I=1,NS
      Y(I)=Y(I)*XI(I)
   43 W(I)=W(I)*XI(I)
      CX=SINT(IT,M,Y,DX)
      SX=SINT(IT,M,W,DX)
      NW=CMPLX(CX,SX)
      DO 44 I=1,NS
      Y(I)=REAL(CXMR(I))
44    W(I)=AIMAG(CXMR(I))
      CX=SINT(IT,M,Y,DX)
      SX=SINT(IT,M,W,DX)
      KW=CMPLX(CX,SX)
      SWAMP(IO)=CABS(YW)*SLASK*BPL
      SWPH(IO)=ATAN2(REAL(YW),AIMAG(YW))*57.296
      YAMP(IO)=CABS(NW)*SLASK
      YPH(IO)=ATAN2(REAL(NW),AIMAG(NW))*57.296
      RAMP(IO)=CABS(KW)*SLASK
      RPH(IO)=ATAN2(REAL(KW),AIMAG(KW))*57.296
   50 RETURN
      END
      SUBROUTINE MOTION
      COMMON / TDIR / WE,WEN,ANS(21,10),KL,KU,IO,IW
      COMMON / EQMO / CV(12),CL(27),SLASK,ZW,MW,YW,NW,KW
      COMMON / MOTI / ZA,TA,SA,YA,RA
      COMPLEX         ZA,TA,SA,YA,RA
      COMMON / MOTN / ZM(51),ZP(51),TM(51),TP(51),SM(51),SP(51),YM(51),
     X                YP(51),RM(51),RP(51)
      COMPLEX P,Q,R,S,T,U,V,W,X,ZW,MW,YW,NW,KW,DEN
      WES=WE*WE
      WX=-WE
      ZM(IO)=0.0
      ZP(IO)=0.0
      TM(IO)=0.0
      TP(IO)=0.0
      SM(IO)=0.0
      SP(IO)=0.0
      YM(IO)=0.0
      YP(IO)=0.0
      RM(IO)=0.0
      RP(IO)=0.0
      IF (KL.GT.2) GO TO 10
C-01  VERTICAL MOTIONS COMPUTATIONS
      P=CMPLX(CV(3)-WES*CV(1),WX*CV(2))
      Q=-CMPLX(CV(6)-WES*CV(4),WX*CV(5))
      R=-CMPLX(CV(12)-WES*CV(10),WX*CV(11))
      S=CMPLX(CV(9)-WES*CV(7),WX*CV(8))
      DEN=P*S-R*Q
      ZA=(ZW*S-MW*Q)/DEN
      TA=(P*MW-R*ZW)/DEN
      ZM(IO)=CABS(ZA)
      ZP(IO)=ATAN2(REAL(ZA),AIMAG(ZA))*57.295779
      TM(IO)=CABS(TA)*57.295779
      TP(IO)=ATAN2(REAL(TA),AIMAG(TA))*57.295779
      IF (KU.LT.3) GO TO 20
C-02  LATERAL MOTIONS COMPUTATIONS
   10 P=CMPLX(CL(3)-WES*CL(1),WX*CL(2))
      Q=CMPLX(CL(6)-WES*CL(4),WX*CL(5))
      R=CMPLX(CL(9)-WES*CL(7),WX*CL(8))
      S=CMPLX(CL(12)-WES*CL(10),WX*CL(11))
      T=CMPLX(CL(15)-WES*CL(13),WX*CL(14))
      U=CMPLX(CL(18)-WES*CL(16),WX*CL(17))
      V=CMPLX(CL(21)-WES*CL(19),WX*CL(20))
      W=CMPLX(CL(24)-WES*CL(22),WX*CL(23))
      X=CMPLX(CL(27)-WES*CL(25),WX*CL(26))
      DEN=P*T*X+Q*U*V+R*S*W-V*T*R-W*U*P-X*S*Q
      SA=(YW*T*X+Q*U*KW+R*NW*W-KW*T*R-W*U*YW-X*NW*Q)/DEN
      YA=(P*NW*X+YW*U*V+R*S*KW-V*NW*R-KW*U*P-X*S*YW)/DEN
      RA=(P*T*KW+Q*NW*V+YW*S*W-V*T*YW-W*NW*P-KW*S*Q)/DEN
      SM(IO)=CABS(SA)
      SP(IO)=ATAN2(REAL(SA),AIMAG(SA))*57.295779
      YM(IO)=CABS(YA)*57.295779
      YP(IO)=ATAN2(REAL(YA),AIMAG(YA))*57.295779
      RM(IO)=CABS(RA)*57.295779
      RP(IO)=ATAN2(REAL(RA),AIMAG(RA))*57.295779
   20 RETURN
      END
      SUBROUTINE BENDSH
      COMMON / CONDA / PI,GAMMA,GRAV,RO
      COMMON / MHDT / HDA(20),IB,IC,ID,IE,IF,IG,IH,II,IJ,IK,IL,INANT,
     B                H00(10),HCH0(10),GAMMB(10),PPER(10),TEXT(20),
     C                ASTA,IDS
      COMMON / BASDA / BPL,DISPL,TMASS,YNERT,BSTAR(21),AREA(21),
     X                 SECOE(21),DRAFT(21),ZBAR(21),XI(21),XISQ(21),
     X                 DWEIGH(21),DMASS(21),ZWT(21),GRL(21),ZCG,XNERT,
     X                 XZPERT,GM,MINKRI,MAXKRI,INCRES,ROLDPF
      COMMON / TDIR / WE,WEN,ANS(21,10),KL,KU,IO,IW
      COMMON / MIMD / IA,NS,DXI,V,WANG,OMEGA,WAVEN,CW,DIX(21,5),FAC,WA
      COMMON / BMDA / CXFST(21),CXFL(21),CXMR(21),SBMM(51,3),SBMP(51,3)
      COMPLEX CXFST,CXFL,CXMR
      COMMON / MOTI / ZR,TR,SR,YR,RR
      COMPLEX         ZR,TR,SR,YR,RR
      COMMON / PROGRA / CLBM(51,3),CLSH(51,2),SPACE(79),SHM(3),SHP(3),
     X        BMM(3),BMP(3),WEI,ZRD,ZRDD,TRD,TRDD,SRD,SRDD,YRD,YRDD,RRD,
     X        RRDD,CTFST(21,3),A,B,SLASK,SMINNE(102)
      COMPLEX WEI,ZRD,ZRDD,TRD,TRDD,SRD,SRDD,YRD,YRDD,RRD,RRDD,CTFST,A,B
      COMMON /BEND/ VSF(51),VSPH(51),ASF(51),ASPH(51)
      DIMENSION AMM(3)
      DIMENSION STS(10)
      DATA STS/3HMN.,3H SQ,3HR.M,3H.S.,3HAVG,3H.  ,3HSIG,3H.  ,3HAV1,
     X3H/10  /
C-01  SET UP CALCULATION PARAMETERS
      WEI=CMPLX(0.0,-WE)
      JL=(KL+5)/4
      JU=(KU+5)/4
      HH=DXI/2.0
      NT=NS-1
      DO 9 K=1,3
      SHM(K)=0.0
      BMM(K)=0.0
      SHP(K)=0.0
      BMP(K)=0.0
      DO 9 I=1,NS
      CTFST(I,K)=0.0
    9 CONTINUE
C-02  CALCULATE TOTAL LOCAL LOADINGS AT EACH STATION
      IF (KL.GT.2) GO TO 12
C-03  VERTICAL FORCE COMPONENTS
      ZRD=ZR*WEI
      TRD=TR*WEI
      ZRDD=ZRD*WEI
      TRDD=TRD*WEI
      DO 10 I=1,NS
   10 CTFST(I,1)=-(DMASS(I)+ANS(I,1))*(ZRDD-XI(I)*TRDD)-ANS(I,1)*
     X           2.0*V*TRD-GAMMA*BSTAR(I)*(ZR-XI(I)*TR)-(ANS(I,2)*
     X           FAC-V*DIX(I,1))*(ZRD-XI(I)*TRD+V*TR)+CXFST(I)
      IF (KU.LT.3) GO TO 16
C-04  LATERAL FORCE AND TORSIONAL MOMENT COMPONENTS
   12 SRD=SR*WEI
      YRD=YR*WEI
      RRD=RR*WEI
      SRDD=SRD*WEI
      YRDD=YRD*WEI
      RRDD=RRD*WEI
      DO 14 I=1,NS
      CTFST(I,2)=-DMASS(I)*(SRDD+XI(I)*YRDD-ZWT(I)*RRDD)
     X           -ANS(I,3)*(SRDD+XI(I)*YRDD-2.0*V*YRD)-(ANS(I,4)-V*
     X           DIX(I,2))*(SRD+XI(I)*YRD-V*YR-ZCG*RRD)+(ANS(I,9)+
     X           ZCG*ANS(I,3))*RRDD+(ANS(I,10)-V*DIX(I,5))*RRD+CXFL(I)
      CTFST(I,3)=-DMASS(I)*(GRL(I)**2*RRDD-ZWT(I)*(SRDD+XI(I)*YRDD
     1           -GRAV*RR))-GAMMA*(BSTAR(I)**3/12.0-AREA(I)*(ZBAR(I)+
     2   ZCG))*RR-RRDD*(ANS(I,7)+ZCG*(ANS(I,5)+ANS(I,9)+ZCG*ANS(I,3)))
     3          +ZCG*CTFST(I,2)*IJ+RRD*(V*(DIX(I,4)+ZCG*(DIX(I,3)
     4             +DIX(I,5)+ZCG*DIX(I,2)))-ZCG*(ANS(I,10)+ANS(I,6)
     5   +ZCG*ANS(I,4))-ANS(I,8)-ROLDPF/BPL)+(SRDD+XI(I)*YRDD-2.0*V*YRD)
     6             *(ANS(I,5)+ZCG*ANS(I,3))+(SRD+XI(I)*YRD-V*YR)*
     7   (ANS(I,6)+ZCG*ANS(I,4)-V*(DIX(I,3)+ZCG*DIX(I,2)))+CXMR(I)
   14 CONTINUE
C-05  LOOP OVER STATIONS FOR BENDING MOMENT CALCS.
   16 KRIT=MINKRI
      IF (KRIT.GT.0) GO TO 18
      XX=XI(1)+HH*(1.0-IA)
      GO TO 19
   18 XX=XI(KRIT)-HH*(1.0+IA)
C-06  LOOP OVER NUMBER OF TYPES OF LOADINGS
   19 CONTINUE
      DO 30 K=JL,JU
      A=(0.0,0.0)
      B=(0.0,0.0)
      IF (KRIT.EQ.0) GO TO 22
      A=CTFST(1,K)/(1+IA)
      B=A*(XI(1)-XX)
      IF (KRIT.EQ.1) GO TO 22
      DO 20 I=2,KRIT
      A=A+CTFST(I,K)
   20 B=B+CTFST(I,K)*(XI(I)-XX)
   22 KK=KRIT+1+IA
      IF (KK.GT.NS) GO TO 26
      A=A-CTFST(NS,K)/(1+IA)
      B=B-CTFST(NS,K)/(1+IA)*(XI(NS)-XX)
      IF (KK.GT.NT) GO TO 26
      DO 24 I=KK,NT
      A=A-CTFST(I,K)
   24 B=B-CTFST(I,K)*(XI(I)-XX)
   26 IF (K.EQ.3) B=A
      SHM(K)=CABS(A)*HH
      BMM(K)=CABS(B)*HH
      SHP(K)=ATAN2(REAL(A),AIMAG(A))*180.0/PI
      BMP(K)=ATAN2(REAL(B),AIMAG(B))*180.0/PI
   30 CONTINUE
      VSF(IO)=SHM(1)
      VSPH(IO)=SHP(1)
      ASF(IO)=SHM(2)
      ASPH(IO)=SHP(2)
      IF (MAXKRI.EQ.MINKRI) GO TO 31
      MS=(NS+1)/2
      IF(II.GT.0) THEN
         GLB=1.0/(GAMMA*BPL*BPL*BSTAR(MS)*WA)
      ELSE
         GLB=1.0
      ENDIF
      DO 101 I=1,3
  101 AMM(I)=BMM(I)*GLB
      WRITE(6,90) OMEGA,KRIT,(AMM(I),BMP(I),I=1,3)
      IF (KRIT.NE.(NS-IA)/2) GO TO 34
C-07  STORE RESULT
   31 DO 32 K=JL,JU
      SBMM(IO,K)=BMM(K)
   32 SBMP(IO,K)=BMP(K)
   34 IF (KRIT.GE.MAXKRI) GO TO 38
      KRIT=KRIT+INCRES
      GO TO 18
   38 IF (IH.LE.0) GO TO 60
C-08  CHECK SHEAR AND BENDING MOMENT CLOSURE
      DO 39 K=1,2
      CLSH(IO,K)=0.0
   39 CLBM(IO,K)=0.0
      CLBM(IO,3)=0.0
      DO 50 K=JL,JU
      A=(CTFST(1,K)+CTFST(NS,K))/(1+IA)
      B=(CTFST(1,K)*XI(1)+CTFST(NS,K)*XI(NS))/(1+IA)
      DO 40 I=2,NT
      A=A+CTFST(I,K)
   40 B=B+CTFST(I,K)*XI(I)
      IF (K.LT.3) GO TO 45
      B=A
      GO TO 50
   45 CLSH(IO,K)=CABS(A)*DXI/(DISPL*GRAV)
   50 CLBM(IO,K)=CABS(B)*DXI/SBMM(IO,K)
   60 RETURN
   90 FORMAT (F9.4,I10,3(E13.3,F7.1))
      END
C     SUBROUTINE PRESS
C     COMMON / PIN / PSERH(25,10),QSERH(25,10),PSERS(25,10),QSERS(25,10)
C    X              ,PSERR(25,10),QSERR(25,10),AXO(10),AYO(10),NSTA
C     COMMON / PUT / PH(51,10),QH(51,10),PS(51,10),QS(51,10),
C    X               PR(51,10),QR(51,10)
C     COMMON / CONDA / PI,GAMMA,GRAV,RO
C     COMMON / MHDT / HDA(20),IB,IC,ID,IE,IF,IG,IH,II,IJ,IK,IL,INANT,
C    B                H00(10),HCH0(10),GAMMB(10),PPER(10),TEXT(20),
C    C                ASTA,IDS
C     COMMON / BASDA / BPL,DISPL,TMASS,YNERT,BSTAR(21),AREA(21),
C    X                 SECOE(21),DRAFT(21),ZBAR(21),XI(21),XISQ(21),
C    X                 DWEIGH(21),DMASS(21),ZWT(21),GRL(21),ZCG,XNERT,
C    X                 XZPERT,GM,MINKRI,MAXKRI,INCRES,ROLDPF
C     COMMON / CASDA / NN,OMW(51),WVL(51),OMWE(51),VMIN,VMAX,DELV,
C    X                 NWA,WAD(25),WANGI,WANGA,DWANG,NWI,WD(20),WLL(51)
C     COMMON / TDIR / WE,WEN,ANS(21,10),KL,KU,IO,IW
C     COMMON / MIMD / IA,NS,DXI,V,WANG,OMEGA,WAVEN,CW,DIX(21,5),FAC,WA
C     COMMON / MOTN / ZM(51),ZP(51),TM(51),TP(51),SM(51),SP(51),YM(51),
C    X                YP(51),RM(51),RP(51)
C     COMMON / STAT / SPECM(10,51),RSD(10,10,25)
C     DIMENSION BXO(10),BYO(10)
C     DIMENSION PREST(51,10),PHAST(51,10),PREPO(51,10),PHAPO(51,10)
C     DIMENSION SUM(2),SU(5,2),STS1(10)
C     DATA STS1/3HMN.,3H SQ,3HR.M,3H.S.,3HAVG,3H.  ,3HSIG,3H.  ,
C    *         3HAV1,3H/10  /
C     PI2=1.570796
C     RAD=57.295779
C     S=V*1.943845
C     ASTA=FLOAT(NSTA)+0.5*(1.0-FLOAT(IA))-1.0
C     GLB=1.0/(RO*GRAV*WA)
C     IF (II.EQ.0) GLB=1.0
C     DO 6 N=1,10
C     BXO(N)=BSTAR(NSTA)*AXO(N)/2.0
C   6 BYO(N)=BSTAR(NSTA)*AYO(N)/2.0
C-01  LOOP OVER NUMBER OF FREQUENCIES
C     DO 1 I=1,NN
C     MM=0
C     ZPAAA=ZP(I)-90.0
C     TPAAA=TP(I)+90.0
C     SPAAA=SP(I)-90.0
C     YPAAA=YP(I)-90.0
C     RPAAA=RP(I)-90.0
C-02  LOOP OVER THETA AROUND SECTION CONTOUR
C   4 CONTINUE
C     DO 2 J=1,10
C     HYDRODYNAMIC PRESSURE DUE TO THE MOTION IN STILL WATER
C     HMS=ZM(I)*SIN(ZP(I)/RAD)
C     HMC=ZM(I)*COS(ZP(I)/RAD)
C     PMS=-TM(I)*SIN(TP(I)/RAD)*XI(NSTA)/RAD
C     PMC=-TM(I)*COS(TP(I)/RAD)*XI(NSTA)/RAD
C     RMS=RM(I)*SIN(RP(I)/RAD)*AXO(J)*BSTAR(NSTA)/(2.0*RAD)
C     RMC=RM(I)*COS(RP(I)/RAD)*AXO(J)*BSTAR(NSTA)/(2.0*RAD)
C     HPS=PH(I,J)*SIN(ZPAAA/RAD)*ZM(I)
C     HPC=PH(I,J)*COS(ZPAAA/RAD)*ZM(I)
C     HQS=-QH(I,J)*SIN(PI2+ZPAAA/RAD)*ZM(I)
C     HQC=-QH(I,J)*COS(PI2+ZPAAA/RAD)*ZM(I)
C     PPS=PH(I,J)*SIN(TPAAA/RAD)*TM(I)*XI(NSTA)/RAD
C     PPC=PH(I,J)*COS(TPAAA/RAD)*TM(I)*XI(NSTA)/RAD
C     PQS=-QH(I,J)*SIN(PI2+TPAAA/RAD)*TM(I)*XI(NSTA)/RAD
C     PQC=-QH(I,J)*COS(PI2+TPAAA/RAD)*TM(I)*XI(NSTA)/RAD
C     SPS=PS(I,J)*SIN(SPAAA/RAD)*SM(I)
C     SPC=PS(I,J)*COS(SPAAA/RAD)*SM(I)
C     SQS=-QS(I,J)*SIN(PI2+SPAAA/RAD)*SM(I)
C     SQC=-QS(I,J)*COS(PI2+SPAAA/RAD)*SM(I)
C     SPS=SPS+PS(I,J)*SIN(RPAAA/RAD+PI)*RM(I)*ZCG/RAD
C     SPC=SPC+PS(I,J)*COS(RPAAA/RAD+PI)*RM(I)*ZCG/RAD
C     SQS=SQS-QS(I,J)*SIN(RPAAA/RAD-PI2)*RM(I)*ZCG/RAD
C     SQC=SQC-QS(I,J)*COS(RPAAA/RAD-PI2)*RM(I)*ZCG/RAD
C     YPS=PS(I,J)*SIN(YPAAA/RAD)*YM(I)*XI(NSTA)/RAD
C     YPC=PS(I,J)*COS(YPAAA/RAD)*YM(I)*XI(NSTA)/RAD
C     YQS=-QS(I,J)*SIN(PI2+YPAAA/RAD)*YM(I)*XI(NSTA)/RAD
C     YQC=-QS(I,J)*COS(PI2+YPAAA/RAD)*YM(I)*XI(NSTA)/RAD
C     RPS=PR(I,J)*SIN(RPAAA/RAD)*RM(I)*BSTAR(NSTA)/(2.0*RAD)
C     RPC=PR(I,J)*COS(RPAAA/RAD)*RM(I)*BSTAR(NSTA)/(2.0*RAD)
C     RQS=-QR(I,J)*SIN(PI2+RPAAA/RAD)*RM(I)*BSTAR(NSTA)/(2.0*RAD)
C     RQC=-QR(I,J)*COS(PI2+RPAAA/RAD)*RM(I)*BSTAR(NSTA)/(2.0*RAD)
C     HYDRODYNAMIC PRESSURE DUE TO REFLECTION OF WAVES FROM THE
C     BODY UNDER RESTRAINED CONDITION
C     FI=-PI2-XI(NSTA)*COS(WANG)*2.0*PI/WVL(I)+PI*SIN(WANG)*AXO(J)*
C    X   BSTAR(NSTA)/WVL(I)
C     TI=WA*EXP(-PI*AYO(J)*BSTAR(NSTA)/WVL(I))
C     WPS=PH(I,J)*TI*SIN(FI)+PS(I,J)*TI*SIN(FI-PI2)*SIN(WANG)
C     WPC=PH(I,J)*TI*COS(FI)+PS(I,J)*TI*COS(FI-PI2)*SIN(WANG)
C     WQS=-QH(I,J)*TI*SIN(PI2+FI)-QS(I,J)*TI*SIN(FI)*SIN(WANG)
C     WQC=-QH(I,J)*TI*COS(PI2+FI)-QS(I,J)*TI*COS(FI)*SIN(WANG)
C     HYDRODYNAMIC PRESSURE OBTAINED FROM REGULAR WAVE POTENTIAL
C     WAS=WA*EXP(-PI*AYO(J)*BSTAR(NSTA)/WVL(I))*SIN(-XI(NSTA)*COS(WANG)*
C    X 2.0*PI/WVL(I)+PI*SIN(WANG)*AXO(J)*BSTAR(NSTA)/WVL(I))
C     WAC=WA*EXP(-PI*AYO(J)*BSTAR(NSTA)/WVL(I))*COS(-XI(NSTA)*COS(WANG)*
C    X 2.0*PI/WVL(I)+PI*SIN(WANG)*AXO(J)*BSTAR(NSTA)/WVL(I))
C     ZS=HPS+HQS+PPS+PQS+SPS+SQS+YPS+YQS+RPS+RQS+WAS+HMS+PMS+RMS+WPS+WQS
C     ZC=HPC+HQC+PPC+PQC+SPC+SQC+YPC+YQC+RPC+RQC+WAC+HMC+PMC+RMC+WPC+WQC
C     IF (MM.EQ.1) GO TO 3
C     PREST(I,J)=RO*GRAV*SQRT(ZS*ZS+ZC*ZC)*GLB
C     PHAST(I,J)=ATAN2(ZS,ZC)*RAD
C     GO TO 2
C   3 PREPO(I,J)=RO*GRAV*SQRT(ZS*ZS+ZC*ZC)*GLB
C     PHAPO(I,J)=ATAN2(ZS,ZC)*RAD
C   2 CONTINUE
C     IF (MM.EQ.1) GO TO 7
C     MM=1
C     DO 5 K=1,10
C     PS(I,K)=-PS(I,K)
C     QS(I,K)=-QS(I,K)
C     PR(I,K)=-PR(I,K)
C     QR(I,K)=-QR(I,K)
C   5 AXO(K)=-AXO(K)
C     GO TO 4
C   7 DO 8 K=1,10
C   8 AXO(K)=-AXO(K)
C     IF (MOD(I,3).EQ.1.OR.I.EQ.1) WRITE(6,10) HDA,ASTA,S,WAD(IW)
C     IF ((MOD(I,3).EQ.1.OR.I.EQ.1).AND.II.EQ.1) WRITE(6,13)
C     WRITE(6,11) OMW(I)
C     WRITE(6,12) (BXO(M),BYO(M),PREPO(I,M),PHAPO(I,M),PREST(I,M),
C    X             PHAST(I,M),M=1,10)
C   1 CONTINUE
C
C     OREGELBUNDNA V]GOR
C
C     GKONST=SQRT(GRAV/BPL)
C     IF(IL.EQ.1) GOTO 14
C     IF(NPOS.GT.2) WRITE(6,920) HDA
C     WRITE(6,949)
C     IF(NPOS.GT.2) WRITE(6,950) S,WAD(IW)
C     WRITE(6,947)
C  14 CONTINUE
C     DO 21 L=1,NWI
C     DO 15 K=1,10
C     SUM(1)=0.0
C     SUM(2)=0.0
C     WRITE(6,941) L,K,BXO(K),BYO(K)
C     DO 19 J=1,NN
C     SPEX=SPECM(L,J)
C
C     KORREKTION D] M\TESFREKV. G]R MOT 0 (AKTERLIG SJ\)
C
C     IF(ABS(OMWE(J)).LT.0.1.OR.WVL(J).GT.500.0) GOTO 17
C     PREPOR=PREPO(J,K)**2*SPEX
C     PRESTR=PREST(J,K)**2*SPEX
C     GOTO 18
C  17 CONTINUE
C     PREPOR=0.0
C     PRESTR=0.0
C  18 CONTINUE
C     SUM(1)=0.0
C     SUM(2)=0.0
C     IF(IL.EQ.1) WRITE(6,943) WLL(J),PREPOR,PRESTR
C  19 CONTINUE
C     DEL=2*ALOG(OMW(3)/OMW(2))
C     DO 20 M=1,5
C     SU(M,1)=SUM(M)*DEL
C     SU(M,2)=SQRT(SUM(M)*DEL)
C     SU(M,3)=1.25*SU(M,2)
C     SU(M,4)=2.0*SU(M,2)
C     SU(M,5)=2.55*SU(M,2)
C     SSPA(M,L,K,IW)=SU(M,1)
C  20 CONTINUE
C     IF(IL.EQ.1) WRITE(6,946) STS1(7),STS1(8),(SU(J,4),J=1,2)
C     IF(IL.EQ.0) WRITE(6,948) L,(SU(J,4),J=1,2)
C  15 CONTINUE
C  21 CONTINUE
C941  FORMAT(' SPECTRUM =',I4//11X,I4/5X,F7.3,F9.3)
C943  FORMAT(F8.4,4X,2F12.4)
C946  FORMAT(/2X,2E12.3)
C 948 FORMAT(2X,I3,5X,F9.4,3X,F9.4)
C     RETURN
C  10 FORMAT (1H1,20A4//' HYDRODYNAMIC PRESSURES AT STATION',F5.1//
C    X' SPEED =',F7.3,' KNOTS      WAVE ANGLE =',F8.3,' DEG.')
C  11 FORMAT (//' WAVE FREQ.=',F8.5,' RAD/SEC'//' Y-COORD  Z-COORD
C    X  PORTSIDE*******        STARBOARDSIDE**'/'   (M)      (M)
C    X  AMPL.     PHASE        AMPL.     PHASE'/)
C  12 FORMAT (1H ,F7.3,F9.3,F14.3,F9.1,F14.3,F9.1)
C  13 FORMAT (1H0,'(NON-DIMENSIONAL)')
C     END
C     SUBROUTINE ANPASS(AWM,AWA,RPA,PA)
      SUBROUTINE ANPASS(AWM,AWA,RPA,H00,HCH0,GAMMB,PPER,INANT)
C
C
C     DIMENSION PA(1),EX(10),Y(10),RPA(1)
      DIMENSION H00(1),HCH0(1),GAMMB(1),PPER(1),EX(10),Y(10),RPA(1)
C
C     BER[KNA X F\R GX=0.5 OCH GX=0.98
C
      DO 9 NT=1,2
      GTEST=0.5
      IF(NT.EQ.2) GTEST=0.98
      X=0.0
C     DO 1 I=1,8
      DO 1 I=1,INANT
      B=RPA(I)*(H00(I)/0.49)**(1.0/1.33)
      IF(B.GT.X) X=B
    1 CONTINUE
      STEG=0.5*X
      LT=1
C
C
    2 GX=0.0
C     DO 4 I=1,8
      DO 4 I=1,INANT
      IF(RPA(I).GT.1.0E-30) GOTO 3
      GX=1.0
      GOTO 4
C   3 GX=GX+PA(I+24)*(1.0-EXP(-((0.5*(X/RPA(I))**1.33-
C    *   PA(I))/PA(I+8))**PA(I+16)))
    3 GX=GX+PPER(I)*(1.0-EXP(-((0.5*(X/RPA(I))**1.33-
     *   H00(I))/HCH0(I))**GAMMB(I)))
    4 CONTINUE
      IF(LT.NE.1) GOTO 15
      IF(GX.LT.GTEST) GOTO 15
      LT=4
      GOTO 2
   15 IF(LT.EQ.1) LT=2
      IF(LT.NE.2) GOTO 5
      IF(GX.GT.GTEST) GOTO 5
      X=X+STEG
      GOTO 2
C
    5 IF(LT.EQ.4) GOTO 8
      IF(GX.GT.GTEST-0.01) GOTO 6
      LT=3
      X=X+STEG
      STEG=STEG/2.0
      GOTO 2
C
    6 IF(GX.LT.GTEST+0.01) GOTO 7
      LT=3
      X=X-STEG
      STEG=STEG/2.0
      GOTO 2
C
    7 CONTINUE
      LT=4
      GOTO 2
    8 CONTINUE
      EX(NT)=X
    9 CONTINUE
      IF(GX.LT.1.0) GOTO 16
      AWA=0.0
      AWM=1.0
      RETURN
   16 CONTINUE
C
C     DELA INTERVALLET I TIO PUNKTER
C
      DX=ABS(EX(1)-EX(2))/9.0
      X=EX(1)-DX
      DO 12 I=1,10
      X=X+DX
      EX(I)=X
      GX=0.0
      DO 11 J=1,INANT
      IF(RPA(J).GT.1.0E-30) GOTO 10
      GX=1.0
      GOTO 11
C  10 GX=GX+PA(J+24)*(1.0-EXP(-((0.5*(X/RPA(J))**1.33-
C    *   PA(J))/PA(J+8))**PA(J+16)))
   10 GX=GX+PPER(J)*(1.0-EXP(-((0.5*(X/RPA(J))**1.33-
     *   H00(J))/HCH0(J))**GAMMB(J)))
   11 CONTINUE
      Y(I)=GX
   12 CONTINUE
      DO 13 I=1,10
      EX(I)=ALOG(EX(I))
      Y(I)=ALOG(-ALOG(1.0-Y(I)))
   13 CONTINUE
C
C     ANPASSA EN R[T LINJE
C
      A1=0.0
      B1=0.0
      B2=0.0
      C1=0.0
      C2=0.0
C
C
      DO 14 I=1,10
      X=EX(I)
      YY=Y(I)
      A1=A1+1.0
      B1=B1+X
      B2=B2+X*X
      C1=C1+YY
      C2=C2+YY*X
   14 CONTINUE
C
C
      PIV=B1/A1
      A=(C2-C1*PIV)/(B2-B1*PIV)
      B=(C1-B1*A)/A1
      AWM=A
      AWA=EXP(-B/A)
      RETURN
      END
      SUBROUTINE TNIRPA(XPOS,YPOS,ZPOS,NPOS)
      COMMON / CONDA / PI,GAMMA,GRAV,RO
      COMMON / MHDT / HDA(20),IB,IC,ID,IE,IF,IG,IH,II,IJ,IK,IL,INANT,
     B                H00(10),HCH0(10),GAMMB(10),PPER(10),TEXT(20),
     C                ASTA,IDS
      COMMON / BASDA / BPL,DISPL,TMASS,YNERT,BSTAR(21),AREA(21),
     X                 SECOE(21),DRAFT(21),ZBAR(21),XI(21),XISQ(21),
     X                 DWEIGH(21),DMASS(21),ZWT(21),GRL(21),ZCG,XNERT,
     X                 XZPERT,GM,MINKRI,MAXKRI,INCRES,ROLDPF
      COMMON / CASDA / NN,OMW(51),WVL(51),OMWE(51),VMIN,VMAX,DELV,
     X                 NWA,WAD(25),WANGI,WANGA,DWANG,NWI,WD(20),WLL(51)
      COMMON / TDIR / WE,WEN,ANS(21,10),KL,KU,IO,IW
      COMMON / MIMD / IA,NS,DXI,V,WANG,OMEGA,WAVEN,CW,DIX(21,5),FAC,WA
      COMMON / MOTN / ZM(51),ZP(51),TM(51),TP(51),SM(51),SP(51),YM(51),
     X                YP(51),RM(51),RP(51)
      COMMON / BMDA / CXFST(21),CXFL(21),CXMR(21),SBMM(51,3),SBMP(51,3)
      COMPLEX CXFST,CXFL,CXMR
      COMMON / PROGRA / CLBM(51,3),CLSH(51,2),SPACE(40),ZN(51),YN(51),
     X                  XN(51),WN(51),SMINNE(102)
      COMMON /BEND/ VSF(51),VSPH(51),ASF(51),ASPH(51)
      COMMON /IPLOT/ IPLO,I11,I22
      COMMON /SKIVPL/ IRAO,IWW(93),TEXTRAO(93),RAO(51,93)
      COMMON /SKIVP2/ WSPECT(51,10)
      DIMENSION HDAP(4),HDBP(5),HDCP(6),VN(51),XPOS(1),YPOS(1),ZPOS(1)
      DATA HDAP / 4H   A,4HMPL.,4H  PH,4HASE  /
      DATA HDBP / 4H    ,4HAMPL,4HITUD,4HE  P,4HHASE  /
      DATA HDCP / 4H    ,4H  SH,4HEAR ,4H    ,4H MOM,4HENT  /
      S=V*1.943845
      TPI=360.0*WA
      IF(IPLO.EQ.1) WRITE(7) NN
      MS=(NS+1)/2
      IF (II.GT.0) THEN
c     Dimensionslîst
         WAN=1.0/WA
         GLB=1.0/(GAMMA*BPL*BPL*BSTAR(MS)*WA)
         GLBB=1.0/(GAMMA*BPL*BSTAR(MS)*WA)
      ELSE
c     Dimensioner
         GLB=1.0
         GLBB=1.0
         WAN=1.0
      ENDIF
44    CONTINUE
      IF (IB.EQ.2) GO TO 71
      DO 70 I=1,NN
      VSF(I)=0.0
      VSPH(I)=0.0
      ASF(I)=0.0
      ASPH(I)=0.0
      SBMP(I,1)=0.0
      SBMP(I,2)=0.0
      SBMP(I,3)=0.0
      SBMM(I,1)=0.0
      SBMM(I,2)=0.0
   70 SBMM(I,3)=0.0
   71 CONTINUE
      IF (KL.GT.2) GO TO 20
C-01  PRINT OUT FREQUENCY RESPONSE FUNCTIONS, VERTICAL PLANE
      IF(IDS.LT.0) GO TO 72
      WRITE(6,920) HDA
      WRITE(6,935)
      IF (II.EQ.1) WRITE(6,937)
      WRITE(6,921) S,WAD(IW)
      WRITE(6,922)
72    DO 8 I=1,NN
c      VSF(I)=VSF(I)*GLB*BPL
      VSF(I)=VSF(I)*GLBB
      ZN(I)=ZM(I)*WAN
      IF(II.GT.0)  THEN
C        DIMENSIONSLôST
         YN(I)=TM(I)*WVL(I)/TPI
      ELSE
C        DIMENSIONER
         YN(I)=TM(I)
      ENDIF
    8 XN(I)=SBMM(I,1)*GLB
      WRITE(30,*)  NN
      DO 41 I=1,NN
      IF(IDS.GE.0) WRITE(6,930) OMW(I),OMWE(I),WLL(I),ZN(I),ZP(I),
     *             YN(I),TP(I),XN(I),SBMP(I,1),VSF(I),VSPH(I)
      WRITE(30,*)  OMW(NN+1-I),OMWE(NN+1-I),ZN(NN+1-I),ZP(NN+1-I),
     B             YN(NN+1-I),TP(NN+1-I)
      RAO(I,11)=OMW(I)
      RAO(I,12)=OMWE(I)
      RAO(I,13)=WLL(I)
      RAO(I,14)=ZN(I)
      RAO(I,15)=YN(I)
      RAO(I,16)=XN(I)
      RAO(I,17)=VSF(I)
   41 CONTINUE
      IF(IPLO.EQ.1) WRITE(7) (WLL(I),ZN(I),YN(I),XN(I),
     *              VSF(I),I=1,NN)
      IF (KU.LT.3) GO TO 40
C-02  PRINT OUT FREQUENCY RESPONSE FUNCTIONS, LATERAL PLANE
      IF(IDS.LT.0) GO TO 73
   20 WRITE(6,920) HDA
      WRITE(6,936)
      IF (II.EQ.1) WRITE(6,937)
      WRITE(6,921) S,WAD(IW)
      WRITE(6,927)
73    DO 25 I=1,NN
c     ASF(I)=ASF(I)*GLB*BPL
      ASF(I)=ASF(I)*GLBB    !!
      ZN(I)=SM(I)*WAN
      IF(II.GT.0) THEN
         FNX=WVL(I)/TPI
      ELSE
         FNX=1.0
      ENDIF
      YN(I)=YM(I)*FNX
      XN(I)=RM(I)*FNX
      WN(I)=SBMM(I,2)*GLB
   25 VN(I)=SBMM(I,3)*GLB
      DO 45 I=1,NN
      IF(IDS.GE.0) WRITE(6,931) WLL(I),ZN(I),SP(I),YN(I),YP(I),
     *             XN(I),RP(I),WN(I),SBMP(I,2),ASF(I),
     *             ASPH(I),VN(I),SBMP(I,3)
      WRITE(30,*)  WLL(NN+1-I),XN(NN+1-I)
      RAO(I,18)=ZN(I)
      RAO(I,19)=YN(I)
      RAO(I,20)=XN(I)
      RAO(I,21)=WN(I)
      RAO(I,22)=ASF(I)
      RAO(I,23)=VN(I)
   45 CONTINUE
C     IF(IRAO.LT.1) GO TO 98
C     ISPEED=FLOAT(S+0.1)
C     IWAD=FLOAT(WAD(IW)+0.1)
C     ITOT=IRAO + 1
C     WRITE(12,1200) ISPEED,IWAD,NN
C     WRITE(12,1210) (TEXTRAO(I),I=11,13)
C     DO 31 L=1,NN
C     WRITE(12,1211) (RAO(L,I),I=11,13)
C31   CONTINUE
C     DO 35 I=1,IRAO
C     WRITE(12,1210) TEXTRAO(IWW(I))
C     DO 36 L=1,NN
C     WRITE(12,1211) RAO(L,IWW(I))
36    CONTINUE
35    CONTINUE
C     WRITE(12,1201) (TEXTRAO(IWW(I)),I=1,IRAO)
C     DO 30 L=1,NN
C     WRITE(12,1202) (RAO(L,IWW(I)),I=1,IRAO)
C30   CONTINUE
C     DO 46 I=1,NN
C     WRITE(6,*) (RAO(I,IV),IV=1,13)
46    CONTINUE
98    CONTINUE
      IF(IPLO.EQ.1) WRITE(7) (WLL(I),ZN(I),YN(I),XN(I),WN(I),
     *              ASF(I),VN(I),I=1,NN)
   40 IF (IH.LE.0.OR.IB.LT.2) GO TO 60
C-03  PRINT OUT SHEAR AND MOMENT CLOSURE RESULTS
      WRITE(6,920) HDA
      WRITE(6,933)
      WRITE(6,921) S,WAD(IW)
      WRITE(6,926)
      WRITE(6,929)
      WRITE(6,925)
      WRITE(6,932) HDCP,HDCP,HDCP(5),HDCP(6)
      WRITE(6,934)(OMW(I),OMWE(I),WVL(I),WLL(I),(CLSH(I,K),CLBM(I,K),
     X   K=1,2),CLBM(I,3),I=1,NN)
   60 CONTINUE
      IF(NPOS.GT.0) CALL SSPA1(XPOS,YPOS,ZPOS,NPOS,0)
      RETURN
  920 FORMAT (1H1,20A4)
  921 FORMAT (1H0,'SPEED = ',F6.3,' KNOTS   WAVE ANGLE = ',F7.3,' DEG.')
  922 FORMAT(/2X,'WAVE  ENCOUNT. WAVE/SHIP',6X,'HEAVE',
     *       12X,'PITCH',7X,'VERT. BEND.MT.',4X,'VERT.SH.FORCE'/
     *       3X,'FREQUENCIES    LENGTH',4(4X,'AMPL. PHASE  ')/)
  925 FORMAT (43H  F R E Q U E N C I E S   LENGTH    LENGTH  )
  926 FORMAT (/45H0   WAVE     ENCOUNTER    WAVE      WAVE/SHIP )
  927 FORMAT(/1X,'WAVE/SHIP',6X,'SWAY',14X,'YAW',13X,'ROLL',9X,
     *       'LAT. BEND.MT.    LAT. SH.FORCE    TORSIONAL MT.'/
     *       2X,'LENGTH ',6(4X,'AMPL. PHASE  ')/)
  929 FORMAT (1H+,48X,'VERTICAL BENDING        LATERAL BENDING',8X,
     B        'TORSIONAL' )
  930 FORMAT(F7.4,F8.4,F9.4,1X,2(F8.4,F7.1,2X),2(E9.3,F7.1,1X))
  931 FORMAT(F8.4,1X,3(F8.4,F7.1,2X),3(E9.3,F7.1,1X))
  932 FORMAT (1H+,42X,12A4,4X,2A4 /)
  933 FORMAT (1H0    ,32HSHEAR AND MOMENT CLOSURE RESULTS )
  934 FORMAT (2F11.5,F11.3,F10.4,5E12.3)
  935 FORMAT (1H0    ,24HVERTICAL PLANE RESPONSES )
  936 FORMAT (1H0    ,23HLATERAL PLANE RESPONSES )
  937 FORMAT (1H+,26X,17H(NON-DIMENSIONAL) )
1200  FORMAT(I2,8X,I3,7X,I2,8X,I2)
1201  FORMAT(13(3X,A4,3X))
1202  FORMAT(13F10.3)
1210  FORMAT(3(4X,A4,2X))
1211  FORMAT(3F10.4)
      END
      SUBROUTINE PRELIC(SPEED,ISPEED)
      COMMON / CONDA / PI,GAMMA,GRAV,RO
      COMMON / MHDT / HDA(20),IB,IC,ID,IE,IF,IG,IH,II,IJ,IK,IL,INANT,
     B                H00(10),HCH0(10),GAMMB(10),PPER(10),TEXT(20),
     C                ASTA,IDS
      COMMON / BASDA / BPL,DISPL,TMASS,YNERT,BSTAR(21),AREA(21),
     X                 SECOE(21),DRAFT(21),ZBAR(21),XI(21),XISQ(21),
     X                 DWEIGH(21),DMASS(21),ZWT(21),GRL(21),ZCG,XNERT,
     X                 XZPERT,GM,MINKRI,MAXKRI,INCRES,ROLDPF
      COMMON / CASDA / NN,OMW(51),WVL(51),OMWE(51),VMIN,VMAX,DELV,
     X                 NWA,WAD(25),WANGI,WANGA,DWANG,NWI,WD(20),WLL(51)
      COMMON / MIMD / IA,NS,DXI,V,WANG,OMEGA,WAVEN,CW,DIX(21,5),FAC,WA
      COMMON / TDR / M ,SBH(21),SBBB(21)
      COMMON /   / TDP(21,25,10)
      COMMON / SHTD / NHDG,RPA(10,10,25),NLH(25),NB(10),S,NSNIV
      COMMON / PROGRA / STORAG(484),RSA(10),HDC(5),SMINNE(102)
      DIMENSION     OMT(25),SPEED(1)
      DIMENSION STS(10)
      DATA STS/3HMN.,3H SQ,3HR.M,3H.S.,3HAVG,3H.  ,3HSIG,3H.  ,3HAV1,
     X3H/10  /
      DATA NF / 25 /
      DATA OMT / 0.0, 0.01, 0.03, 0.06, 0.10, 0.15, 0.21, 0.28, 0.36,
     X           0.45, 0.55, 0.67, 0.82, 1.01, 1.25, 1.55, 1.95, 2.45,
     X           3.05, 3.8, 4.7, 5.8, 7.1, 8.7, 10.7 /
C-01  READ AND PRINT CONDITIONAL INPUT DATA CARDS
   20 READ(5,907) WA,SWL,BWL,DELWL,VMIN,VMAX,DELV
      IF ( WA-0.0 )  60,1,27
   27 WRITE(6,920) HDA
      WRITE(6,832)
      WRITE(6,707) WA
      WRITE(6,708) SWL,BWL,DELWL
      WRITE (6,710) (SPEED(I),I=1,ISPEED)
      IF ( IE.LT.1 )  GO TO 26
      READ(5,907) ROLDPF
      WRITE(6,711) ROLDPF
   26 READ(5,907) WANGI,WANGA,DWANG
      WRITE(6,712) WANGI,WANGA,DWANG
      IF ( ID.LT.1 )  GO TO 25
      IF (ID.LT.4) GO TO 23
      READ(5,995) NSNIV,NB
      READ(5,996) (NLH(I),I=1,25)
      IF(ID.EQ.4) NWI=8
      IF(ID.GT.4) NWI=INANT
      DO 24 I=1,INANT
   24 WD(I)=1.0
      IN1=10+INANT
      IF(ID.EQ.5) READ(5,910)(WD(I),I=11,IN1)
      IF(ID.EQ.6) READ(1,100)(WD(I),I=11,IN1)
      IF(ID.GE.5) WRITE(8,911)(WD(I),I=11,IN1)
      IF(ID.GT.4) GO TO 25
      WD(11)=5.5
      WD(12)=6.5
      WD(13)=7.3
      WD(14)=8.0
      WD(15)=8.6
      WD(16)=9.2
      WD(17)=9.7
      WD(18)=10.2
      GO TO 25
   23 READ(5,908) NWI,(WD(I),I=1,10)
      IF ( ID.EQ.2 ) WRITE(6,713) NWI,(WD(I),I=1,10)
      IF ( ID.EQ.2 )  GO TO 25
      WRITE(6,714) NWI,(WD(I),I=1,10)
      READ(5,909) (WD(I),I=11,20)
      WRITE(6,715) (WD(I),I=11,20)
C-03  INPUT DATA ERROR CHECK
   25 IX = 0
      IF ( MINKRI.NE.MAXKRI .AND. INCRES.LE.0 )  IX = 3
      IF ( SWL.NE.BWL  .AND.  DELWL.LE.0.0 )     IX = 3
      IF ( VMIN.NE.VMAX .AND. DELV.LE.0.0 )      IX = 3
      IF ( WANGI.NE.WANGA .AND. DWANG.LE.0.0 )   IX = 3
      IF ( IX.NE.0 )  GO TO 950
C-05  INITIALIZE (AND CHECK) INTERNAL PARAMETERS
      M = NS
      DET = 1.0
      DDT = 1.0
      IF (NWI.GT.10.AND.ID.GT.0) GO TO 951
      NN=1
      IF (DELWL.EQ.0.0) GO TO 21
      NN = (BWL-SWL)/DELWL+1.001
   21 IF ( NN.GT.51 ) GO TO 951
      IF ( ID.LT.1 )  GO TO 30
C-06  PRELIMINARY CALCULATIONS FOR IRREGULAR WAVES
      DO 22  I=1,NN
      OMX = BPL*EXP(BWL-DELWL*(I-1))
   22 OMW(I) = SQRT(2*PI*GRAV/OMX)
      CALL PAR
      IF ( IF.LT.1 )  GO TO 32
      IF (WANGI.NE.180.0) GO TO 28
      WANGI=90.0
      WANGA=180.0
      IF (DWANG.EQ.0.0) DWANG=15.0
      GO TO 32
   28 WANGI=0.0
      WANGA=180.0
      GO TO 32
C-07  PRELIMINARY CALCULATIONS FOR REGULAR WAVES
   30 DO 31  I=1,NN
      OMX = BPL*EXP(SWL+DELWL*(I-1))
   31 OMW(I) = SQRT(2*PI*GRAV/OMX)
   32 NWA=1
      IF (DWANG.EQ.0.0) GO TO 34
      NWA = (WANGA-WANGI)/DWANG+1.001
   34 IF ( NWA.GT.25 )  GO TO 951
      DO 33  I=1,NWA
      WAD(I) = WANGI+DWANG*(I-1)
   33 CONTINUE
C-09  CALCULATE TWO-DIMENSIONAL SECTION PROPERTIES
C     AND CONVERT TO DIMENSIONAL RESULTS
   40 IF ( IG.GT.0 )  GO TO 50
      DO 41 I=1,21
      DO 41 J=1,25
      DO 41 K=1,10
   41 TDP(I,J,K)=0.0
      CALL CKLEW
      IF (IE.GT.1 )  GO TO 42
C-10  VERTICAL OSCILLATIONS
      CALL ZIPSMO (DET)
      FA = PI*RO/8.0
      DO 45  J=1,M
      FAC = FA*BSTAR(J)**2
      DO 45  I=1,NF
   45 TDP(J,I,1) = TDP(J,I,1)*FAC
      IF ( IE.LT.1 )  GO TO 43
C-11  LATERAL AND ROLLING OSCILLATIONS
   42 CALL TDLR (DDT)
      DO 46  J=1,M
      RBOG = SQRT(BSTAR(J)/(2.0*GRAV))
      IF ( RBOG .LE. 0.0 )  GO TO 46
      RSA(3) = RO*AREA(J)
      RSA(4) = RSA(3)/RBOG
      RSA(5) = RSA(3)*BSTAR(J)
      RSA(6) = RSA(5)/RBOG
      RSA(7) = RSA(5)*BSTAR(J)
      RSA(8) = RSA(7)/RBOG
      RSA(9) = RSA(5)
      RSA(10) = RSA(6)
      DO 44  I=1,NF
      DO 44  K=3,10
   44 TDP(J,I,K) = TDP(J,I,K)*RSA(K)
   46 CONTINUE
C-12  WRITE TDP ARRAY ON FILE (TAPE10)
   43 IF(IG.GT.0) GO TO 50
   53 WRITE(10) (HDA(I),I=1,5)
      DO 54 J=1,M
      DO 54 I=1,NF
54    WRITE(10) (TDP(J,I,K),K=1,10)
      IF(IG.LT.0) GO TO 51
   70 CONTINUE
      IF ( DET.EQ.0.0 .OR. DDT.EQ.0.0 )  IX = 4
C-13  PRINT OUT TWO-DIMENSIONAL SECTION PROPERTIES
   47 WRITE(6,920) HDA
      WRITE(6,997)
      DO 48  J=1,M
      STA = J-0.50*(1+IA)
      WRITE(6,998) STA
      WRITE(6,999) OMT(1),(TDP(J,1,K),K=2,10),
     X           ( OMT(I), (TDP(J,I,K),K=1,10),I=2,NF)
      WRITE(6,906)
   48 CONTINUE
      GO TO 51
C-08  READ TDP ARRAY FROM FILE (TAPE10)
   50 IF ( IG.GT.2 )  GO TO 51
      READ (10) (HDC(I),I=1,5)
      DO 52 I=1,5
      IF ( HDC(I) .NE. HDA(I) )  GO TO 949
   52 CONTINUE
      READ  (10) (((TDP(J,I,K),J=1,M),I=1,NF),K=1,10)
      IF ( IG.EQ.1 )  GO TO 47
   51 IG = 3
      IF ( IX.NE.0 )  GO TO 950
      RETURN
C-02  GO BACK FOR NEW BASIC INPUT DATA
    1 CALL PRELIB
      GO TO 20
C-04  ERROR STOPS
  949 IX = 5
  950 IX = IX+1
  951 WRITE(6,940) IX
      IF ( IX.EQ.6 )  WRITE(6,941) HDC
   60 STOP
  100 FORMAT(10F8.0)
  707 FORMAT (1X,'WAVE AMPLITUDE        =',F8.3,'  M')
  708 FORMAT (1H0,'LN(WAVE LENGTH/SHIPLENGTH):'/
     *        1H0,'            (INITIAL) =',F8.3/
     *         1X,'            (FINAL)   =',F8.3/
     *         1X,'            (INCR.)   =',F8.3)
  710 FORMAT (1H0,'SHIP SPEED            =',9F7.2,'  KNOTS'/)
  711 FORMAT (1H0,'FRACT. OF CRIT. ROLL DAMPING  =',F8.4)
  712 FORMAT (1H0,'WAVE ANGEL  (INITIAL) =',F8.3,'  DEGREES'/13X,'(FINAL
     X)   =',F8.3,'  DEGREES'/13X,'(INCR.)   =',F8.3,'  DEGREES')
  713 FORMAT (1H0,'NUMBER OF WAVE SPECTRA=',I5//1X,'WIND SPEEDS   = ',
     X10F5.1,'  (KNOTS)')
  714 FORMAT (1H0,'NUMBER OF WAVE SPECTRA=',I5//1X,'SIG. WAVE HT. = ',
     X10F5.1,'  (M) (PEAK TO PEAK)')
  715 FORMAT (1X,'MEAN PERIODS  = ',10F5.1,'  (SEC)')
  832 FORMAT ( /1X,'CONDITIONAL INPUT DATA'/)
  906 FORMAT(1H1)
  907 FORMAT ( 8F10.4)
  908 FORMAT ( I10, 10F5.1 )
  909 FORMAT ( 10X, 10F5.1 )
  910 FORMAT(10F8.0)
911   FORMAT(' TZ   =',10(F8.5,1X))
  920 FORMAT (1H1,20A4)
  940 FORMAT ( 39H0STOP IN SUBROUTINE PRELIMC.  ERROR NO. , I3)
  941 FORMAT ( 15H0TDP FILE LABEL , 5X, 5A4)
  995 FORMAT(11I2)
  996 FORMAT(25I2)
  997 FORMAT ( 1H0,10X,34HTWO-DIMENSIONAL SECTION PROPERTIES /4X,5HFREQ.
     X/4X,127HPARAM. A-PRIME(33)  A(BAR)SQ.    M-SUB(S)    N-SUB(S)    M
     X(S.PHI)    N(S.PHI)    I-SUB(R)    N-SUB(R)   F-SUB(R.S)  N-SUB(R.
     XS)  /13X,'(TON/M)       (-)       (TON/M)    (TON/M*SEK)   (TON)
     X    (TON/SEK)   (TON*M)    (TON*M/SEK)   (TON)      (TON/SEK)')
  998 FORMAT ( 4H STA , F5.1 )
  999 FORMAT ( F10.4, 10H INFINITY  , 9E10.3/ ( F10.4, 10E10.3) )
      END
      SUBROUTINE STATI(XPOS,YPOS,ZPOS,NPOS)
      COMMON / MHDT / HDA(20),IB,IC,ID,IE,IF,IG,IH,II,IJ,IK,IL,INANT,
     B                H00(10),HCH0(10),GAMMB(10),PPER(10),TEXT(20),
     C                ASTA,IDS
      COMMON / CONDA / PI,GAMMA,GRAV,RO
      COMMON / BASDA / BPL,DISPL,TMASS,YNERT,BSTAR(21),AREA(21),
     X                 SECOE(21),DRAFT(21),ZBAR(21),XI(21),XISQ(21),
     X                 DWEIGH(21),DMASS(21),ZWT(21),GRL(21),ZCG,XNERT,
     X                 XZPERT,GM,MINKRI,MAXKRI,INCRES,ROLDPF
      COMMON / CASDA / NN,OMW(51),WVL(51),OMWE(51),VMIN,VMAX,DELV,
     X                NWA,WAD(25),WANGI,WANGA,DWANG,NWI,WD(20),WLL(51)
      COMMON / MIMD / IA,NS,DXI,V,WANG,OMEGA,WAVEN,CW,DIX(21,5),FAC,WA
      COMMON / TDIR / WE,WEN,ANS(21,10),KL,KU,IO,IW
      COMMON / MOTN / RAM(51,10)
      COMMON / BMDA / SPACE(126),SBMM(51,3),SPACEB(153)
      COMMON / STAT / SPECM(10,51),RSD(10,10,25)
      COMMON / SHTD / NHDG,RPA(10,10,25),NLH(25),NB(10),S,NSNIV
      COMMON / PROGRA / RSP(51,10),Y(51),RST(10,4)
      COMMON /BEND/ VSF(51),VSPH(51),ASF(51),ASPH(51)
      COMMON / IPLOT / IPLO,IDUM1,IDUM2
      COMMON /SIVFIL/  IRSV,IWX(80),TEXTRSV(80),RSVHNR(10,80)
      COMMON /SKIVPL / IRAO,IWW(93),TEXTRAO(93),RAO(51,93)
      DIMENSION STS(10),XPOS(1),YPOS(1),ZPOS(1)
      DIMENSION  YY(51),RSYD(10,10,25),RSYT(51,10)
      DATA STS/3HMN.,3H SQ,3HR.M,3H.S.,3HAVG,3H.  ,3HSIG,3H.  ,3HAV1,
     X3H/10  /
C-01  SET CALCULATION PARAMETERS
      MS=(NS+1)/2
      S=V*1.943845
      DEL=2*ALOG(OMW(3)/OMW(2))
      WAS=WA*WA
      GLB=GAMMA*BSTAR(MS)*BPL*WA
      JU=2+KU/3
      JB=6+KL/3
      JC=6+KU/5
      DO 3 I=1,10
      DO 3 L=1,NN
    3 RSP(L,I)=0.0
      IF (IW.GT.1) GO TO 1
      DO 5 I=1,10
      DO 5 J=1,10
      DO 5 K=1,25
    5 RSD(I,J,K)=0.0
C-02  CALCULATE RESPONSE SPECTRA (AND INTEGRATE) FOR EACH SEA STATE
1     CONTINUE
      IF(IL.EQ.1) GOTO 22
      IF(IPLO.NE.1) WRITE(6,920) HDA
      IF(IPLO.NE.1) WRITE(6,921) S,WAD(IW)
      WRITE(6,932)
   22 CONTINUE
      DO 10 K=1,NWI
C-03  VERTICAL AND LATERAL MOTIONS
      DO 4 I=KL,JU
      JI=2*I-1
      DO 2 L=1,NN
C     KORREKTION D] M\TESFREKVENSEN G]R MOT NOLL. (AKTERLIG SJ\)
      IF (ABS(OMWE(L)).LT.0.1.AND.WAD(IW).LT.90.0) THEN
         RAM(L,1)=0.0
         RAM(L,3)=0.0
         RAM(L,5)=0.0
         RAM(L,7)=0.0
         RAM(L,9)=0.0   ! ROLL
      ENDIF
   35 CONTINUE
      Y(L)=SPECM(K,L)*RAM(L,JI)**2/WAS
      YY(L)=Y(L)*OMWE(L)*OMWE(L)
    2 RSP(L,I)=Y(L)
      RSYD(I,K,IW)=SINT(1,NN,YY,DEL)
    4 RSD(I,K,IW)=SINT(1,NN,Y,DEL)
      IF (IB.LT.2) GO TO 9
C-04  BENDING AND TORSIONAL MOMENTS
      DO 8 I=JB,JC
      JI=I-5
      JJ=I+JI-1
      DO 6 L=1,NN
      IF (ABS(OMWE(L)).LT.0.1.AND.WAD(IW).LT.90.0) SBMM(L,JI) =0
      Y(L)=SPECM(K,L)*SBMM(L,JI)**2
    6 RSP(L,JJ)=Y(L)
    8 RSD(JJ,K,IW)=SINT(1,NN,Y,DEL)
      DO 16 I=1,NN
      IF (ABS(OMWE(I)).LT.0.1.AND.WAD(IW).LT.90.0) THEN
         RKVOT =0.0
      ELSE
         RKVOT=(VSF(I)*GLB)**2
      ENDIF
cc       Y(I)=SPECM(K,I)*(VSF(I)*GLB)**2
      Y(I)=SPECM(K,I)*RKVOT
      RSP(I,7)=Y(I)
   16 CONTINUE
      RSD(7,K,IW)=SINT(1,NN,Y,DEL)
      DO 17 I=1,NN
      IF (ABS(OMWE(I)).LT.0.1.AND.WAD(IW).LT.90.0) THEN
         RKVOT =0.0
      ELSE
         RKVOT=(ASF(I)*GLB)**2
      ENDIF
      Y(I)=SPECM(K,I)*RKVOT
      RSP(I,9)=Y(I)
   17 CONTINUE
      RSD(9,K,IW)=SINT(1,NN,Y,DEL)
C-05  CALCULATE SIGNIFICANT RESPONSES
    9 DO 15 L=1,10
      RST(L,2)=SQRT(RSD(L,K,IW))
      RST(L,1)=2.0*RST(L,2)
   15 CONTINUE
C     CALCULATE MEAN PERIODE
      DO 26 L=1,5
      IF(RSYD(L,K,IW).LT.10.E-5) GO TO 29
      RSYT(L,K)=2*PI*SQRT(RSD(L,K,IW)/RSYD(L,K,IW))
      GO TO 26
29    RSYT(L,K)=0.0
26    CONTINUE
C-06  PRINT OUT RESPONSE SPECTRA AND STATISTICS
      IF(IL.NE.1) GOTO 20
      WRITE(6,920) HDA
      WRITE(6,921) S,WAD(IW)
      IF (ID.EQ.2) WRITE(6,923) WD(K)
      IF (ID.NE.2) WRITE(6,925) WD(K),WD(K+10)
      WRITE(6,922)
      DO 21 I=1,NN
      WRITE(6,926) WLL(I),(RSP(I,J),J=1,10)
   21 CONTINUE
      WRITE(6,928) STS(7),STS(8),(RST(L,1),L=1,10)
      GOTO 23
   20 CONTINUE
      WRITE(6,933)K,(RST(L,1),L=1,10)
      DO 30 KK=1,10
      RSVHNR(K,KK)=RST(KK,1)
30    CONTINUE
   23 CONTINUE
      IF(ID.LT.4) GOTO 10
      DO 25 I=1,10
   25 RPA(I,K,IW)=RST(I,2)
   10 CONTINUE
      IF(IL.LE.1) GO TO 27
C     IL=2
      WRITE(6,934)
      DO 28 K=1,NWI
28    WRITE(6,1933) K,(RSYT(L,K),L=1,5)
27    NHDG=NWA
      IF(NPOS.GT.0) CALL SSPA1(XPOS,YPOS,ZPOS,NPOS,1)
      IF (IW.EQ.NWA.AND.IF.EQ.0.AND.ID.GE.4)
     *  CALL LTD(NPOS,XPOS,YPOS,ZPOS)
      RETURN
  920 FORMAT (1H1,20A4//' RESPONSE SPECTRA (LONGCRESTED IRREGULAR SEA)')
  921 FORMAT (7H0SPEED=,F6.3,' KNOTS   WAVE ANGLE=',F7.3,' DEG.')
  922 FORMAT(/1X,'WAVE/SHIP'/2X,'LENGTH    HEAVE',
     *       5X,'PITCH    S W A Y   Y  A  W',
     *       3X,'R O L L  VERT.B.M. VERT.SH.',
     *       2X,'LAT.B.M.   LAT.SH.  TORSNL.M.'/)
  923 FORMAT (1H+,54X,13HWIND SPEED = ,F6.2,7H KNOTS, )
  925 FORMAT (1H+,47X,'SIG. WAVE HT.=',F4.1,' M   MEAN PERIOD=',F5.1,' S
     XEC')
  926 FORMAT(F8.4,1X,10(1X,E9.3))
  928 FORMAT(/3X,2A3,10(1X,E9.3)/)
  932 FORMAT(/1X,'SPECTRUM  HEAVE   PITCH   SWAY     YAW',
     *       4X,'ROLL   VERT.B.M.  VERT.SH.  LAT.B.M.',
     *       3X,'LAT.SH. TORSNL.M.'/)
  933 FORMAT(I5,3X,5(1X,F7.4),5(1X,E9.3))
934   FORMAT(4(/),3X,'RESPONSE MEAN PERIODE',//1X,'SPECTRUM  HEAVE',
     B        3X,'PITCH   SWAY     YAW    ROLL'/)
1933  FORMAT(1X,I5,5(1X,F7.2))
      END
      SUBROUTINE CKLEW
      COMMON / CONDA / PI,GAMMA,GRAV,RO
      COMMON / BASDA / BPL,DISPL,TMASS,YNERT,BSTAR(21),AREA(21),
     X                 SECOE(21),DRAFT(21),ZBAR(21),XI(21),XISQ(21),
     X                 DWEIGH(21),DMASS(21),ZWT(21),GRL(21),ZCG,XNERT,
     X                 XZPERT,GM,MINKRI,MAXKRI,INCRES,ROLDPF
      COMMON / TDR / M ,SBH(21),SBBB(21)
      COMMON /   / TDP(21,25,10)
      DIMENSION     OMT(25)
      DATA ERI, ERD / 2HIN , 2HDE /
      DATA NF / 25 /
      DATA OMT / 0.0, 0.01, 0.03, 0.06, 0.10, 0.15, 0.21, 0.28, 0.36,
     X           0.45, 0.55, 0.67, 0.82, 1.01, 1.25, 1.55, 1.95, 2.45,
     X           3.05, 3.8, 4.7, 5.8, 7.1, 8.7, 10.7 /
      PIBR = PI*3.0/32.0
C-01  CHECK SECTION PARAMETERS AGAINST LEWIS FORM CRITERION
      DO 1 I=1,M
      SBBB(I)=SECOE(I)
      IF(DRAFT(I).LE.0.0) GO TO 11
      SBH(I)=BSTAR(I)/(2.0*DRAFT(I))
      IF(SBH(I).LE.0.0)  GO TO 11
      IF (SBH(I)-1.0) 2,2,4
C-02  ZERO SECTION
   11 SBH(I) = 0.0
      GO TO 1
    2 IF (SBBB(I) .GE. PIBR*(2.0-SBH(I)))  GO TO 5
      SBBB(I) = PIBR*(2.0-SBH(I))
      GO TO 7
    4 IF (SBBB(I) .GE. PIBR*(2.0-1.0/SBH(I)))  GO TO 5
      SBBB(I) = PIBR*(2.0-1.0/SBH(I))
    7 WRITE(6,20) I,ERI,SECOE(I),SBBB(I)
      SBBB(I)=1.0001*SBBB(I)
C     AVRUNDNINGSFEL I ZIPSMO
      GO TO 1
    5 IF ( SBBB(I).LE. PI*(SBH(I)+1.0/SBH(I)+10.0)/32.0)  GO TO 1
      SBBB(I) = PI*(SBH(I)+1.0/SBH(I)+10.0)/32.0
      WRITE(6,20) I,ERD,SECOE(I),SBBB(I)
      SBBB(I)=0.9999*SBBB(I)
C     AVRUNDNINGSFEL I ZIPSMO
    1 CONTINUE
      RETURN
   20 FORMAT (9H0 SECTION,I3,43H NOT VALID LEWIS FORM. SECTION AREA COEF
     XF. ,A2,12HCREASED FROM,F7.4,3H TO,F7.4,21H FOR T.D.PROP. CALCS.)
      END
      SUBROUTINE PAR
      COMMON / CONDA / PI,GAMMA,GRAV,RO
      COMMON / MHDT / HDA(20),IB,IC,ID,IE,IF,IG,IH,II,IJ,IK,IL,INANT,
     B                H00(10),HCH0(10),GAMMB(10),PPER(10),TEXT(20),
     C                ASTA,IDS
      COMMON / CASDA / NN,OMW(51),WVL(51),OMWE(51),VMIN,VMAX,DELV,
     X                 NWA,WAD(25),WANGI,WANGA,DWANG,NWI,WD(20),WLL(51)
      COMMON / STAT / SPECM(10,51),RSD(10,10,25)
      COMMON / PROGRA / STORAG(398),Y(51),WVST(10,5),SMINNE(102)
      COMMON /SKIVP2 / WSPECT(51,10)
      DIMENSION STS(10),SPECOM(10)
      DIMENSION SPC(24)
      DATA SPC/3HJON,3HSWA,3HP (,3HT=T,3HPEA,3HK/1,3H.40,3H81),
     X         3HPIE,3HRSO,3HN-M,3HOSK,3HOWI,3HTZ ,3H(19,3H64),
     X         3HTWO,3H PA,3HRAM,3HETE,3HR, ,3HISS,3HC 1,3H967/
      DATA STS/3HMN.,3H SQ,3HR.M,3H.S.,3HAVG,3H.  ,3HSIG,3H.  ,3HAV1,
     X3H/10  /
      GSQUAR = GRAV*GRAV
      AX=0.0
      BX=0.0
      CX=0.0
      DX=0.0
C-01  CALCULATE WAVE SPECTRAL DENSITY AT EACH FREQUENCY
      DO 50  KK=1,NN
      VOITH = OMW(KK)*OMW(KK)
      OMSQ = OMW(KK)*VOITH*VOITH
      FAW=0.5*OMW(KK)
C-02  LOOP OVER WIND SPEED (OR SEA STATE) RANGE
      DO 49  I=1,NWI
      H13=WD(I)
      U = WD(I)*0.5144444
      IF (ID.GE.4) GO TO 30
      GO TO ( 10, 20, 30 ) , ID
C-3-4 JONSWAP SPECTRUM (T2=PEAK PERIOD/1.4081)
   10 CONTINUE
      K = 10+I
      T2=WD(K)
      SPECM(I,KK) = SPEK(1,H13,T2,OMW(KK),AX,BX,CX,DX) * FAW
      GO TO 49
C-3-4 PIERSON-MOSKOWITZ SPECTRUM (1964) FORFULLY ARISEN SEAS
   20 POWER = -.74*(GSQUAR/(U*U*VOITH))**2
      IF (POWER.LT.-170.0) POWER=-170.0
      SPECM(I,KK) = .0081*GSQUAR*EXP(POWER)/OMSQ*FAW
      GO TO 49
C-3-4 TWO PARAMETER SPECTRUM,BASED ON SIGNIFICANT WAVE HEIGHT AND MEAN
C     WAVE PERIOD, SIMILAR TO I.S.S.C. NOMINAL (1967)
   30 CONTINUE
      K = 10+I
      T2=WD(K)
      SPECM(I,KK) = SPEK(0,H13,T2,OMW(KK),AX,BX,CX,DX) * FAW
   49 CONTINUE
   50 CONTINUE
C-05  INTEGRATE WAVE SPECTRA TO OBTAIN WAVE AMPLITUDE STATISTICS
      DEL=2*ALOG(OMW(3)/OMW(2))
      DO 60 K=1,NWI
      DO 55 L=1,NN
   55 Y(L)=SPECM(K,L)
      WVST(K,1) = SINT(1,NN,Y,DEL)
      WVST(K,2) = SQRT(WVST(K,1))
      WVST(K,3) = WVST(K,2)*1.2245
      WVST(K,4) = WVST(K,2)*2.0
      WVST(K,5)=WVST(K,2)*2.5452
   60 CONTINUE
C-06  PRINT OUT WAVE SPECTRA AND AMPLITUDE STATISTICS
      WRITE(6,920) HDA
      ISS=ID*4
      IF (ID.GE.4) ISS=12
      ISI=ISS-3
      WRITE(6,101) (SPC(2*I-1),SPC(2*I),I=ISI,ISS,1)
      IF (ID.EQ.2)  WRITE(6,104) (WD(K),K=1,NWI)
      IF (ID.EQ.2)  GO TO 51
      WRITE(6,105) (WD(K),K=1,NWI)
      I = 10+NWI
      WRITE(6,106) (WD(K),K=11,I)
   51 WRITE(6,107) (I,I=1,NWI)
      WRITE(6,108)
      DO 52 I=1,NN
      DO 53 IN=1,NWI
      SPECOM(IN)=SPECM(IN,I)/(0.5*OMW(I))
      WSPECT(I,IN)=SPECOM(IN)
53    CONTINUE
      WRITE(6,102) OMW(I),(SPECOM(K),K=1,NWI)
   52 CONTINUE
      WRITE(6,100)
   65 WRITE(6,103) STS(7),STS(8),(WVST(L,4),L=1,NWI)
      RETURN
  100 FORMAT ( 1H  )
  101 FORMAT ( 1H0,23HWAVE SPECTRAL DENSITY, ,8A3,8H SPECTRA/)
  102 FORMAT(F8.3,3X,10F9.3)
  103 FORMAT ( 2X,2A3,3X,10F9.3)
  104 FORMAT ( 1X, 26HFOR WIND SPEEDS (KNOTS) OF //12X, 10F9.3)
  105 FORMAT ( 1X, 7HSIG.HT. ,3X,11F9.3)
  106 FORMAT ( 1X, 7HMN.PER. ,3X,11F9.3)
  107 FORMAT (1X,'SPECTRA NO.',10(I8,1X))
  108 FORMAT (1X,'WAVE FREQ.'/1X,'(RAD/SEC)')
  920 FORMAT (1H1,20A4)
      END
      FUNCTION SPEK(JOX,H13,T2,OMEG,SGA,SGB,GAM,ALF)
C **********************************************************************
      TOPI=6.283185
      JONSW=1
      IF(JOX.NE.1) JONSW=0
      IF(SGA.LE.0.0) SGA=0.07
      IF(SGB.LE.0.0) SGB=0.09
      IF(GAM.LE.0.0) GAM=3.3
      IF(ALF.LE.0.0) ALF=0.072
      SPEK=0.0
      FFAK=1.0
      IF(JONSW.NE.1) GO TO 40
      FARG=OMEG*1.4081*T2/TOPI - 1.0
      SIG2=SGB*SGB
      IF(FARG.LE.0.0) SIG2=SGA*SGA
      FFAK=-FARG*FARG*0.5/SIG2
      IF(FFAK.LT.-170.0) FFAK=-170.0
      FFAK=EXP(FFAK)
      FFAK=GAM**FFAK*ALF/0.11
   40 CONTINUE
      XLA=TOPI/OMEG/T2
      ARG=0.32*XLA**4
      S=0.0
      IF(ARG.LT.170.0) S=0.25/OMEG*ARG/EXP(ARG)
      SPEK=H13*H13*S*FFAK
      RETURN
      END
      SUBROUTINE SPREAD(XPOS,YPOS,ZPOS,NPOS)
      COMMON /SSP/ SSPA(7,10,20,20),SSPB(2,10,20,20)
      COMMON / CONDA / PI,GAMMA,GRAV,RO
      COMMON / MHDT / HDA(20),IB,IC,ID,IE,IF,IG,IH,II,IJ,IK,IL,INANT,
     B                H00(10),HCH0(10),GAMMB(10),PPER(10),TEXT(20),
     C                ASTA,IDS
      COMMON / PIN / PSERH(25,10),QSERH(25,10),PSERS(25,10),QSERS(25,10)
     X              ,PSERR(25,10),QSERR(25,10),AXO(10),AYO(10),NSTA
      COMMON / CASDA / NN,OMW(51),WVL(51),OMWE(51),VMIN,VMAX,DELV,
     X                 NWA,WAD(25),WANGI,WANGA,DWANG,NWI,WD(20),WLL(51)
      COMMON / MIMD / IA,NS,DXI,V,WANG,OMEGA,WAVEN,CW,DIX(21,5),FAC,WA
      COMMON / STAT / SPECM(10,51),RSD(10,10,25)
      COMMON / SHTD / NHDG,RPA(10,10,25),NLH(25),NB(10),S,NSNIV
      COMMON / PROGRA / STORAG(49),SPF(25),Y(25),SRS(10,10,4),
     *                  SMINNE(102)
      DIMENSION STP(8),SPAR2(10),SPAR3(10),Y2(25)
      DIMENSION XPOS(1),YPOS(1),ZPOS(1),SPAR(7,10,10)
      DATA STP / 3HCOS,3HINE,3H-SQ,3HRD.,3H   ,3H   ,3H   ,3H    /
      S=V*1.943845
      RWANG=DWANG*PI/180.0
      NA=NWA
      NHDG=1
      IF (WANGI.EQ.0.0) NHDG=NA
      KL=1
      IF (IE.GT.1) KL=3
      JU=10
      IF (IE.LT.1) JU=2
C-01  CALCULATE WAVE SPREADING FUNCTION
      DO 20 I=1,NA
      IF (IF.GT.1) GO TO 5
C-01  COSINE-SQUARED SPREADING
    4 SPF(I)=COS(-PI/2.0+RWANG*(I-1))**2
      IF=1
      GO TO 20
C-01  FUTURE SPREADING
    5 GO TO 4
   20 CONTINUE
      SPFI=SINT(1,NA,SPF,RWANG)
      SPFA=SPFI
      IF(NHDG.EQ.1) SPFA=2.0*SPFI
      IPKT=0
C     ZERO SRS ARRAY
      DO 25 I=1,10
      DO 25 J=1,10
      DO 25 L=1,4
   25 SRS(I,J,L)=0.0
C-02  LOOP OVER PREDOMINANT WAVE HEADING ANGLES
      DO 80 NH=1,NHDG
      WHDG=WANGI+DWANG*(NH-1)
      IF (NHDG.EQ.1) WHDG=180.0
C-03  LOOP OVER WIND SPEED
      DO 60 K=1,NWI
C-04  LOOP OVER RESPONSES
      DO 50 J=KL,JU
      JJ=J
      IF (JJ.EQ.7) GO TO 50
C-04  INTEGRATION LOOP OVER WAVE ANGLE
   30 DO 40 NW=1,NA
      IF (NHDG.GT.1) GO TO 32
      NWH=NW
      GO TO 40
   32 NWH=NW+NH-(NA+1)/2
      IF (NWH.GT.NA) NWH=2*NA-NWH
      IF (NWH.LT.1) NWH=2-NWH
   40 Y(NW)=RSD(JJ,K,NWH)*SPF(NW)
      SRS(JJ,K,1)=SINT(1,NA,Y,RWANG)/SPFI
      SRS(JJ,K,2)=SQRT(SRS(JJ,K,1))
      SRS(JJ,K,4)=SQRT(SRS(JJ,K,1))*2.0
      IF (JJ.NE.2) GO TO 50
      JJ=7
      GO TO 30
   50 CONTINUE
      IF(NPOS.EQ.0) GOTO 23
      DO 100 L=1,NPOS
      DO 110 J=1,7
      SLASK=0.0
   10 DO 120 NW=1,NA
      IF(NHDG.GT.1) GOTO 121
      NWH=NW
      PKTA=SSPA(J,K,L,NWH)
      IF(IPKT.EQ.1) PKTA=SSPA(J,K,L+NPOS,NWH)
      GOTO 120
  121 NWH=NW+NH-(NA+1)/2
      IPKT=1
      IF(NA-NWH) 6,7,7
    6 NWH=2*NA-NWH
      PKTA=SSPA(J,K,L+NPOS,NWH)
      GOTO 120
    7 IF(NWH-1) 8,9,9
    8 NWH=2-NWH
      PKTA=SSPA(J,K,L+NPOS,NWH)
      GOTO 120
    9 PKTA=SSPA(J,K,L,NWH)
  120 Y(NW)=PKTA*SPF(NW)
      SLASK=SLASK+SINT(1,NA,Y,RWANG)/SPFA
      IF(IPKT.EQ.1) GOTO 11
      IPKT=1
      GOTO 10
   11 CONTINUE
      SPAR(J,L,K)=2.0*SQRT(SLASK)
      SSPA(J,K,L,NH+NHDG)=SLASK
      IPKT=0
  110 CONTINUE
  100 CONTINUE
23    CONTINUE
      IF(NSTA.EQ.1) GO TO 60
      L=10
      SLASK=0.0
      SLASK2=0.0
   22 DO 150 NW=1,NA
      IF(NHDG.GT.1) GOTO 151
      NWH=NW
      PKTA=SSPB(2,K,L,NWH)
      PKTB=SSPB(2,K,L+10,NWH)
      IF(IPKT.EQ.1) PKTA=SSPB(2,K,L+10,NWH)
      IF(IPKT.EQ.1) PKTB=SSPB(2,K,L,NWH)
      GOTO 149
  151 NWH=NW+NH-(NA+1)/2
      IPKT=1
      IF(NA-NWH) 16,17,17
   16 NWH=2*NA-NWH
      PKTA=SSPB(2,K,L+10,NWH)
      PKTB=SSPB(2,K,L,NWH)
      GOTO 149
   17 IF(NWH-1) 18,19,19
   18 NWH=2-NWH
      PKTA=SSPB(2,K,L+10,NWH)
      PKTB=SSPB(2,K,L,NWH)
      GOTO 149
   19 PKTA=SSPB(2,K,L,NWH)
      PKTB=SSPB(2,K,L+10,NWH)
  149 Y(NW)=PKTA*SPF(NW)
150   Y2(NW)=PKTB*SPF(NW)
      SLASK=SLASK+SINT(1,NA,Y,RWANG)/SPFA
      SLASK2=SLASK2+SINT(1,NA,Y2,RWANG)/SPFA
      IF(IPKT.EQ.1) GOTO 21
      IPKT=1
      GOTO 22
   21 CONTINUE
      SPAR2(K)=2.0*SQRT(SLASK)
      SPAR3(K)=2.0*SQRT(SLASK2)
      SSPB(1,K,L,NH+NHDG)=SLASK
      SSPB(2,K,L,NH+NHDG)=SLASK2
      IPKT=0
   60 CONTINUE
C-05  PRINT OUT RESULTS AT EACH PREDOMINANT HEADING
      WRITE(6,920) HDA,STP(4*IF-3),STP(4*IF-2),STP(4*IF-1),STP(4*IF)
      WRITE(6,921) S,WHDG
      WRITE(6,924)  ASTA
      WRITE(6,923)
   95 DO 70 K=1,NWI
      WRITE(6,925) K,(SRS(J,K,4),J=1,10),SPAR3(K),SPAR2(K)
   96 IF (ID.LT.4) GO TO 70
      DO 90 I=1,10
   90 RPA(I,K,NH)=SRS(I,K,2)
   70 CONTINUE
      IF(NPOS.EQ.0) GOTO 80
      WRITE(6,932)
      WRITE(6,930)
      IRAD=0
      DO 130 K=1,NWI
      DO 140 L=1,NPOS
      IRAD=IRAD+1
      WRITE(6,931) K,(SPAR(J,L,K),J=1,7),XPOS(L),YPOS(L),ZPOS(L)
  140 CONTINUE
      IF(MOD(IRAD,20).NE.0) GOTO 130
      WRITE(6,920) HDA,STP(4*IF-3),STP(4*IF-2),STP(4*IF-1),STP(4*IF)
      WRITE(6,921) S,WHDG
      WRITE(6,930)
  130 CONTINUE
   80 CONTINUE
      IF (ID.GE.4) CALL LTD(NPOS,XPOS,YPOS,ZPOS)
      RETURN
  920 FORMAT (1H1,20A4//' RESPONSE STATISTICS  (SHORTCRESTED IRREGULAR S
     XEA , ',4A3,' SPREADING)')
  921 FORMAT (9H0SPEED = ,F6.3,' KNOTS    PREDOMINANT HEADING ANGLE = ',
     *F7.3,' DEG.'/1X,'SIGNIFICANT RESPONSES'/)
923   FORMAT(100X,'PORTSIDE   STARBOARDSIDE')
  924 FORMAT(1X,'SPECTRA   HEAVE   PITCH   SWAY     YAW',
     *       4X,'ROLL   VERT.B.M.  VERT.SH.  LAT.B.M.',
     C       3X,'LAT.SH. TORSNL.M.',2X,'PRESSURE AT WATERLINE'/104X,
     D       'STATION ',F5.1)
  925 FORMAT(I5,3X,5(1X,F7.4),5(1X,E9.3),2X,F7.3,6X,F7.3)
  930 FORMAT(/1X,'SPECTRA',2(2X,'VERT.'),2(4X,'REL.'),2(3X,'LAT.'),3X,
     B 'PITCH'/3X,'NO.   MOTION   ACC    MOTION   VEL.  Y-ACC  Y-MOT',
     C       3X,'X-ACC     X       Y       Z'/)
  931 FORMAT(1X,I4,3X,4(F7.4,1X),3(F6.3,1X),3(F7.2,1X))
  932 FORMAT(1X)
      END
      SUBROUTINE LTD(NPOS,XPOS,YPOS,ZPOS)
      COMMON /SSP/ SSPA(7,10,20,20),SSPB(2,10,20,20)
      COMMON / MHDT / HDA(20),IB,IC,ID,IE,IF,IG,IH,II,IJ,IK,IL,INANT,
     B                H00(10),HCH0(10),GAMMB(10),PPER(10),TEXT(20),
     C                ASTA,IDS
      COMMON / SHTD / NHDG,RPA(10,10,25),NLH(25),NB(10),S,NSNIV
      COMMON / PIN / PSERH(25,10),QSERH(25,10),PSERS(25,10),QSERS(25,10)
     X              ,PSERR(25,10),QSERR(25,10),AXO(10),AYO(10),NSTA
      DIMENSION PA(32),WM(10,25),WMPO(10,25),WMPR(10,25),WA(10,25),
     B        WAPO(10,25),WAPR(10,25),WX(10),AWX(10),SLH(25),
     *          XPOS(1),YPOS(1),ZPOS(1),SLASK(10),WX2(10,10),WX3(10)
      DATA PA / 1.00,1.35,1.10,0.75,0.35,0.20,0.00,0.35,
     *          0.25,0.85,2.05,3.30,5.00,6.15,6.30,2.00,
     *          0.63,0.85,1.13,1.56,1.82,2.02,1.86,0.85,
     * 0.1190,0.3455,0.3586,0.1385,0.0291,0.0056,0.0010,0.0028/
      IF(ID.GT.4) GO TO 5
      DO 6 IX=1,8
      H00(IX)=PA(IX)
      HCH0(IX)=PA(8+IX)
      GAMMB(IX)=PA(16+IX)
6     PPER(IX)=PA(24+IX)
5     CONTINUE
      DO 3 JI=1,NSNIV
      A=0.0
      ANH=180.0
      IF (NHDG.GT.1) ANH=180.0/(FLOAT(NHDG)-1.0)
      DO 4 I=1,10
    4 AWX(I)=0.0
      ACB=FLOAT(NB(JI))
      AB=10.**ACB
      IF(ID.EQ.4) WRITE (6,100) HDA,TEXT,AB,S
      IF(ID.GT.4) WRITE(6,200) HDA,TEXT,AB,S,ASTA
      WRITE(6,201)
      DO 1 I=1,NHDG
    1 A=FLOAT(NLH(I))+A
      DO 2 I=1,NHDG
    2 SLH(I)=FLOAT(NLH(I))/A
C-02  LOOP OVER HEADINGS
      DO 10 NH=1,NHDG
C-03  LOOP OVER RESPONSES
      DO 20 NR=1,10
C
C
      IF(JI.GT.1) GOTO 29
      DO 28 I=1,INANT
      SLASK(I)=1.41421*RPA(NR,I,NH)
   28 CONTINUE
      CALL ANPASS(WM(NR,NH),WA(NR,NH),SLASK,H00,HCH0,GAMMB,PPER,INANT)
C
C
   29 CONTINUE
C-05  CALCULATE AND PRINT LONGTERMDISTRIBUTION FOR EACH HEADING
      WB=(1.0/(0.6364/SQRT(WM(NR,NH))+1.0))**2
      WK=1.0/(1.70/WM(NR,NH)+1.0)
      WX(NR)=SQRT((WA(NR,NH))**2*WB*(-ALOG(1.0/AB))**(1.0/WK))
      IF (WX(NR).GT.AWX(NR)) AWX(NR)=WX(NR)
   20 CONTINUE
      BNH=ANH*FLOAT(NH)-ANH
      IF (ANH.EQ.180.0) BNH=180.0
      IF(NSTA.EQ.1) GO TO 32
      DO 33 I=1,10
33    WX2(NH,I)=WX(I)
      GO TO 10
   32 WRITE (6,101) BNH,SLH(NH),(WX(I),I=1,10)
   10 CONTINUE
C-06  CALCULATE AND PRINT LONGTERMDISTRIBUTION WHEN ALL HEADINGS ARE INC
C-07  LOOP OVER RESPONSES
      DO 40 NR=1,10
C-08  LOOP OVER HEADINGS
      STEG=AWX(NR)/2.0
      X=AWX(NR)
   42 QX=0.0
      DO 50 NH=1,NHDG
      WB=(1.0/(0.6364/SQRT(WM(NR,NH))+1.0))**2
      WK=1.0/(1.70/WM(NR,NH)+1.0)
      IF (WA(NR,NH).EQ.0.0) GO TO 50
      IF (((X/WA(NR,NH))**2/WB)**WK-150.0) 51,51,50
   51 QX=QX+SLH(NH)*EXP(-((X/WA(NR,NH))**2/WB)**WK)
   50 CONTINUE
      IF(QX.EQ.0.0) GOTO 39
      QB=1.001/AB
      IF (QX.LT.QB) GO TO 41
      X=X+STEG
      STEG=STEG/2.0
      GO TO 42
   41 QB=0.999/AB
      IF (QX.GT.QB) GO TO 39
      X=X-STEG
      STEG=STEG/2.0
      GO TO 42
39    CONTINUE
      IF(NSTA.GT.1) WX3(NR)=X
   40 WX(NR)=X
      IF(NSTA.EQ.1) WRITE (6,102)  (WX(I),I=1,10)
      IF(NSTA.GT.1) GO TO 31
34    A=0.0
      ANH=180.0
      IF (NHDG.GT.1) ANH=180.0/(FLOAT(NHDG)-1.0)
      DO 85 I=1,10
   85 AWX(I)=0.0
C     LOOP OVER (X,Y,Z)-POINTS
      DO 70 NXY=1,NPOS
      WRITE(6,103) XPOS(NXY),YPOS(NXY),ZPOS(NXY)
C-02  LOOP OVER HEADINGS
      DO 60 NH=1,NHDG
C-03  LOOP OVER RESPONSES
      DO 80 NR=1,7
C
C
      IF(JI.GT.1) GOTO 78
      DO 81 I=1,INANT
      SLASK(I)=SQRT(2.0*SSPA(NR,I,NXY,NH+NHDG))
   81 CONTINUE
      CALL ANPASS(WMPO(NR,NH),WAPO(NR,NH),SLASK,H00,HCH0,GAMMB,PPER,
     B            INANT)
C
C-05  CALCULATE AND PRINT LONGTERMDISTRIBUTION FOR EACH HEADING
C
   78 WB=(1.0/(0.6364/SQRT(WMPO(NR,NH))+1.0))**2
      WK=1.0/(1.70/WMPO(NR,NH)+1.0)
      WX(NR)=SQRT((WAPO(NR,NH))**2*WB*(-ALOG(1.0/AB))**(1.0/WK))
      IF (WX(NR).GT.AWX(NR)) AWX(NR)=WX(NR)
   80 CONTINUE
      BNH=ANH*FLOAT(NH)-ANH
      IF (ANH.EQ.180.0) BNH=180.0
      WRITE (6,104) BNH,SLH(NH),(WX(I),I=1,7)
   60 CONTINUE
C-06  CALCULATE AND PRINT LONGTERMDISTRIBUTION WHEN ALL HEADINGS ARE INC
C-07  LOOP OVER RESPONSES
      DO 95 NR=1,7
C-08  LOOP OVER HEADINGS
      STEG=AWX(NR)/2.0
      X=AWX(NR)
   93 QX=0.0
      DO 96 NH=1,NHDG
      WB=(1.0/(0.6364/SQRT(WMPO(NR,NH))+1.0))**2
      WK=1.0/(1.70/WMPO(NR,NH)+1.0)
      IF (WAPO(NR,NH).EQ.0.0) GO TO 96
      IF (((X/WAPO(NR,NH))**2/WB)**WK-150.0) 97,97,96
   97 QX=QX+SLH(NH)*EXP(-((X/WAPO(NR,NH))**2/WB)**WK)
   96 CONTINUE
      IF(QX.EQ.0.0) GOTO 95
      QB=1.001/AB
      IF (QX.LT.QB) GO TO 92
      X=X+STEG
      STEG=STEG/2.0
      GO TO 93
   92 QB=0.999/AB
      IF (QX.GT.QB) GO TO 95
      X=X-STEG
      STEG=STEG/2.0
      GO TO 93
   95 WX(NR)=X
      WRITE (6,1050)  (WX(I),I=1,7)
70    CONTINUE
      GO TO 3
31    CONTINUE
      A=0.0
      ANH=180.0
      IF (NHDG.GT.1) ANH=180.0/(FLOAT(NHDG)-1.0)
      DO 185 I=1,10
  185 AWX(I)=0.0
C-02   PRESSURE AT WATERLINE, NXY=10
      NXY=10
C-02  LOOP OVER HEADINGS
      DO 160 NH=1,NHDG
C-03  LOOP OVER RESPONSES
      DO 180 NR=1,2
C
C
      IF(JI.GT.1) GOTO 178
      DO 181 I=1,INANT
      SLASK(I)=SQRT(2.0*SSPB(NR,I,NXY,NH+NHDG))
  181 CONTINUE
      CALL ANPASS(WMPR(NR,NH),WAPR(NR,NH),SLASK,H00,HCH0,GAMMB,PPER,
     B        INANT)
C
C-05  CALCULATE AND PRINT LONGTERMDISTRIBUTION FOR EACH HEADING
C
  178 WB=(1.0/(0.6364/SQRT(WMPR(NR,NH))+1.0))**2
      WK=1.0/(1.70/WMPR(NR,NH)+1.0)
      WX(NR)=SQRT((WAPR(NR,NH))**2*WB*(-ALOG(1.0/AB))**(1.0/WK))
      IF (WX(NR).GT.AWX(NR)) AWX(NR)=WX(NR)
  180 CONTINUE
      BNH=ANH*FLOAT(NH)-ANH
      IF (ANH.EQ.180.0) BNH=180.0
      WRITE (6,106) BNH,SLH(NH),(WX2(NH,I),I=1,10),WX(2),WX(1)
  160 CONTINUE
C-06  CALCULATE AND PRINT LONGTERMDISTRIBUTION WHEN ALL HEADINGS ARE INC
C-07  LOOP OVER RESPONSES
      DO 195 NR=1,2
C-08  LOOP OVER HEADINGS
      STEG=AWX(NR)/2.0
      X=AWX(NR)
  193 QX=0.0
      DO 196 NH=1,NHDG
      WB=(1.0/(0.6364/SQRT(WMPR(NR,NH))+1.0))**2
      WK=1.0/(1.70/WMPR(NR,NH)+1.0)
      IF (WAPR(NR,NH).EQ.0.0) GO TO 196
      IF (((X/WAPR(NR,NH))**2/WB)**WK-150.0) 197,197,196
  197 QX=QX+SLH(NH)*EXP(-((X/WAPR(NR,NH))**2/WB)**WK)
  196 CONTINUE
      IF(QX.EQ.0.0) GOTO 195
      QB=1.001/AB
      IF (QX.LT.QB) GO TO 192
      X=X+STEG
      STEG=STEG/2.0
      GO TO 193
  192 QB=0.999/AB
      IF (QX.GT.QB) GO TO 195
      X=X-STEG
      STEG=STEG/2.0
      GO TO 193
  195 WX(NR)=X
      WRITE (6,105)  (WX3(I),I=1,10),WX(2),WX(1)
      IF(NPOS.GT.0) GO TO 34
    3 CONTINUE
      RETURN
  100 FORMAT (1H1,20A4//' LONG TERM DISTRIBUTION  (NORTH ATLANTIC STATIS
     XTICS)'//1X,20A4//' NUMBER OF WAVE ENCOUNTERS = ',E8.2,'   SPEED =
     *',     F6.3//9X,'PROBA-'/
     *       1X,'HEADING BILITY   HEAVE   PITCH    SWAY    YAW',
     *       5X,'ROLL  VERT.B.M.  VERT.SH.  LAT.B.M.  LAT.SH.',
     *       2X,'TORSNL.M.')
  101 FORMAT(F7.1,1X,F6.2,2X,5(F7.3,1X),1X,5(1X,E9.3))
  102 FORMAT(/1X,'ALL INCLUDED   ',5(F7.3,1X),1X,5(1X,E9.3))
  103 FORMAT('1'///1X,'X =',F8.3,'    Y= ',F8.3,'    Z= ',F8.3/
     B     9X,'PROPA-',3X,'VERT',4X,'VERT',2(4X,'REL.'),3X,'LAT.',
     C     4X,'LAT.',4X,'PITCH'/
     D      1X,'HEADING BILITY  MOTION',5X,'ACC.  MOTION    VEL.',
     E      2X,'Y-ACC. Y-MOTION  X-ACC.'/)
104   FORMAT(F6.1,3X,F4.2,4X,F6.3,3X,F6.3,4(2X,F6.3),3X,F6.3)
105   FORMAT(/2X,'ALL INCLUDED   ',5(F7.3,1X),1X,5(1X,E9.3),2(1X,F7.3))
1050  FORMAT(/2X,'ALL INCLUDED   ',F6.3,3X,5(F6.3,2X),1X,F6.3)
106   FORMAT(1X,F7.1,1X,F6.2,2X,5(F7.3,1X),1X,5(1X,E9.3),
     B        2(1X,F7.3))
  200 FORMAT (1H1,20A4//,' LONG TERM DISTRIBUTION  '
     X      //1X,20A4//' NUMBER OF WAVE ENCOUNTERS = ',E8.2,'   SPEED =
     *',     F6.3//9X,'PROBA-'/
     *       1X,'HEADING BILITY   HEAVE   PITCH    SWAY    YAW',
     *       5X,'ROLL  VERT.B.M.  VERT.SH.  LAT.B.M.  LAT.SH.',
     F       'TORSNL.M.',5X,'PRESS. AT WL.'/109X,'STATION',
     G       F5.1)
201   FORMAT(109X,'PORT      SB')
      END
      SUBROUTINE SSPA1(XPOS,YPOS,ZPOS,NPOS,IRREG)
      COMMON /SSP/ SSPA(7,10,20,20),SSPB(2,10,20,20)
      COMMON / CONDA / PI,GAMMA,GRAV,RO
      COMMON / MHDT / HDA(20),IB,IC,ID,IE,IF,IG,IH,II,IJ,IK,IL,INANT,
     B                H00(10),HCH0(10),GAMMB(10),PPER(10),TEXT(20),
     C                ASTA,IDS
      COMMON / BASDA / BPL,DISPL,TMASS,YNERT,BSTAR(21),AREA(21),
     X                 SECOE(21),DRAFT(21),ZBAR(21),XI(21),XISQ(21),
     X                 DWEIGH(21),DMASS(21),ZWT(21),GRL(21),ZCG,XNERT,
     X                 XZPERT,GM,MINKRI,MAXKRI,INCRES,ROLDPF
      COMMON / CASDA / NN,OMW(51),WVL(51),OMWE(51),VMIN,VMAX,DELV,
     X                 NWA,WAD(25),WANGI,WANGA,DWANG,NWI,WD(20),WLL(51)
      COMMON / TDIR / WE,WEN,ANS(21,10),KL,KU,IO,IW
      COMMON / MIMD / IA,NS,DXI,V,WANG,OMEGA,WAVEN,CW,DIX(21,5),FAC,WA
      COMMON / MOTN / ZM(51),ZP(51),TM(51),TP(51),SM(51),SP(51),YM(51),
     X                YP(51),RM(51),RP(51)
      COMMON / STAT / SPECM(10,51),RSD(10,10,25)
      COMMON /IPLOT/ IPLO,I11,I22
      COMMON / SIVFIL/  IRSV,IWX(80),TEXTRSV(80),RSVHNR(10,80)
      COMMON /SKIVPL/ IRAO,IWW(93),TEXTRAO(93),RAO(51,93)
      COMMON / SKIVP2 / WSPECT(51,10)
      DIMENSION  ZTH(20,51),ZACC(20,51),RTH(20,51),
     *          RHAST(20,51),ZPP(20,51),ZPP2(20,51),STS(10),XPP(20,51),
     *          SUM(7),SU(7,5),XPOS(1),YPOS(1),ZPOS(1),XMAX(7)
C     SAVE ZTH(20,51),ZACC(20,51),RTH(20,51),
C    B          RHAST(20,51),ZPP(20,51),ZPP2(20,51),STS(10),XPP(20,51),
C    C          SUM(7),SU(7,5),XPOS(1),YPOS(1),ZPOS(1),XMAX(7)
      SAVE
      DATA STS/3HMN.,3H SQ,3HR.M,3H.S.,3HAVG,3H.  ,3HSIG,3H.  ,
     *         3HAV1,3H/10  /
      PI1=PI/180.0
      NPOS1=2*NPOS
      WAN=1.0/WA
      S=V*1.943845
      DEL=2*ALOG(OMW(3)/OMW(2))
      IF(IRREG.EQ.1) GOTO 4
      DO 2 K=1,NPOS1
      IF(K.LE.NPOS) GOTO 15
      YPOS(K)=-YPOS(K-NPOS)
      XPOS(K)=XPOS(K-NPOS)
      ZPOS(K)=ZPOS(K-NPOS)
      GOTO 16
   15 CONTINUE
      IF(IDS.LT.0) GO TO 16
      IF(IPLO.LE.0) GO TO 16
      IF(IPLO.NE.1) GO TO 20
      IF(K.NE.1) GO TO 16
      WRITE(6,920) HDA
      WRITE(6,938)
      WRITE(6,952)
      GO TO 16
   20 WRITE(6,920) HDA
      WRITE(6,938)
      WRITE(6,921) S,WAD(IW)
      WRITE(6,939) XPOS(K),YPOS(K),ZPOS(K)
      WRITE(6,922)
      WRITE(6,940)
      WRITE(6,924)
      WRITE(6,941)
   16 CONTINUE
      DO 19 IX=1,7
   19 XMAX(IX)=0.0
      DO 1 J=1,NN
      FNX=WVL(J)/(360.0*WA)
      HAMP=ZM(J)*WAN
      PAMP=TM(J)*FNX
      RAMP=RM(J)*FNX
      HPH=ZP(J)*PI1
      PPH=TP(J)*PI1
      RPH=RP(J)*PI1
      SAMP=SM(J)*WAN
      YAMP=YM(J)*FNX
      SPH=SP(J)*PI1
      YPH=YP(J)*PI1
C
C     VERTIKAL R\RELSE Z/H
C
      XX=HAMP*COS(HPH)+2.0*PI/WVL(J)*(PAMP*XPOS(K)*COS(PPH+PI)
     *   +RAMP*YPOS(K)*COS(RPH))
      YY=HAMP*SIN(HPH)+2.0*PI/WVL(J)*(PAMP*XPOS(K)*SIN(PPH+PI)
     *   +RAMP*YPOS(K)*SIN(RPH))
      ZTH(K,J)=SQRT(XX*XX+YY*YY)
      IF( ZTH(K,J).GT.XMAX(1)) XMAX(1)= ZTH(K,J)
      ZFAS=ATAN2(YY,XX)*57.296
C
C     VERTIKAL ACCELERATION
C
      ZACC(K,J)=OMWE(J)**2*BPL*ZTH(K,J)/GRAV
      IF(ZACC(K,J).GT.XMAX(2)) XMAX(2)=ZACC(K,J)
C
C     RELATIV R\RELSE
C
C
C      HƒR HAR LB ƒNDRAT 920228 
C
      XR=XX+COS(2.0*PI*(-XPOS(K)*COS(WANG)+YPOS(K)*SIN(WANG))/WVL(J))
      YR=YY+SIN(2.0*PI*(-XPOS(K)*COS(WANG)+YPOS(K)*SIN(WANG))/WVL(J))
C     XR=XX
C     YR=YY

      RTH(K,J)=SQRT(XR*XR+YR*YR)
      IF( RTH(K,J).GT.XMAX(3)) XMAX(3)= RTH(K,J)
      RFAS=ATAN2(YR,XR)*57.296
C
C     RELATIV HASTIGHET
C
      RHAST(K,J)=ABS(OMWE(J))*BPL*RTH(K,J)/SQRT(GRAV*BPL)
      IF(RHAST(K,J).GT.XMAX(4)) XMAX(4)=RHAST(K,J)
C
C     HORISONTELL ACCELERATION
C
      IF(IE.EQ.0) GOTO 9
      IF(WAD(IW).EQ.0.0.OR.WAD(IW).EQ.180.0) GOTO 9
      XH=(SAMP*COS(SPH)+2.0*PI/WVL(J)*(YAMP*XPOS(K)*COS(YPH)
     *   -RAMP*ZPOS(K)*COS(RPH)))*OMWE(J)**2*BPL/GRAV+
     *    BPL*RAMP*2.0*PI*COS(RPH)/WVL(J)
      XH2=SAMP*COS(SPH)+2.0*PI/WVL(J)*(YAMP*XPOS(K)*COS(YPH)-
     B     (RAMP*ZPOS(K)*COS(RPH)))
      YH=(SAMP*SIN(SPH)+2.0*PI/WVL(J)*(YAMP*XPOS(K)*SIN(YPH)
     *   -RAMP*ZPOS(K)*SIN(RPH)))*OMWE(J)**2*BPL/GRAV+
     *    BPL*RAMP*2.0*PI*SIN(RPH)/WVL(J)
      YH2=SAMP*SIN(SPH)+2.0*PI/WVL(J)*(YAMP*XPOS(K)*SIN(YPH)-
     B     (RAMP*ZPOS(K)*SIN(RPH)))
      ZPP(K,J)=SQRT(XH*XH+YH*YH)
      ZPP2(K,J)=SQRT(XH2*XH2+YH2*YH2)
      IF( ZPP(K,J).GT.XMAX(5)) XMAX(5)= ZPP(K,J)
      IF( ZPP2(K,J).GT.XMAX(6)) XMAX(6)= ZPP2(K,J)
      ZPS=ATAN2(YH,XH)*57.296
      ZPS2=ATAN2(YH2,XH2)*57.296
      GOTO 10
    9 CONTINUE
      ZPP(K,J)=0.0
      ZPP2(K,J)=0.0
      ZPS=0.0
      ZPS2=0.0
   10 CONTINUE
C
C     LATERAL X-ACCELERATION
C
      XL=OMWE(J)**2*BPL/GRAV*(2.0*PI/WVL(J)*ZPOS(K)*PAMP*COS(PPH))-
     B      2.0*PI*BPL*PAMP*COS(PPH)/WVL(J)
      YL=OMWE(J)**2*BPL/GRAV*(2.0*PI/WVL(J)*ZPOS(K)*PAMP*SIN(PPH))-
     B      2.0*PI*BPL*PAMP*SIN(PPH)/WVL(J)
      XPP(K,J)=SQRT(XL*XL+YL*YL)
      IF(XPP(K,J).GT.XMAX(7)) XMAX(7)=XPP(K,J)
      XPS=ATAN2(YL,XL)*57.296
      IF(K.GT.NPOS) GOTO 1
      IF(IPLO-1) 1,18,17
   17 IF(IDS.GE.0) WRITE(6,942) WLL(J),ZTH(K,J),ZFAS,ZACC(K,J),RTH(K,J),
     *      RFAS,RHAST(K,J),ZPP(K,J),ZPS,ZPP2(K,J),ZPS2,XPP(K,J),XPS
      RAO(J,24+(K-1)*7)=ZTH(K,J)
      RAO(J,25+(K-1)*7)=ZACC(K,J)
      RAO(J,26+(K-1)*7)=RTH(K,J)
      RAO(J,27+(K-1)*7)=RHAST(K,J)
      RAO(J,28+(K-1)*7)=ZPP(K,J)
      RAO(J,29+(K-1)*7)=ZPP2(K,J)
      RAO(J,30+(K-1)*7)=XPP(K,J)
      IF(IPLO.NE.3) GOTO 1
   18 WRITE(7) WLL(J),ZTH(K,J),ZACC(K,J),RTH(K,J),RHAST(K,J),
     *         ZPP(K,J),ZPP2(K,J),XPP(K,J)
    1 CONTINUE
      IF(K.GT.NPOS) GO TO 2
      IF(IPLO.NE.1) GO TO 2
      IF(IDS.GE.0) WRITE(6,951) S,WAD(IW),XPOS(K),YPOS(K),ZPOS(K),XMAX
    2 CONTINUE
CC
      DO K=1,6
        DO J=1,NN
          IF(K.LE.3) THEN
            WRITE(30,*) WLL(NN+1-J),RTH(K,NN+1-J)
          ELSE IF(K.LE.5) THEN
            WRITE(30,*) WLL(NN+1-J),ZACC(K,NN+1-J)
          ELSE IF(K.EQ.6) THEN
            WRITE(30,*) WLL(NN+1-J),ZPP(K,NN+1-J)
          END IF
        END DO
      END DO
CC
      IF(IRAO.LT.1) GO TO 98
      DO 32 I=1,NWI
      DO 33 III=1,NN
33    RAO(III,I)=WSPECT(III,I)
32    CONTINUE
c
c     ƒndring frÂn float till ifix 981123/lb
      ISPEED=ifix(S + 0.1)
      IWAD=ifix(WAD(IW) + 0.1)
      WRITE(12,*) ISPEED,IWAD,NN
      WRITE(12,1201) (TEXTRAO(I),I=11,13)
      DO 131 L=1,NN
      WRITE(12,*) (RAO(L,I),I=11,13)
131   CONTINUE
      DO 35 I=1,IRAO
      WRITE(12,1201) TEXTRAO(IWW(I))
      DO 36 L=1,NN
      WRITE(12,1211) RAO(L,IWW(I))
36    CONTINUE
35    CONTINUE
98    RETURN
    4 CONTINUE
C
C     OREGELBUNDNA V]GOR
C
      GKONST=SQRT(GRAV/BPL)
      IF(IL.EQ.1) GOTO 14
      IF(NPOS.GT.2) WRITE(6,920) HDA
      WRITE(6,949)
      IF(NPOS.GT.2) WRITE(6,950) S,WAD(IW)
      WRITE(6,947)
   14 CONTINUE
      DO 7 K=1,NPOS1
      DO 6 L=1,NWI
      IF(K.GT.NPOS) GOTO 13
      IF(IL.NE.1) GOTO 13
      WRITE(6,920) HDA
      WRITE(6,945)
      WRITE(6,944) S,WAD(IW),XPOS(K),YPOS(K),ZPOS(K),WD(L),WD(L+10)
      WRITE(6,922)
      WRITE(6,940)
      WRITE(6,924)
   13 CONTINUE
      SUM(1)=0.0
      SUM(2)=0.0
      SUM(3)=0.0
      SUM(4)=0.0
      SUM(5)=0.0
      SUM(6)=0.0
      SUM(7)=0.0
      DO 5 J=1,NN
      SPEX=SPECM(L,J)
C
C     KORREKTION D] M\TESFREKV. G]R MOT 0 (AKTERLIG SJ\)
C
      IF(ABS(OMWE(J)).LT.0.1.AND.WAD(IW).LT.90.0) GOTO 11
      ZTHR=ZTH(K,J)**2*SPEX
      RTHR=RTH(K,J)**2*SPEX
      ZACCR=(ZACC(K,J)/BPL)**2*SPEX
      XPPR=(XPP(K,J)/BPL)**2*SPEX
      ZPPR=(ZPP(K,J)/BPL)**2*SPEX
      ZPP2R=ZPP2(K,J)**2*SPEX
      RHASTR=(RHAST(K,J)*GKONST)**2*SPEX
      GOTO 12
   11 CONTINUE
      ZTHR=0.0
      RTHR=0.0
      ZACCR=0.0
      XPPR=0.0
      ZPPR=0.0
      RHASTR=0.0
   12 CONTINUE
      SUM(1)=SUM(1)+ZTHR
      SUM(2)=SUM(2)+ZACCR
      SUM(3)=SUM(3)+RTHR
      SUM(4)=SUM(4)+RHASTR
      SUM(5)=SUM(5)+ZPPR
      SUM(6)=SUM(6)+ZPP2R
      SUM(7)=SUM(7)+XPPR
      IF(K.GT.NPOS) GOTO 5
      IF(IL.EQ.1) WRITE(6,943) WLL(J),ZTHR,ZACCR,RTHR,
     *                         RHASTR,ZPPR,ZPP2R,XPPR
    5 CONTINUE
      DO 8 M=1,7
      SU(M,1)=SUM(M)*DEL
      SU(M,2)=SQRT(SUM(M)*DEL)
      SU(M,3)=1.25*SU(M,2)
      SU(M,4)=2.0*SU(M,2)
      SU(M,5)=2.55*SU(M,2)
      SSPA(M,L,K,IW)=SU(M,1)
    8 CONTINUE
      IF(K.GT.NPOS) GOTO 6
      IF(IL.EQ.1) WRITE(6,946) STS(7),STS(8),(SU(J,4),J=1,7)
      IF(IL.NE.1) WRITE(6,948) L,(SU(J,4),J=1,7),XPOS(K),YPOS(K),
     *            ZPOS(K)
      DO 29 JY=1,7
      RSVHNR(L,10+(K - 1)*7+JY)=SU(JY,4)
29    CONTINUE
C     WRITE(6,*) (RSVHNR(L,IVV),IVV=1,80)
    6 CONTINUE
    7 CONTINUE
C     IF(IRAO.LT.1) GO TO 98
C     ISPEED=FLOAT(S+0.1)
C     IWAD=FLOAT(WAD(IW)+0.1)
C     ITOT=IRAO + 1
C     WRITE(12,1200) ISPEED,IWAD,ITOT,NWI
C     DO 30 L=1,NN
C     JY=IWW(L)
C     WRITE(12,1201) TEXTRAO(JY),RAO(L,JY)
30    CONTINUE
C98   CONTINUE
      IF(IRSV.LT.1) GO TO 99
c
c     ƒndring frÂn float till ifix 981123/lb
c
      ISPEED=ifix(S+0.1)
      IWAD=ifix(WAD(IW)+0.1)
      ITOT=IRSV + 1
      WRITE(11,*) ISPEED,IWAD,ITOT,NWI
      WRITE(11,1103)  (WD(I),I=1,NWI)
      DO 31 L=1,IRSV
      JY=IWX(L)
      WRITE(11,1102) TEXTRSV(JY),(RSVHNR(I,JY),I=1,NWI)
31    CONTINUE
99    RETURN
  920 FORMAT (1H1,20A4)
  921 FORMAT (1H0,'SPEED = ',F6.3,' KNOTS   WAVE ANGLE = ',F7.3,' DEG.')
  922 FORMAT(/' WAVE/SHIP')
  924 FORMAT('  LENGTH ')
  938 FORMAT(1H0,'RESPONSES (NON-DIMENSIONAL)')
  939 FORMAT(1H+,51X,'X= ',F8.3,2X,'Y= ',F7.3,2X,'Z= ',F7.3)
  940 FORMAT(1H+,13X,'VERT. MOTION VERT.ACC.  REL. MOTION',
     B      2X,'REL. VEL.',3X,'LAT. Y-ACC.',3X,'LAT. Y-MOTION',
     C      2X,'PITCH X-ACC.')
  941 FORMAT(1H+,12X,'AMPL.   PHASE',2(3X,'AMPL.'),3X,'PHASE',
     B       3X,'AMPL.    AMPL.   PHASE  AMPL.',
     C       3X,'PHASE  AMPL.  PHASE'/)
  942 FORMAT(F9.4,1X,F8.4,1X,F6.1,2(1X,F8.4),1X,F6.1,1X,F7.3,2X,
     B       F7.3,1X,F6.1,1X,F7.3,1X,F6.1,1X,F7.3,1X,F6.1)
  943 FORMAT(F8.4,2X,2F12.4,2X,F9.4,4(3X,F10.4))
  944 FORMAT(1H0,'SPEED=',F6.3,' KNOTS   WAVE ANGLE=',F7.3,' DEG',
     *       2X,' X=',F8.3,'  Y=',F7.3,'  Z=',F7.3/
     *       1X,'SIG. WAVE HT.=',F5.1,' M    MEAN PERIOD=',F5.1,' SEC')
  945 FORMAT(1H0,'RESPONSE SPECTRUM (LONGCRESTED IRREGULAR SEA)')
  946 FORMAT(/2X,2A3,4X,3E12.3,4(2X,E12.3))
  947 FORMAT(/1X,'SPECTRA',2(2X,'VERT.'),2(4X,'REL.'),2(3X,'LAT.'),3X,
     B 'PITCH'/3X,'NO.   MOTION   ACC    MOTION   VEL.  Y-ACC  Y-MOT',
     C       3X,'X-ACC     X       Y       Z'/)
  948 FORMAT(1X,I4,3X,4(F7.4,1X),3(F6.3,1X),3(F7.2,1X))
  949 FORMAT(1X,'SIGNIFICANT RESPONSE (LONGCRESTED IRREGULAR SEA)')
  950 FORMAT(1H0,'SPEED=',F6.3,' KNOTS   WAVE ANGLE=',F7.3,' DEG')
  951 FORMAT(1X,F5.1,1X,F8.1,1X,3F8.3,1X,6F8.4)
  952 FORMAT(/2X,'MAX VALUE FOR PLOTTING'
     *      //2X,'SPEED   WAVE      X       Y       Z    ',
     *          '  VERT    VERT    REL.    REL.    LAT.'
     *       /2X,'        ANGLE                          ',
     *          '  MOTN    ACC     MOTN    VEL.    ACC'
     *      //2X,'KNOTS    DEG      M       M       M'/)
1100  FORMAT(I2,8X,I3,7X,I2,8X,I1)
1101  FORMAT('WAVE',10F10.2)
1102  FORMAT(A4,10(1X,G12.5))
1103  FORMAT('WAVE',10(1X,G12.5))
1200  FORMAT(I2,8X,I3,7X,I2,8X,I1)
1201  FORMAT(3(4X,A4,2X))
1211  FORMAT(3(G12.5,1X))
      END
      SUBROUTINE PRESS
      COMMON /SSP/ SSPA(7,10,20,20),SSPB(2,10,20,20)
      COMMON / PIN / PSERH(25,10),QSERH(25,10),PSERS(25,10),QSERS(25,10)
     X              ,PSERR(25,10),QSERR(25,10),AXO(10),AYO(10),NSTA
      COMMON / PUT / PH(51,10),QH(51,10),PS(51,10),QS(51,10),
     X               PR(51,10),QR(51,10)
      COMMON / CONDA / PI,GAMMA,GRAV,RO
      COMMON / MHDT / HDA(20),IB,IC,ID,IE,IF,IG,IH,II,IJ,IK,IL,INANT,
     B                H00(10),HCH0(10),GAMMB(10),PPER(10),TEXT(20),
     C                ASTA,IDS
      COMMON / BASDA / BPL,DISPL,TMASS,YNERT,BSTAR(21),AREA(21),
     X                 SECOE(21),DRAFT(21),ZBAR(21),XI(21),XISQ(21),
     X                 DWEIGH(21),DMASS(21),ZWT(21),GRL(21),ZCG,XNERT,
     X                 XZPERT,GM,MINKRI,MAXKRI,INCRES,ROLDPF
      COMMON / CASDA / NN,OMW(51),WVL(51),OMWE(51),VMIN,VMAX,DELV,
     X                 NWA,WAD(25),WANGI,WANGA,DWANG,NWI,WD(20),WLL(51)
      COMMON / TDIR / WE,WEN,ANS(21,10),KL,KU,IO,IW
      COMMON / MIMD / IA,NS,DXI,V,WANG,OMEGA,WAVEN,CW,DIX(21,5),FAC,WA
      COMMON / MOTN / ZM(51),ZP(51),TM(51),TP(51),SM(51),SP(51),YM(51),
     X                YP(51),RM(51),RP(51)
      COMMON / STAT / SPECM(10,51),RSD(10,10,25)
      DIMENSION BXO(10),BYO(10)
      DIMENSION PREST(51,10),PHAST(51,10),PREPO(51,10),PHAPO(51,10)
      DIMENSION SUM(2),SU(2,5),STS1(10)
      DATA STS1/3HMN.,3H SQ,3HR.M,3H.S.,3HAVG,3H.  ,3HSIG,3H.  ,
     *         3HAV1,3H/10  /
      DO 23 I=1,51
      DO 23 J=1,10
      PREPO(I,J)=0.0
  23  PREST(I,J)=0.0
      PI2=1.570796
      RAD=57.295779
      S=V*1.943845
      ASTA=FLOAT(NSTA)+0.5*(1.0-FLOAT(IA))-1.0
      GLB=1.0/(RO*GRAV*WA)
      IF (II.EQ.0) GLB=1.0
      DO 6 N=1,10
      BXO(N)=BSTAR(NSTA)*AXO(N)/2.0
    6 BYO(N)=BSTAR(NSTA)*AYO(N)/2.0
C-01  LOOP OVER NUMBER OF FREQUENCIES
      DO 1 I=1,NN
      MM=0
      ZPAAA=ZP(I)-90.0
      TPAAA=TP(I)+90.0
      SPAAA=SP(I)-90.0
      YPAAA=YP(I)-90.0
      RPAAA=RP(I)-90.0
C-02  LOOP OVER THETA AROUND SECTION CONTOUR
    4 CONTINUE
      DO 2 J=1,10
C     HYDRODYNAMIC PRESSURE DUE TO THE MOTION IN STILL WATER
      HMS=ZM(I)*SIN(ZP(I)/RAD)
      HMC=ZM(I)*COS(ZP(I)/RAD)
      PMS=-TM(I)*SIN(TP(I)/RAD)*XI(NSTA)/RAD
      PMC=-TM(I)*COS(TP(I)/RAD)*XI(NSTA)/RAD
      RMS=RM(I)*SIN(RP(I)/RAD)*AXO(J)*BSTAR(NSTA)/(2.0*RAD)
      RMC=RM(I)*COS(RP(I)/RAD)*AXO(J)*BSTAR(NSTA)/(2.0*RAD)
      HPS=PH(I,J)*SIN(ZPAAA/RAD)*ZM(I)
      HPC=PH(I,J)*COS(ZPAAA/RAD)*ZM(I)
      HQS=-QH(I,J)*SIN(PI2+ZPAAA/RAD)*ZM(I)
      HQC=-QH(I,J)*COS(PI2+ZPAAA/RAD)*ZM(I)
      PPS=PH(I,J)*SIN(TPAAA/RAD)*TM(I)*XI(NSTA)/RAD
      PPC=PH(I,J)*COS(TPAAA/RAD)*TM(I)*XI(NSTA)/RAD
      PQS=-QH(I,J)*SIN(PI2+TPAAA/RAD)*TM(I)*XI(NSTA)/RAD
      PQC=-QH(I,J)*COS(PI2+TPAAA/RAD)*TM(I)*XI(NSTA)/RAD
      SPS=PS(I,J)*SIN(SPAAA/RAD)*SM(I)
      SPC=PS(I,J)*COS(SPAAA/RAD)*SM(I)
      SQS=-QS(I,J)*SIN(PI2+SPAAA/RAD)*SM(I)
      SQC=-QS(I,J)*COS(PI2+SPAAA/RAD)*SM(I)
      SPS=SPS+PS(I,J)*SIN(RPAAA/RAD+PI)*RM(I)*ZCG/RAD
      SPC=SPC+PS(I,J)*COS(RPAAA/RAD+PI)*RM(I)*ZCG/RAD
      SQS=SQS-QS(I,J)*SIN(RPAAA/RAD-PI2)*RM(I)*ZCG/RAD
      SQC=SQC-QS(I,J)*COS(RPAAA/RAD-PI2)*RM(I)*ZCG/RAD
      YPS=PS(I,J)*SIN(YPAAA/RAD)*YM(I)*XI(NSTA)/RAD
      YPC=PS(I,J)*COS(YPAAA/RAD)*YM(I)*XI(NSTA)/RAD
      YQS=-QS(I,J)*SIN(PI2+YPAAA/RAD)*YM(I)*XI(NSTA)/RAD
      YQC=-QS(I,J)*COS(PI2+YPAAA/RAD)*YM(I)*XI(NSTA)/RAD
      RPS=PR(I,J)*SIN(RPAAA/RAD)*RM(I)*BSTAR(NSTA)/(2.0*RAD)
      RPC=PR(I,J)*COS(RPAAA/RAD)*RM(I)*BSTAR(NSTA)/(2.0*RAD)
      RQS=-QR(I,J)*SIN(PI2+RPAAA/RAD)*RM(I)*BSTAR(NSTA)/(2.0*RAD)
      RQC=-QR(I,J)*COS(PI2+RPAAA/RAD)*RM(I)*BSTAR(NSTA)/(2.0*RAD)
C     HYDRODYNAMIC PRESSURE DUE TO REFLECTION OF WAVES FROM THE
C     BODY UNDER RESTRAINED CONDITION
      FI=-PI2-XI(NSTA)*COS(WANG)*2.0*PI/WVL(I)+PI*SIN(WANG)*AXO(J)*
     X   BSTAR(NSTA)/WVL(I)
      TI=WA*EXP(-PI*AYO(J)*BSTAR(NSTA)/WVL(I))
      WPS=PH(I,J)*TI*SIN(FI)+PS(I,J)*TI*SIN(FI-PI2)*SIN(WANG)
      WPC=PH(I,J)*TI*COS(FI)+PS(I,J)*TI*COS(FI-PI2)*SIN(WANG)
      WQS=-QH(I,J)*TI*SIN(PI2+FI)-QS(I,J)*TI*SIN(FI)*SIN(WANG)
      WQC=-QH(I,J)*TI*COS(PI2+FI)-QS(I,J)*TI*COS(FI)*SIN(WANG)
C     HYDRODYNAMIC PRESSURE OBTAINED FROM REGULAR WAVE POTENTIAL
      WAS=WA*EXP(-PI*AYO(J)*BSTAR(NSTA)/WVL(I))*SIN(-XI(NSTA)*COS(WANG)*
     X 2.0*PI/WVL(I)+PI*SIN(WANG)*AXO(J)*BSTAR(NSTA)/WVL(I))
      WAC=WA*EXP(-PI*AYO(J)*BSTAR(NSTA)/WVL(I))*COS(-XI(NSTA)*COS(WANG)*
     X 2.0*PI/WVL(I)+PI*SIN(WANG)*AXO(J)*BSTAR(NSTA)/WVL(I))
      ZS=HPS+HQS+PPS+PQS+SPS+SQS+YPS+YQS+RPS+RQS+WAS+HMS+PMS+RMS+WPS+WQS
      ZC=HPC+HQC+PPC+PQC+SPC+SQC+YPC+YQC+RPC+RQC+WAC+HMC+PMC+RMC+WPC+WQC
      IF (MM.EQ.1) GO TO 3
      PREST(I,J)=RO*GRAV*SQRT(ZS*ZS+ZC*ZC)*GLB
      PHAST(I,J)=ATAN2(ZS,ZC)*RAD
      GO TO 2
    3 PREPO(I,J)=RO*GRAV*SQRT(ZS*ZS+ZC*ZC)*GLB
      PHAPO(I,J)=ATAN2(ZS,ZC)*RAD
    2 CONTINUE
      IF (MM.EQ.1) GO TO 7
      MM=1
      DO 5 K=1,10
      PS(I,K)=-PS(I,K)
      QS(I,K)=-QS(I,K)
      PR(I,K)=-PR(I,K)
      QR(I,K)=-QR(I,K)
    5 AXO(K)=-AXO(K)
      GO TO 4
    7 DO 8 K=1,10
    8 AXO(K)=-AXO(K)
      IF(IDS.LT.0) GO TO 1
      IF (MOD(I,3).EQ.1.OR.I.EQ.1) WRITE(6,10) HDA,ASTA,S,WAD(IW)
      IF ((MOD(I,3).EQ.1.OR.I.EQ.1).AND.II.EQ.1) WRITE(6,13)
      WRITE(6,11) OMW(I)
      WRITE(6,12) (BXO(M),BYO(M),PREPO(I,M),PHAPO(I,M),PREST(I,M),
     X             PHAST(I,M),M=1,10)
    1 CONTINUE
      IF(ID.EQ.0) RETURN
C
C     OREGELBUNDNA V]GOR
C
C     GKONST=SQRT(GRAV/BPL)
C     IF(IL.EQ.1) GOTO 14
C     IF(NPOS.GT.2) WRITE(6,920) HDA
C     WRITE(6,949)
C     IF(NPOS.GT.2) WRITE(6,950) S,WAD(IW)
C     WRITE(6,947)
C  14 CONTINUE
      IF(IL.NE.1) WRITE(6,920) HDA,ASTA,S,WAD(IW)
      IF(IL.EQ.1) WRITE(6,930) HDA,ASTA,S,WAD(IW)
      L1=0
      L4=0
      L5=1
      DO 21 K=1,10
      L2=6+(5+NWI)*(K-1)-L1
      IF(IL.NE.1.AND.L2.GT.50) WRITE(6,920) HDA,ASTA,S,WAD(IW)
      IF(L2.GT.50) L1=L1+L2
      L3=8*L5+(K-1)*(5+(NN+3)*NWI)-L4
      IF(IL.EQ.1.AND.L3.GT.51) WRITE(6,930) HDA,ASTA,S,WAD(IW)
      IF(L3.GT.51) L4=L3
      IF(L3.GT.51) L5=L5+1
      IF(IL.EQ.1) WRITE(6,950)
      IF(IL.NE.1) WRITE(6,940)
      DO 15 L=1,NWI
      SUM(1)=0.0
      SUM(2)=0.0
      DO 19 J=1,NN
      SPEX=SPECM(L,J)
C
C     KORREKTION D] M\TESFREKV. G]R MOT 0 (AKTERLIG SJ\)
C
      IF(ABS(OMWE(J)).LT.0.1.AND.WAD(IW).LT.90.0) GOTO 17
      IF(II.EQ.1.AND.L.EQ.1) PREPO(J,K)=PREPO(J,K)*RO*GRAV*WA
      IF(II.EQ.1.AND.L.EQ.1) PREST(J,K)=PREST(J,K)*RO*GRAV*WA
      PREPOR=PREPO(J,K)**2*SPEX
      PRESTR=PREST(J,K)**2*SPEX
      GOTO 18
   17 CONTINUE
      PREPOR=0.0
      PRESTR=0.0
   18 CONTINUE
      SUM(1)=SUM(1)+PRESTR
      SUM(2)=SUM(2)+PREPOR
      IF(J.EQ.1.AND.IL.EQ.1) WRITE(6,943) BXO(K),BYO(K),L,WLL(J),PREPOR,
     BPRESTR
      IF(J.GT.1.AND.IL.EQ.1) WRITE(6,944) WLL(J),PREPOR,PRESTR
   19 CONTINUE
      DEL=2*ALOG(OMW(3)/OMW(2))
      DO 20 M=1,2
      SU(M,1)=SUM(M)*DEL
      SU(M,2)=SQRT(SUM(M)*DEL)
      SU(M,3)=1.25*SU(M,2)
      SU(M,4)=2.0*SU(M,2)
      SU(M,5)=2.55*SU(M,2)
      SSPB(2,L,K+10*(M-1),IW)=SU(M,1)
      SSPB(1,L,K+10*(M-1),IW)=SU(M,1)
   20 CONTINUE
      IF(IL.EQ.1) WRITE(6,946) STS1(7),STS1(8),SU(2,4),SU(1,4)
      IF(IL.NE.1.AND.L.EQ.1) WRITE(6,941) BXO(K),BYO(K),L,SU(2,4),
     B                 SU(1,4)
      IF(IL.NE.1.AND.L.GT.1) WRITE(6,942) L,SU(2,4),SU(1,4)
   15 CONTINUE
   21 CONTINUE
920   FORMAT('1',20A4//' HYDRODYNAMIC PRESSURES AT STATION',F5.1//
     B       ' RESPONSE IN LONGCRESTED IRREGULAR SEA'//
     C       ' SIGNIFICANT SINGLE AMPLITUDE'//' SPEED=',F7.3,' KNOTS',
     D       6X,'WAVE ANGLE=',F8.3,' DEG.')
930   FORMAT('1',20A4//' HYDRODYNAMIC PRESSURES AT STATION',F5.1//
     B       ' RESPONSE IN LONGCRESTED IRREGULAR SEA'//,
     C       ' SPEED=',F7.3,' KNOTS',6X,'WAVE ANGLE=',F8.3,' DEG.')
940   FORMAT(//2X,'Y-COORD  Z-COORD',5X,'SPECTRA',3X,'PORTSIDE',2X,
     B        'STARBOARDSIDE'/4X,'(M)',6X,'(M)',9X,'NO.'/)
941   FORMAT(2(2X,F7.3),6X,I3,F14.3,F12.3)
942   FORMAT(24X,I3,F14.3,F12.3)
943   FORMAT(2(2X,F7.3),6X,I3,3X,F8.3,F13.3,F12.3)
944   FORMAT(30X,F8.3,F13.3,F12.3)
946   FORMAT(/30X,2A3,2X,F13.3,F12.3/)
  948 FORMAT(2X,I3,5X,F9.4,3X,F9.4)
950   FORMAT(//2X,'Y-COORD  Z-COORD',5X,'SPECTRA',2X,'WAVE/SHIP',2X,
     B       'PORTSIDE',2X,'STARBOARDSIDE'/4X,'(M)',6X,'(M)',9X,
     C       'NO.',5X,'LENGTH'/)
      RETURN
   10 FORMAT (1H1,20A4//' HYDRODYNAMIC PRESSURES AT STATION',F5.1//
     X' SPEED =',F7.3,' KNOTS      WAVE ANGLE =',F8.3,' DEG.')
   11 FORMAT (//' WAVE FREQ.=',F8.5,' RAD/SEC'//' Y-COORD  Z-COORD
     X  PORTSIDE*******        STARBOARDSIDE**'/'   (M)      (M)
     X  AMPL.     PHASE        AMPL.     PHASE'/)
   12 FORMAT (1H ,F7.3,F9.3,F14.3,F9.1,F14.3,F9.1)
   13 FORMAT (1H0,'(NON-DIMENSIONAL)')
      END

